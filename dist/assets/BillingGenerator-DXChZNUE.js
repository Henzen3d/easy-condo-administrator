import{c as Ue,z as zt,r as oe,j as e,K as ze,L as tt,O as rt,Q as nt,M as Fe,S as Ft,I as ye,D as Dt,b as Tt,a as ue,E as Ot,d as Pt,e as De,N as _t,s as ve,p as qe,q as He,C as Ke,t as Ye,o as Rt,$ as yt,a0 as Ge,a1 as Bt,H as st,a2 as Lt,a3 as Ut}from"./index-PF3D36V0.js";import{u as Me}from"./use-toast-DSwJ8fSR.js";import{L as me,T as bt,a as wt,b as Te,c as Oe}from"./tabs-DTHgOjkY.js";import{S as Se,e as Ne,f as Ee,g as Ie,h as _e,D as it,a as ot,b as dt,c as lt,d as ct,i as ut,j as Mt}from"./select-BUw1FKH9.js";import{T as Xe,a as Je,b as we,c as ge,d as Qe,e as fe,P as $t}from"./table-Pv-7lEPL.js";import{B as Ze}from"./badge-CKIFn1J9.js";import{E as Wt,c as Gt,P as Zt,d as Vt}from"./invoiceService-_JBDSHYM.js";import{generatePixQRCode as qt}from"./pixUtils-mCfSFajD.js";import{f as je,p as Ae,C as et,a as Le,P as Ht,b as Kt,c as Yt,d as Xt}from"./calendar-BTUSM4vi.js";import{E as Jt}from"./eye-CcKAEFEB.js";import{D as Qt}from"./download-Cr82A7Gw.js";import{A as er,a as tr,C as jt}from"./alert-DARdkq_h.js";import{h as rr}from"./pixService-DVuueQii.js";import"./addDays-Db2LM6jR.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=Ue("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=Ue("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ar=Ue("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=Ue("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=Ue("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),or=x=>{const A=new Date;return A.setMonth(x),je(A,"LLLL",{locale:Ae}).toUpperCase()},gt=x=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(x),kt=async x=>{const A=new Wt({orientation:"portrait",unit:"mm",format:"a4"});A.setFillColor(41,98,255),A.rect(0,0,210,50,"F"),A.setTextColor(255,255,255),A.setFont("helvetica","bold"),A.setFontSize(28),A.text(x.condoName,20,20),A.setFontSize(12),A.text("GESTÃO DE CONDOMÍNIO",20,30),A.setFontSize(10),A.setTextColor(255,255,255),A.text(x.condoAddress,190,15,{align:"right"}),A.text(x.condoWebsite,190,20,{align:"right"}),A.text(x.condoPhone,190,25,{align:"right"}),A.text(x.condoEmail,190,30,{align:"right"}),A.setTextColor(50,50,50),A.setFont("helvetica","bold"),A.setFontSize(40),A.text("Fatura",20,80),A.setFont("helvetica","normal"),A.setFontSize(14),A.text(`${or(x.referenceMonth)} | ${x.referenceYear}`,20,90),A.setFontSize(12),A.setFont("helvetica","bold"),A.text("MORADOR:",20,110),A.setFont("helvetica","normal"),A.text(x.residentName,80,110),A.setFont("helvetica","bold"),A.text("APARTAMENTO:",20,120),A.setFont("helvetica","normal"),A.text(`${x.unitBlock}-${x.unitNumber}`,80,120),A.setFont("helvetica","bold"),A.text("CONTATO:",20,130),A.setFont("helvetica","normal"),A.text(x.contactPhone,80,130),Gt(A,{startY:140,head:[["SERVIÇO","DESCRIÇÃO","VALOR"]],body:x.items.map(P=>[P.category,P.description,gt(P.value)]),headStyles:{fillColor:[41,98,255],textColor:[255,255,255],fontStyle:"bold",halign:"left"},columnStyles:{0:{cellWidth:40},1:{cellWidth:110},2:{cellWidth:40,halign:"right"}},styles:{fontSize:10,cellPadding:5,overflow:"linebreak"},alternateRowStyles:{fillColor:[245,245,245]}});const g=A.lastAutoTable.finalY+10;if(A.setFont("helvetica","bold"),A.setFontSize(12),A.text("FORMA DE PAGAMENTO:",20,g),A.setFont("helvetica","normal"),A.text("TRANSFERÊNCIA BANCÁRIA OU PIX",20,g+8),A.setFillColor(41,98,255),A.setTextColor(255,255,255),A.roundedRect(140,g-10,50,20,3,3,"F"),A.setFontSize(12),A.text("TOTAL:",145,g),A.setFontSize(14),A.setFont("helvetica","bold"),A.text(gt(x.total),145,g+8),A.setTextColor(50,50,50),A.setFontSize(10),A.text(`Data de vencimento: ${je(new Date(x.dueDate),"dd/MM/yyyy")}`,140,g+25),x.pixKey&&x.beneficiaryName)try{const P=x.transactionId||`${x.unitBlock}${x.unitNumber}${x.referenceMonth}${x.referenceYear}`,b=`Cond ${x.referenceMonth}/${x.referenceYear}`,d=await qt(x.pixKey,x.total,P,x.beneficiaryName,x.city||"BRASIL",b);if(d){A.addImage(d,"PNG",20,g+20,45,45),A.setTextColor(50,50,50),A.setFontSize(10),A.setFont("helvetica","bold"),A.text("Escaneie o código PIX:",70,g+30),A.setFont("helvetica","normal"),A.text("Use o aplicativo do seu banco para",70,g+38),A.text("pagar via PIX usando este QR Code.",70,g+46);const{identifyPixKeyType:i,formatPixKey:n}=require("./pixUtils"),l=i(x.pixKey),j=n(x.pixKey),k={cpf:"CPF",cnpj:"CNPJ",email:"E-mail",phone:"Telefone",random:"Chave Aleatória"}[l]||"Chave PIX";A.text(`Tipo de Chave: ${k}`,70,g+56),A.text(`Chave PIX: ${j}`,70,g+64)}}catch(P){console.error("Error adding QR code to PDF:",P)}return A.setTextColor(150,150,150),A.setFontSize(8),A.text("Este documento é uma fatura simplificada e não tem valor fiscal.",105,285,{align:"center"}),A.output("blob")},dr=(x,A)=>{var s,m,a,c,o,v,w;console.log("Preparing invoice data for unit:",A.id,A.block,A.number);const g=((s=x.chargeItems)==null?void 0:s.filter(C=>C.targetUnits==="all"||!C.unit||C.unit==="all"||C.unit===""||C.unit===null))||[];if(x.condominiumFees){const C={category:"Taxa de Condomínio",description:x.condominiumFees.type==="fixed"?"Taxa Fixa de Condomínio":"Taxa Rateada de Condomínio",value:x.condominiumFees.value,targetUnits:"all"};g.push(C)}if(x.reserveFund){const C={category:"Fundo de Reserva",description:x.reserveFund.type==="fixed"?"Contribuição Fixa ao Fundo de Reserva":"Contribuição Rateada ao Fundo de Reserva",value:x.reserveFund.value,targetUnits:"all"};g.push(C)}console.log("Global charges:",g);const P=((m=x.chargeItems)==null?void 0:m.filter(C=>C.targetUnits!=="all"&&C.unit&&C.unit!=="all"&&C.unit!==""&&C.unit!==null&&String(C.unit)===String(A.id)))||[];x.unitSpecificFees&&x.unitSpecificFees.filter(h=>String(h.unit)===String(A.id)).forEach(h=>{h.type==="condominium"?P.push({category:"Taxa de Condomínio",description:h.calculationMethod==="fixed"?"Taxa Fixa de Condomínio (Unidade)":"Taxa Rateada de Condomínio (Unidade)",value:h.value,targetUnits:h.unit}):h.type==="reserve"&&P.push({category:"Fundo de Reserva",description:h.calculationMethod==="fixed"?"Contribuição Fixa ao Fundo de Reserva (Unidade)":"Contribuição Rateada ao Fundo de Reserva (Unidade)",value:h.value,targetUnits:h.unit})}),console.log("Unit specific charges:",P);let b=[];x.includeGasConsumption&&x.gasConsumptionItems&&(b=x.gasConsumptionItems.filter(C=>String(C.unit)===String(A.id))),console.log("Gas consumption items for this unit:",b);let d=[];x.includeWaterConsumption&&x.waterConsumptionItems&&(d=x.waterConsumptionItems.filter(C=>String(C.unit)===String(A.id))),console.log("Water consumption items for this unit:",d);const i=[...g,...P,...b,...d],n=new Map;i.forEach(C=>{const h=`${C.category||""}:${C.description||""}:${C.value||""}`;n.has(h)||n.set(h,C)});const l=Array.from(n.values());console.log("All unique items for this unit:",l);const j=l.reduce((C,h)=>C+parseFloat(h.value||0),0);let k=0,y;(a=x.earlyPaymentDiscount)!=null&&a.enabled&&(y={type:x.earlyPaymentDiscount.discountType,value:parseFloat(x.earlyPaymentDiscount.discountValue||0)},k=y.type==="percentage"?j*(y.value/100):y.value);const _=j-k;return{condoName:"Meu Condomínio",condoAddress:"RUA ALEGRE, 123 - CIDADE BRASILEIRA",condoPhone:"(12) 3456-7890",condoWebsite:"WWW.GRANDESITE.COM.BR",condoEmail:"contato@grandesite.com.br",residentName:A.owner||x.resident||"Morador",unitNumber:A.number||"101",unitBlock:A.block||"A",contactPhone:"(47) 3456-7890",referenceMonth:((c=x.reference)==null?void 0:c.month)!==void 0?x.reference.month:new Date().getMonth(),referenceYear:((o=x.reference)==null?void 0:o.year)||new Date().getFullYear(),dueDate:x.dueDate||new Date().toISOString(),items:l.map(C=>({description:C.description||"",category:C.category||"Geral",value:parseFloat(C.value||0)})),subtotal:j,discount:y,total:_,pixKey:"00446547905",transactionId:`${A.block||"A"}${A.number||"101"}${((v=x.reference)==null?void 0:v.month)||new Date().getMonth()}${((w=x.reference)==null?void 0:w.year)||new Date().getFullYear()}`,beneficiaryName:"CONDOMINIO EXEMPLO"}},lr=({status:x})=>{switch(x){case"paid":return e.jsx(Ze,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Pago"});case"pending":return e.jsx(Ze,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"Pendente"});case"overdue":return e.jsx(Ze,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:"Vencido"});case"cancelled":return e.jsx(Ze,{className:"bg-gray-100 text-gray-800 hover:bg-gray-100",children:"Cancelado"});default:return null}},cr=()=>{const{toast:x}=Me(),{bankAccounts:A}=zt(),[g,P]=oe.useState([]),[b,d]=oe.useState(!0),[i,n]=oe.useState(null),[l,j]=oe.useState(!1),[k,y]=oe.useState(!1),[_,s]=oe.useState({bankAccountId:"",paymentDate:new Date,paymentMethod:"pix",notes:""}),[m,a]=oe.useState({dueDate:new Date,notes:""}),[c,o]=oe.useState(!1);oe.useEffect(()=>{(async()=>{try{d(!0);const{data:f,error:z}=await ve.from("invoices").select(`
            *,
            billings:invoice_billings(
              billing_id
            ),
            unit:units(
              id, block, number, owner
            )
          `).order("created_at",{ascending:!1});if(z)throw z;const r=await Promise.all(f.map(async B=>{const W=B.billings.map(G=>G.billing_id),{data:L,error:J}=await ve.from("billings").select("*").in("id",W);return J?(console.error("Erro ao carregar detalhes das cobranças:",J),{...B,billingsDetails:[]}):{...B,billingsDetails:L||[]}}));P(r)}catch(f){console.error("Erro ao carregar faturas:",f),x({title:"Erro",description:"Erro ao carregar faturas",variant:"destructive"})}finally{d(!1)}})()},[x]);const v=O=>O?je(new Date(O),"dd/MM/yyyy",{locale:Ae}):"",w=O=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(O),C=O=>{n(O),s({bankAccountId:A.length>0?A[0].id:"",paymentDate:new Date,paymentMethod:"pix",notes:""}),j(!0)},h=O=>{n(O),a({dueDate:new Date(O.due_date),notes:O.notes||""}),y(!0)},U=async()=>{if(i){if(!_.bankAccountId){x({title:"Erro",description:"Preencha todos os campos obrigatórios",variant:"destructive"});return}try{o(!0);const{error:O}=await ve.from("invoices").update({status:"paid",payment_date:_.paymentDate.toISOString(),payment_method:_.paymentMethod,payment_notes:_.notes,bank_account_id:_.bankAccountId}).eq("id",i.id);if(O)throw O;for(const f of i.billingsDetails){const{error:z}=await ve.from("billings").update({status:"paid",payment_date:_.paymentDate.toISOString()}).eq("id",f.id);z&&console.error("Erro ao atualizar cobrança:",z)}P(g.map(f=>f.id===i.id?{...f,status:"paid",payment_date:_.paymentDate.toISOString(),payment_method:_.paymentMethod,payment_notes:_.notes,bank_account_id:_.bankAccountId}:f)),x({title:"Sucesso",description:"Pagamento processado com sucesso"}),j(!1)}catch(O){console.error("Erro ao processar pagamento:",O),x({title:"Erro",description:"Erro ao processar pagamento",variant:"destructive"})}finally{o(!1)}}},S=async()=>{if(i)try{o(!0);const{error:O}=await ve.from("invoices").update({due_date:m.dueDate.toISOString(),notes:m.notes}).eq("id",i.id);if(O)throw O;P(g.map(f=>f.id===i.id?{...f,due_date:m.dueDate.toISOString(),notes:m.notes}:f)),x({title:"Sucesso",description:"Fatura atualizada com sucesso"}),y(!1)}catch(O){console.error("Erro ao atualizar fatura:",O),x({title:"Erro",description:"Erro ao atualizar fatura",variant:"destructive"})}finally{o(!1)}},T=async O=>{try{o(!0);const f={invoiceNumber:O.invoice_number,unitId:O.unit_id,unitBlock:O.unit[0].block,unitNumber:O.unit[0].number,resident:O.unit[0].owner||"Proprietário",dueDate:O.due_date,referenceMonth:O.reference_month,referenceYear:O.reference_year,notes:O.notes,chargeItems:O.billingsDetails.map(W=>({id:W.id,description:W.description,value:W.amount,category:W.category||"taxa"})),isSecondCopy:!0},z=await kt(f);if(!z||z.size===0)throw new Error("PDF gerado está vazio");const r=URL.createObjectURL(z),B=document.createElement("a");B.href=r,B.download=`fatura_${O.unit[0].block}-${O.unit[0].number}_${O.reference_month}_${O.reference_year}_2via.pdf`,document.body.appendChild(B),B.click(),setTimeout(()=>{document.body.removeChild(B),URL.revokeObjectURL(r)},100),x({title:"Sucesso",description:`Segunda via da fatura ${O.invoice_number} gerada com sucesso`})}catch(f){console.error("Erro ao gerar segunda via:",f),x({title:"Erro",description:"Erro ao gerar segunda via da fatura",variant:"destructive"})}finally{o(!1)}},I=O=>{x({title:"Informação",description:`Fatura ${O.invoice_number} enviada por e-mail`})},V=O=>{x({title:"Informação",description:`Visualizando fatura ${O.invoice_number}`})};return e.jsxs(ze,{children:[e.jsxs(tt,{children:[e.jsx(rt,{children:"Histórico de Faturamentos"}),e.jsx(nt,{children:"Visualize e gerencie todas as faturas geradas"})]}),e.jsxs(Fe,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(Ft,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(ye,{type:"search",placeholder:"Buscar por número, unidade ou morador...",className:"pl-9",value:searchQuery,onChange:O=>setSearchQuery(O.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Se,{value:statusFilter,onValueChange:setStatusFilter,children:[e.jsx(Ne,{className:"w-[150px]",children:e.jsx(Ee,{placeholder:"Status"})}),e.jsxs(Ie,{children:[e.jsx(_e,{value:"all",children:"Todos os status"}),e.jsx(_e,{value:"pending",children:"Pendente"}),e.jsx(_e,{value:"paid",children:"Pago"}),e.jsx(_e,{value:"overdue",children:"Vencido"}),e.jsx(_e,{value:"cancelled",children:"Cancelado"})]})]}),e.jsxs(Se,{value:monthFilter,onValueChange:setMonthFilter,children:[e.jsx(Ne,{className:"w-[150px]",children:e.jsx(Ee,{placeholder:"Mês"})}),e.jsxs(Ie,{children:[e.jsx(_e,{value:"all",children:"Todos os meses"}),Array.from({length:12},(O,f)=>f+1).map(O=>e.jsx(_e,{value:O.toString(),children:getMonthName(O)},O))]})]}),e.jsxs(Se,{value:yearFilter,onValueChange:setYearFilter,children:[e.jsx(Ne,{className:"w-[150px]",children:e.jsx(Ee,{placeholder:"Ano"})}),e.jsxs(Ie,{children:[e.jsx(_e,{value:"all",children:"Todos os anos"}),e.jsx(_e,{value:"2023",children:"2023"}),e.jsx(_e,{value:"2022",children:"2022"}),e.jsx(_e,{value:"2021",children:"2021"})]})]})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(we,{children:[e.jsx(ge,{children:"Nº da Fatura"}),e.jsx(ge,{children:"Referência"}),e.jsx(ge,{children:"Unidade"}),e.jsx(ge,{children:"Morador"}),e.jsx(ge,{children:"Valor"}),e.jsx(ge,{children:"Vencimento"}),e.jsx(ge,{children:"Status"}),e.jsx(ge,{className:"text-right",children:"Ações"})]})}),e.jsx(Qe,{children:filteredInvoices.length>0?filteredInvoices.map(O=>e.jsxs(we,{children:[e.jsx(fe,{className:"font-medium",children:O.invoiceNumber}),e.jsxs(fe,{children:[getMonthName(O.referenceMonth),"/",O.referenceYear]}),e.jsx(fe,{children:O.unit}),e.jsx(fe,{children:O.resident}),e.jsx(fe,{children:w(O.totalAmount)}),e.jsx(fe,{children:v(O.dueDate)}),e.jsx(fe,{children:e.jsx(lr,{status:O.status})}),e.jsx(fe,{className:"text-right",children:e.jsxs(Dt,{children:[e.jsx(Tt,{asChild:!0,children:e.jsx(ue,{variant:"ghost",size:"icon",children:e.jsx(Ot,{size:16})})}),e.jsxs(Pt,{align:"end",children:[e.jsxs(De,{onClick:()=>V(O),children:[e.jsx(Jt,{size:14,className:"mr-2"}),e.jsx("span",{children:"Visualizar"})]}),O.status==="pending"||O.status==="overdue"?e.jsxs(De,{onClick:()=>C(O),children:[e.jsx(_t,{size:14,className:"mr-2"}),e.jsx("span",{children:"Registrar Pagamento"})]}):null,e.jsxs(De,{onClick:()=>h(O),children:[e.jsx($t,{size:14,className:"mr-2"}),e.jsx("span",{children:"Editar"})]}),e.jsxs(De,{onClick:()=>T(O),children:[e.jsx(Zt,{size:14,className:"mr-2"}),e.jsx("span",{children:"Segunda Via"})]}),e.jsxs(De,{onClick:()=>I(O),children:[e.jsx(sr,{size:14,className:"mr-2"}),e.jsx("span",{children:"Enviar por E-mail"})]}),e.jsxs(De,{onClick:()=>V(O),children:[e.jsx(Qt,{size:14,className:"mr-2"}),e.jsx("span",{children:"Download PDF"})]})]})]})})]},O.id)):e.jsx(we,{children:e.jsx(fe,{colSpan:8,className:"text-center py-6 text-muted-foreground",children:"Nenhuma fatura encontrada com os filtros selecionados."})})})]})})]}),e.jsx(it,{open:l,onOpenChange:j,children:e.jsxs(ot,{className:"sm:max-w-[425px]",children:[e.jsxs(dt,{children:[e.jsx(lt,{children:"Registrar Pagamento"}),e.jsxs(ct,{children:["Registre o pagamento da fatura ",i==null?void 0:i.invoice_number]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(me,{htmlFor:"bankAccount",className:"text-right",children:"Conta"}),e.jsx("select",{id:"bankAccount",className:"col-span-3 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:_.bankAccountId,onChange:O=>s({..._,bankAccountId:O.target.value}),children:A.map(O=>e.jsx("option",{value:O.id,children:O.name},O.id))})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(me,{htmlFor:"paymentDate",className:"text-right",children:"Data"}),e.jsx(ye,{id:"paymentDate",type:"date",className:"col-span-3",value:je(_.paymentDate,"yyyy-MM-dd"),onChange:O=>s({..._,paymentDate:new Date(O.target.value)})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(me,{htmlFor:"paymentMethod",className:"text-right",children:"Método"}),e.jsxs("select",{id:"paymentMethod",className:"col-span-3 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:_.paymentMethod,onChange:O=>s({..._,paymentMethod:O.target.value}),children:[e.jsx("option",{value:"pix",children:"PIX"}),e.jsx("option",{value:"transfer",children:"Transferência"}),e.jsx("option",{value:"cash",children:"Dinheiro"}),e.jsx("option",{value:"check",children:"Cheque"}),e.jsx("option",{value:"other",children:"Outro"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(me,{htmlFor:"notes",className:"text-right",children:"Observações"}),e.jsx(ye,{id:"notes",value:_.notes,onChange:O=>s({..._,notes:O.target.value}),placeholder:"Observações sobre o pagamento (opcional)"})]})]}),e.jsxs(ut,{children:[e.jsx(ue,{variant:"outline",onClick:()=>j(!1),children:"Cancelar"}),e.jsx(ue,{onClick:U,disabled:c,children:c?"Processando...":"Confirmar Pagamento"})]})]})}),e.jsx(it,{open:k,onOpenChange:y,children:e.jsxs(ot,{className:"sm:max-w-[425px]",children:[e.jsxs(dt,{children:[e.jsx(lt,{children:"Editar Fatura"}),e.jsxs(ct,{children:["Edite os detalhes da fatura ",i==null?void 0:i.invoice_number]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(me,{htmlFor:"dueDate",className:"text-right",children:"Vencimento"}),e.jsx(ye,{id:"dueDate",type:"date",className:"col-span-3",value:je(m.dueDate,"yyyy-MM-dd"),onChange:O=>a({...m,dueDate:new Date(O.target.value)})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(me,{htmlFor:"editNotes",className:"text-right",children:"Observações"}),e.jsx(ye,{id:"editNotes",value:m.notes,onChange:O=>a({...m,notes:O.target.value}),placeholder:"Observações sobre a fatura (opcional)"})]})]}),e.jsxs(ut,{children:[e.jsx(ue,{variant:"outline",onClick:()=>y(!1),children:"Cancelar"}),e.jsx(ue,{onClick:S,disabled:c,children:c?"Salvando...":"Salvar Alterações"})]})]})})]})},ur=()=>e.jsxs(ze,{children:[e.jsxs(tt,{children:[e.jsx(rt,{children:"Cobranças Lançadas"}),e.jsx(nt,{children:"Visualize todas as cobranças lançadas no sistema"})]}),e.jsx(Fe,{children:e.jsx("p",{children:"Conteúdo da aba de cobranças lançadas"})})]}),hr=()=>e.jsxs(ze,{children:[e.jsxs(tt,{children:[e.jsx(rt,{children:"Configurações de Pagamento"}),e.jsx(nt,{children:"Configure as opções de pagamento para as faturas"})]}),e.jsx(Fe,{children:e.jsx("p",{children:"Conteúdo da aba de configurações de pagamento"})})]}),ht=[{id:1,name:"Informações Gerais"},{id:2,name:"Consumo"},{id:3,name:"Itens de Cobrança"},{id:4,name:"Gerar Faturas"}],fr=({activeStep:x})=>e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex justify-between mb-2",children:ht.map(A=>e.jsxs("div",{className:`flex flex-col items-center flex-1 ${A.id<x?"text-primary":A.id===x?"text-primary font-bold":"text-muted-foreground"}`,children:[e.jsx("div",{className:`rounded-full w-8 h-8 flex items-center justify-center mb-2 ${A.id<x?"bg-primary text-white":A.id===x?"border-2 border-primary text-primary":"border border-muted-foreground text-muted-foreground"}`,children:A.id}),e.jsx("span",{className:"text-sm hidden md:block",children:A.name})]},A.id))}),e.jsx("div",{className:"relative flex h-1 bg-muted",children:e.jsx("div",{className:"absolute bg-primary h-1 transition-all duration-300",style:{width:`${(x-1)/(ht.length-1)*100}%`}})})]}),Ct=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],mr=Array.from({length:5},(x,A)=>new Date().getFullYear()-2+A),xt=(x,A)=>{const g=new Date(x,A,1);let P=0;for(;P<10;){g.setDate(g.getDate()+1);const b=g.getDay();b!==0&&b!==6&&P++}return g},vt=(x,A)=>`Taxa de Condomínio - ${Ct[x]} de ${A}`,pr=({billingData:x,updateBillingData:A})=>{var i,n,l,j,k,y,_,s,m,a,c,o,v,w,C;const[g,P]=oe.useState(((i=x.earlyPaymentDiscount)==null?void 0:i.enabled)||!1);oe.useEffect(()=>{var T,I,V,O;const h=new Date,U=h.getMonth(),S=h.getFullYear();if((!x.reference||!x.reference.month||!x.reference.year)&&A({reference:{month:U,year:S}}),!x.dueDate){const f=((T=x.reference)==null?void 0:T.month)!==void 0?x.reference.month:U,z=((I=x.reference)==null?void 0:I.year)!==void 0?x.reference.year:S,r=xt(z,f);A({dueDate:r})}if(!x.name){const f=((V=x.reference)==null?void 0:V.month)!==void 0?x.reference.month:U,z=((O=x.reference)==null?void 0:O.year)!==void 0?x.reference.year:S,r=vt(f,z);A({name:r})}},[(n=x.reference)==null?void 0:n.month,(l=x.reference)==null?void 0:l.year]),oe.useEffect(()=>{var h,U;if(((h=x.reference)==null?void 0:h.month)!==void 0&&((U=x.reference)==null?void 0:U.year)!==void 0){const S=vt(x.reference.month,x.reference.year);(!x.name||x.name.startsWith("Taxa de Condomínio - "))&&A({name:S});const I=xt(x.reference.year,x.reference.month);(!x.dueDate||x.dueDate&&x.dueDateAutoSet)&&A({dueDate:I,dueDateAutoSet:!0})}},[(j=x.reference)==null?void 0:j.month,(k=x.reference)==null?void 0:k.year]);const b=h=>{P(h),A({earlyPaymentDiscount:{...x.earlyPaymentDiscount,enabled:h}})},d=(h,U)=>{U&&(h==="dueDate"?A({dueDate:U,dueDateAutoSet:!1}):h==="discountDueDate"&&A({earlyPaymentDiscount:{...x.earlyPaymentDiscount,dueDate:U}}))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(me,{htmlFor:"reference-month",children:"Referência - Mês"}),e.jsxs(Se,{value:String((y=x.reference)==null?void 0:y.month),onValueChange:h=>A({reference:{...x.reference,month:parseInt(h)}}),children:[e.jsx(Ne,{id:"reference-month",children:e.jsx(Ee,{placeholder:"Selecione o mês"})}),e.jsx(Ie,{children:Ct.map((h,U)=>e.jsx(_e,{value:String(U),children:h},U))})]})]}),e.jsxs("div",{children:[e.jsx(me,{htmlFor:"reference-year",children:"Referência - Ano"}),e.jsxs(Se,{value:String((_=x.reference)==null?void 0:_.year),onValueChange:h=>A({reference:{...x.reference,year:parseInt(h)}}),children:[e.jsx(Ne,{id:"reference-year",children:e.jsx(Ee,{placeholder:"Selecione o ano"})}),e.jsx(Ie,{children:mr.map(h=>e.jsx(_e,{value:String(h),children:h},h))})]})]})]}),e.jsxs("div",{children:[e.jsx(me,{htmlFor:"billing-name",children:"Nome do Faturamento"}),e.jsx(ye,{id:"billing-name",placeholder:"Ex: Taxa de Condomínio - Janeiro de 2024",value:x.name,onChange:h=>A({name:h.target.value})})]}),e.jsxs("div",{children:[e.jsx(me,{htmlFor:"due-date",children:"Data de Vencimento"}),e.jsxs(qe,{children:[e.jsx(He,{asChild:!0,children:e.jsxs(ue,{variant:"outline",className:"w-full justify-start text-left font-normal",id:"due-date",children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),x.dueDate?je(new Date(x.dueDate),"dd 'de' MMMM 'de' yyyy",{locale:Ae}):e.jsx("span",{children:"Selecione a data"})]})}),e.jsx(Ye,{className:"w-auto p-0",children:e.jsx(et,{mode:"single",selected:x.dueDate?new Date(x.dueDate):void 0,onSelect:h=>d("dueDate",h),initialFocus:!0})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Data padrão: 10º dia útil do mês de referência"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Incluir Consumo"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Le,{id:"gas-consumption",checked:x.includeGasConsumption,onCheckedChange:h=>A({includeGasConsumption:!!h})}),e.jsx(me,{htmlFor:"gas-consumption",children:"Cobrar Consumo de Gás referente ao mês selecionado"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Le,{id:"water-consumption",checked:x.includeWaterConsumption,onCheckedChange:h=>A({includeWaterConsumption:!!h})}),e.jsx(me,{htmlFor:"water-consumption",children:"Cobrar Consumo de Água referente ao mês selecionado"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Le,{id:"enable-discount",checked:g,onCheckedChange:h=>b(!!h)}),e.jsx(me,{htmlFor:"enable-discount",children:"Aplicar Desconto por Pontualidade"})]}),g&&e.jsxs("div",{className:"border p-4 rounded-md space-y-4",children:[e.jsxs("div",{children:[e.jsx(me,{htmlFor:"discount-due-date",children:"Até a data"}),e.jsxs(qe,{children:[e.jsx(He,{asChild:!0,children:e.jsxs(ue,{variant:"outline",className:"w-full justify-start text-left font-normal",id:"discount-due-date",children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),(s=x.earlyPaymentDiscount)!=null&&s.dueDate?je(new Date(x.earlyPaymentDiscount.dueDate),"dd 'de' MMMM 'de' yyyy",{locale:Ae}):e.jsx("span",{children:"Selecione a data limite para desconto"})]})}),e.jsx(Ye,{className:"w-auto p-0",children:e.jsx(et,{mode:"single",selected:(m=x.earlyPaymentDiscount)!=null&&m.dueDate?new Date(x.earlyPaymentDiscount.dueDate):void 0,onSelect:h=>d("discountDueDate",h),initialFocus:!0})})]})]}),e.jsxs("div",{children:[e.jsx(me,{htmlFor:"discount-type",children:"Tipo de Desconto"}),e.jsxs(Se,{value:((a=x.earlyPaymentDiscount)==null?void 0:a.discountType)||"fixed",onValueChange:h=>A({earlyPaymentDiscount:{...x.earlyPaymentDiscount,discountType:h}}),children:[e.jsx(Ne,{id:"discount-type",children:e.jsx(Ee,{placeholder:"Selecione o tipo de desconto"})}),e.jsxs(Ie,{children:[e.jsx(_e,{value:"fixed",children:"Valor fixo (R$)"}),e.jsx(_e,{value:"percentage",children:"Porcentagem (%)"})]})]})]}),e.jsxs("div",{children:[e.jsx(me,{htmlFor:"discount-value",children:((c=x.earlyPaymentDiscount)==null?void 0:c.discountType)==="percentage"?"Porcentagem de Desconto":"Valor do Desconto"}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{id:"discount-value",type:"number",min:"0",step:((o=x.earlyPaymentDiscount)==null?void 0:o.discountType)==="percentage"?"0.01":"1",placeholder:((v=x.earlyPaymentDiscount)==null?void 0:v.discountType)==="percentage"?"5":"10",value:((w=x.earlyPaymentDiscount)==null?void 0:w.discountValue)||"",onChange:h=>A({earlyPaymentDiscount:{...x.earlyPaymentDiscount,discountValue:parseFloat(h.target.value)}}),className:"pl-8"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:((C=x.earlyPaymentDiscount)==null?void 0:C.discountType)==="percentage"?"%":"R$"})]})]}),e.jsx(er,{variant:"default",className:"bg-amber-50 border-amber-200 text-amber-800",children:e.jsx(tr,{children:"A utilização do desconto requer aprovação em Assembleia e outras questões legais. Verifique antes de aplicá-lo nas cobranças do Condomínio."})})]})]})]})};function gr({billingData:x,updateBillingData:A,nextStep:g}){var F,ne;const{toast:P}=Me(),[b,d]=oe.useState(!1),[i,n]=oe.useState("gas"),[l,j]=oe.useState([]),[k,y]=oe.useState(null),[_,s]=oe.useState(null),[m,a]=oe.useState([]),[c,o]=oe.useState([]),[v,w]=oe.useState(0),C=oe.useRef({}),[h,U]=oe.useState(null),[S,T]=oe.useState({start_date:((F=x.statementPeriod)==null?void 0:F.startDate)||"",end_date:((ne=x.statementPeriod)==null?void 0:ne.endDate)||""});oe.useEffect(()=>{var N,M;if(((N=x.reference)==null?void 0:N.month)!==void 0&&((M=x.reference)==null?void 0:M.year)!==void 0){const ee=x.reference.year,ie=x.reference.month,re=new Date(ee,ie,1),ae=new Date(ee,ie+1,0),te=de=>{const le=de.getFullYear(),he=String(de.getMonth()+1).padStart(2,"0"),t=String(de.getDate()).padStart(2,"0");return`${le}-${he}-${t}`};if(!x.periodManuallyEdited){const de=te(re),le=te(ae);T({start_date:de,end_date:le}),A({periodAutoSet:!0})}}},[x.reference,x.periodManuallyEdited]),oe.useEffect(()=>{I(),V()},[]),oe.useEffect(()=>{v>0&&f()},[v]),oe.useEffect(()=>{l.length>0&&(k||_)&&!v&&f()},[l,k,_]);const I=async()=>{try{const{data:N,error:M}=await ve.from("units").select("id, block, number").order("block").order("number");if(M)throw M;j(N||[])}catch(N){console.error("Error loading units:",N),P({title:"Erro ao carregar unidades",description:"Não foi possível carregar a lista de unidades."})}},V=async()=>{try{const{data:N,error:M}=await ve.from("utility_rates").select("*").eq("utility_type","gas").order("effective_date",{ascending:!1}).limit(1);if(M)throw M;if(N.length>0){const re={...N[0],utility_type:N[0].utility_type};y(re)}const{data:ee,error:ie}=await ve.from("utility_rates").select("*").eq("utility_type","water").order("effective_date",{ascending:!1}).limit(1);if(ie)throw ie;if(ee.length>0){const re={...ee[0],utility_type:ee[0].utility_type};s(re)}}catch(N){console.error("Error loading rates:",N),P({title:"Erro ao carregar taxas",description:"Não foi possível carregar as taxas atuais."})}},O=async(N,M)=>{if(!S.start_date||!S.end_date)return{previous:null,current:null};const ee=`${N}-${M}-${S.start_date}-${S.end_date}`;if(C.current[ee])return C.current[ee];try{const{data:ie,error:re}=await ve.from("meter_readings").select("*").eq("unit_id",N).eq("utility_type",M).lt("reading_date",S.start_date).order("reading_date",{ascending:!1}).limit(1);if(re)throw re;let ae=null;if(ie.length>0)ae={...ie[0],utility_type:ie[0].utility_type};else{const{data:t,error:Z}=await ve.from("meter_readings").select("*").eq("unit_id",N).eq("utility_type",M).order("reading_date",{ascending:!0}).limit(1);!Z&&t.length>0&&(ae={...t[0],utility_type:t[0].utility_type},console.log(`Usando leitura inicial como anterior para ${M} da unidade ${N}:`,ae))}const{data:te,error:de}=await ve.from("meter_readings").select("*").eq("unit_id",N).eq("utility_type",M).lte("reading_date",S.end_date).order("reading_date",{ascending:!1}).limit(1);if(de)throw de;const le=te.length>0?{...te[0],utility_type:te[0].utility_type}:null;if(ae&&le&&ae.id===le.id)console.log(`Leitura anterior e atual são iguais para ${M} da unidade ${N}, considerando sem leitura anterior`),ae=null;else if(ae&&le&&ae.reading_value===le.reading_value&&ae.reading_date===le.reading_date){const t=new Date(ae.created_at||ae.updated_at||""),Z=new Date,$=new Date(Z.getTime()-5*60*1e3);t>$?console.log(`Leitura anterior foi adicionada recentemente para ${M} da unidade ${N}, mantendo como leitura anterior`):(console.log(`Leituras com mesmo valor e data para ${M} da unidade ${N}, considerando sem leitura anterior`),ae=null)}const he={previous:ae,current:le};return C.current[ee]=he,he}catch(ie){return console.error(`Error fetching readings for unit ${N}:`,ie),{previous:null,current:null}}},f=async()=>{if(!S.start_date||!S.end_date){const N=new Date,M=new Date(N.getFullYear(),N.getMonth(),1),ee=new Date(N.getFullYear(),N.getMonth()+1,0),ie=M.toISOString().split("T")[0],re=ee.toISOString().split("T")[0];console.log(`Período não definido. Usando período padrão: ${ie} a ${re}`),T({start_date:ie,end_date:re}),A({statementPeriod:{startDate:ie,endDate:re}})}d(!0);try{console.log("Limpando cache de leituras para recalcular consumo"),C.current={},await new Promise(te=>setTimeout(te,500));const N=l.map(async te=>{const{previous:de,current:le}=await O(te.id,"gas");let he=null,t=null;return de&&le&&k&&(le.reading_value>=de.reading_value?(he=le.reading_value-de.reading_value,t=he*k.rate_per_cubic_meter):(console.warn(`Leitura atual de gás (${le.reading_value}) é menor que a anterior (${de.reading_value}) para unidade ${te.id}`),he=0,t=0,P({title:"Aviso",description:`A leitura atual de gás para a unidade ${te.block}-${te.number} é menor que a anterior. O consumo foi considerado como zero.`}))),{unit_id:te.id,unit_name:`${te.block}-${te.number}`,utility_type:"gas",previous_reading:de,current_reading:le,consumption:he,rate:(k==null?void 0:k.rate_per_cubic_meter)||0,total:t}}),M=l.map(async te=>{const{previous:de,current:le}=await O(te.id,"water");let he=null,t=null;return de&&le&&_&&(le.reading_value>=de.reading_value?(he=le.reading_value-de.reading_value,t=he*_.rate_per_cubic_meter):(console.warn(`Leitura atual de água (${le.reading_value}) é menor que a anterior (${de.reading_value}) para unidade ${te.id}`),he=0,t=0,P({title:"Aviso",description:`A leitura atual de água para a unidade ${te.block}-${te.number} é menor que a anterior. O consumo foi considerado como zero.`}))),{unit_id:te.id,unit_name:`${te.block}-${te.number}`,utility_type:"water",previous_reading:de,current_reading:le,consumption:he,rate:(_==null?void 0:_.rate_per_cubic_meter)||0,total:t}}),ee=await Promise.all(N),ie=await Promise.all(M);a(ee),o(ie);const re=ee.filter(te=>te.consumption!==null&&te.total!==null&&te.total>0).map(te=>({id:`gas-${te.unit_id}`,description:`Consumo de Gás - Unidade ${te.unit_name}`,value:te.total,unit:te.unit_id.toString(),category:"consumo"})),ae=ie.filter(te=>te.consumption!==null&&te.total!==null&&te.total>0).map(te=>({id:`water-${te.unit_id}`,description:`Consumo de Água - Unidade ${te.unit_name}`,value:te.total,unit:te.unit_id.toString(),category:"consumo"}));A({statementPeriod:{startDate:S.start_date,endDate:S.end_date},consumptionPeriod:S,gasConsumptionData:ee,waterConsumptionData:ie,gasConsumptionItems:re,waterConsumptionItems:ae}),P({title:"Consumo calculado com sucesso",description:`Foram calculados ${re.length} consumos de gás e ${ae.length} consumos de água.`})}catch(N){console.error("Error calculating consumption:",N),P({title:"Erro ao calcular consumo",description:"Ocorreu um erro ao calcular o consumo das unidades."})}finally{d(!1)}},z=N=>N===null?"-":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(N),r=N=>{if(!N)return"-";const M=new Date(N);return new Intl.DateTimeFormat("pt-BR").format(M)},B=N=>{A({includeGasConsumption:N})},W=N=>{A({includeWaterConsumption:N})},L=(N,M)=>{T(ee=>({...ee,[N]:M})),A({periodManuallyEdited:!0})},J=(N,M,ee,ie,re)=>{if(U({unitId:N,utilityType:M,readingType:ee,readingId:ie,value:re!==null?re.toString():""}),console.log("Iniciando edição de leitura:",{unitId:N,utilityType:M,readingType:ee,readingId:ie,currentValue:re}),!S.start_date||!S.end_date){const ae=new Date,te=new Date(ae.getFullYear(),ae.getMonth(),1),de=new Date(ae.getFullYear(),ae.getMonth()+1,0),le=te.toISOString().split("T")[0],he=de.toISOString().split("T")[0];console.log(`Definindo período padrão para edição: ${le} a ${he}`),T({start_date:le,end_date:he}),A({statementPeriod:{startDate:le,endDate:he}})}},G=async()=>{if(!h||!h.value||parseFloat(h.value)<0){P({title:"Valor inválido",description:"Por favor, insira um valor válido para a leitura."});return}d(!0);try{const N=parseFloat(h.value);let M;if(h.readingType==="previous"){const ie=S.start_date||new Date().toISOString().split("T")[0],re=new Date(ie);re.setDate(re.getDate()-1),M=re.toISOString().split("T")[0],console.log(`Usando data ajustada para leitura anterior: ${M} (baseada em ${ie})`)}else M=S.end_date||new Date().toISOString().split("T")[0];let ee=h.readingId;if(h.readingId){const{error:ie}=await ve.from("meter_readings").update({reading_value:N,updated_at:new Date().toISOString()}).eq("id",h.readingId);if(ie)throw ie;P({title:"Leitura atualizada com sucesso",description:"A leitura foi atualizada e os cálculos serão refeitos."})}else{console.log("Inserindo nova leitura:",{unit_id:h.unitId,utility_type:h.utilityType,reading_value:N,reading_date:M});const{data:ie,error:re}=await ve.from("meter_readings").insert([{unit_id:h.unitId,utility_type:h.utilityType,reading_value:N,reading_date:M,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select();if(re)throw console.error("Erro ao inserir leitura:",re),re;ie&&ie.length>0&&(ee=ie[0].id,console.log("Nova leitura inserida com ID:",ee)),P({title:"Leitura salva com sucesso",description:"A leitura foi registrada e será usada para os cálculos."})}C.current={},U(null),w(ie=>ie+1),await f(),A({gasConsumptionData:m,waterConsumptionData:c,includeGasConsumption:x.includeGasConsumption,includeWaterConsumption:x.includeWaterConsumption,consumptionPeriod:S})}catch(N){console.error("Erro ao salvar leitura:",N),P({title:"Erro ao salvar leitura",description:"Não foi possível salvar a leitura."})}finally{d(!1)}},K=()=>{U(null)},R=()=>{const N=x.includeGasConsumption&&m.some(ee=>ee.consumption!==null&&ee.total!==null),M=x.includeWaterConsumption&&c.some(ee=>ee.consumption!==null&&ee.total!==null);if(!N&&!M){P({title:"Nenhum consumo calculado",description:"Calcule o consumo antes de avançar para o próximo passo."});return}A({gasConsumptionData:m,waterConsumptionData:c,includeGasConsumption:x.includeGasConsumption,includeWaterConsumption:x.includeWaterConsumption,consumptionPeriod:S}),g&&g()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Período de Leitura"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(me,{htmlFor:"start-date",children:"Data Inicial"}),e.jsx("input",{id:"start-date",type:"date",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:S.start_date,onChange:N=>L("start_date",N.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Padrão: Primeiro dia do mês de referência"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(me,{htmlFor:"end-date",children:"Data Final"}),e.jsx("input",{id:"end-date",type:"date",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:S.end_date,onChange:N=>L("end_date",N.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Padrão: Último dia do mês de referência"})]})]}),e.jsx(ue,{onClick:f,disabled:b||!S.start_date||!S.end_date,children:b?"Calculando...":"Calcular Consumo"})]}),e.jsxs(bt,{value:i,onValueChange:N=>n(N),children:[e.jsxs(wt,{className:"grid w-full grid-cols-2",children:[e.jsx(Te,{value:"gas",children:"Consumo de Gás"}),e.jsx(Te,{value:"water",children:"Consumo de Água"})]}),e.jsxs(Oe,{value:"gas",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Le,{id:"include-gas-consumption",checked:x.includeGasConsumption,onCheckedChange:N=>B(!!N)}),e.jsx(me,{htmlFor:"include-gas-consumption",children:"Incluir consumo de gás no faturamento"})]}),e.jsx(ze,{children:e.jsx(Fe,{className:"p-0",children:e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(we,{children:[e.jsx(ge,{children:"Unidade"}),e.jsx(ge,{children:"Leitura Anterior"}),e.jsx(ge,{children:"Leitura Atual"}),e.jsx(ge,{children:"Consumo (m³)"}),e.jsx(ge,{children:"Valor (R$/m³)"}),e.jsx(ge,{children:"Total"})]})}),e.jsx(Qe,{children:m.length===0?e.jsx(we,{children:e.jsx(fe,{colSpan:6,className:"text-center py-4 text-muted-foreground",children:"Nenhuma unidade encontrada ou período não definido."})}):m.map(N=>e.jsxs(we,{children:[e.jsx(fe,{children:N.unit_name}),e.jsx(fe,{children:h&&h.unitId===N.unit_id&&h.utilityType==="gas"&&h.readingType==="previous"?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(ye,{type:"number",step:"0.001",placeholder:"Valor da leitura",value:h.value,onChange:M=>U({...h,value:M.target.value}),className:"w-32"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(ue,{size:"sm",variant:"outline",onClick:G,disabled:b,children:"Salvar"}),e.jsx(ue,{size:"sm",variant:"ghost",onClick:K,disabled:b,children:"Cancelar"})]})]}):N.previous_reading?e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{children:[N.previous_reading.reading_value," m³"]}),e.jsx(ue,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{var M,ee;return J(N.unit_id,"gas","previous",((M=N.previous_reading)==null?void 0:M.id)||null,((ee=N.previous_reading)==null?void 0:ee.reading_value)||null)},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"})})})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[r(N.previous_reading.reading_date),N.current_reading&&N.previous_reading.reading_date===N.current_reading.reading_date?e.jsx("span",{className:"ml-1 text-blue-600 font-medium",children:"(Leitura Inicial)"}):""]})]}):e.jsxs("button",{className:"text-amber-600 hover:text-amber-800 hover:underline focus:outline-none",onClick:()=>J(N.unit_id,"gas","previous",null,null),children:["Sem leitura anterior",e.jsx("div",{className:"text-xs",children:"Clique para adicionar"})]})}),e.jsx(fe,{children:h&&h.unitId===N.unit_id&&h.utilityType==="gas"&&h.readingType==="current"?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(ye,{type:"number",step:"0.001",placeholder:"Valor da leitura",value:h.value,onChange:M=>U({...h,value:M.target.value}),className:"w-32"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(ue,{size:"sm",variant:"outline",onClick:G,disabled:b,children:"Salvar"}),e.jsx(ue,{size:"sm",variant:"ghost",onClick:K,disabled:b,children:"Cancelar"})]})]}):N.current_reading?e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{children:[N.current_reading.reading_value," m³"]}),e.jsx(ue,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{var M,ee;return J(N.unit_id,"gas","current",((M=N.current_reading)==null?void 0:M.id)||null,((ee=N.current_reading)==null?void 0:ee.reading_value)||null)},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"})})})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:r(N.current_reading.reading_date)})]}):e.jsxs("button",{className:"text-amber-600 hover:text-amber-800 hover:underline focus:outline-none",onClick:()=>J(N.unit_id,"gas","current",null,null),children:["Sem leitura",e.jsx("div",{className:"text-xs",children:"Clique para adicionar"})]})}),e.jsx(fe,{children:N.consumption!==null?e.jsx("span",{children:N.consumption.toFixed(3)}):e.jsx("span",{className:"text-amber-600",children:"-"})}),e.jsx(fe,{children:N.rate.toFixed(2)}),e.jsx(fe,{children:N.total!==null?e.jsx("span",{className:"font-medium",children:z(N.total)}):e.jsx("span",{className:"text-amber-600",children:"-"})})]},`gas-${N.unit_id}`))})]})})})]}),e.jsxs(Oe,{value:"water",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Le,{id:"include-water-consumption",checked:x.includeWaterConsumption,onCheckedChange:N=>W(!!N)}),e.jsx(me,{htmlFor:"include-water-consumption",children:"Incluir consumo de água no faturamento"})]}),e.jsx(ze,{children:e.jsx(Fe,{className:"p-0",children:e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(we,{children:[e.jsx(ge,{children:"Unidade"}),e.jsx(ge,{children:"Leitura Anterior"}),e.jsx(ge,{children:"Leitura Atual"}),e.jsx(ge,{children:"Consumo (m³)"}),e.jsx(ge,{children:"Valor (R$/m³)"}),e.jsx(ge,{children:"Total"})]})}),e.jsx(Qe,{children:c.length===0?e.jsx(we,{children:e.jsx(fe,{colSpan:6,className:"text-center py-4 text-muted-foreground",children:"Nenhuma unidade encontrada ou período não definido."})}):c.map(N=>e.jsxs(we,{children:[e.jsx(fe,{children:N.unit_name}),e.jsx(fe,{children:h&&h.unitId===N.unit_id&&h.utilityType==="water"&&h.readingType==="previous"?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(ye,{type:"number",step:"0.001",placeholder:"Valor da leitura",value:h.value,onChange:M=>U({...h,value:M.target.value}),className:"w-32"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(ue,{size:"sm",variant:"outline",onClick:G,disabled:b,children:"Salvar"}),e.jsx(ue,{size:"sm",variant:"ghost",onClick:K,disabled:b,children:"Cancelar"})]})]}):N.previous_reading?e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{children:[N.previous_reading.reading_value," m³"]}),e.jsx(ue,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{var M,ee;return J(N.unit_id,"water","previous",((M=N.previous_reading)==null?void 0:M.id)||null,((ee=N.previous_reading)==null?void 0:ee.reading_value)||null)},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"})})})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[r(N.previous_reading.reading_date),N.current_reading&&N.previous_reading.reading_date===N.current_reading.reading_date?e.jsx("span",{className:"ml-1 text-blue-600 font-medium",children:"(Leitura Inicial)"}):""]})]}):e.jsxs("button",{className:"text-amber-600 hover:text-amber-800 hover:underline focus:outline-none",onClick:()=>J(N.unit_id,"water","previous",null,null),children:["Sem leitura anterior",e.jsx("div",{className:"text-xs",children:"Clique para adicionar"})]})}),e.jsx(fe,{children:h&&h.unitId===N.unit_id&&h.utilityType==="water"&&h.readingType==="current"?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(ye,{type:"number",step:"0.001",placeholder:"Valor da leitura",value:h.value,onChange:M=>U({...h,value:M.target.value}),className:"w-32"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(ue,{size:"sm",variant:"outline",onClick:G,disabled:b,children:"Salvar"}),e.jsx(ue,{size:"sm",variant:"ghost",onClick:K,disabled:b,children:"Cancelar"})]})]}):N.current_reading?e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{children:[N.current_reading.reading_value," m³"]}),e.jsx(ue,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{var M,ee;return J(N.unit_id,"water","current",((M=N.current_reading)==null?void 0:M.id)||null,((ee=N.current_reading)==null?void 0:ee.reading_value)||null)},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"})})})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:r(N.current_reading.reading_date)})]}):e.jsxs("button",{className:"text-amber-600 hover:text-amber-800 hover:underline focus:outline-none",onClick:()=>J(N.unit_id,"water","current",null,null),children:["Sem leitura",e.jsx("div",{className:"text-xs",children:"Clique para adicionar"})]})}),e.jsx(fe,{children:N.consumption!==null?e.jsx("span",{children:N.consumption.toFixed(3)}):e.jsx("span",{className:"text-amber-600",children:"-"})}),e.jsx(fe,{children:N.rate.toFixed(2)}),e.jsx(fe,{children:N.total!==null?e.jsx("span",{className:"font-medium",children:z(N.total)}):e.jsx("span",{className:"text-amber-600",children:"-"})})]},`water-${N.unit_id}`))})]})})})]})]}),(x.includeGasConsumption||x.includeWaterConsumption)&&e.jsxs("div",{className:"p-4 border rounded-lg bg-green-50 dark:bg-green-900/20 flex items-center space-x-2",children:[e.jsx(jt,{className:"h-5 w-5 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-green-800 dark:text-green-400",children:"Consumo selecionado será incluído automaticamente no faturamento."})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(ue,{onClick:R,disabled:b,children:"Avançar"})})]})}const St=oe.forwardRef(({className:x,...A},g)=>e.jsx("textarea",{className:Rt("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",x),ref:g,...A}));St.displayName="Textarea";const xr=({billingData:x,updateBillingData:A,nextStep:g,prevStep:P})=>{var f,z,r,B;const{toast:b}=Me(),[d,i]=oe.useState([]),[n,l]=oe.useState([]),[j,k]=oe.useState(!0),[y,_]=oe.useState(x.selectedBillings||[]),[s,m]=oe.useState(!1),[a,c]=oe.useState([]),[o,v]=oe.useState([]),[w,C]=oe.useState({unit:"",unit_id:0,resident:"",resident_id:0,description:"",amount:0,dueDate:new Date().toISOString(),category:"taxa"});oe.useEffect(()=>{(async()=>{try{k(!0),console.log("Iniciando carregamento de cobranças existentes...");try{console.log("Tentando usar fetchBillings...");const G=await Yt();if(console.log("Cobranças carregadas via fetchBillings:",G),G&&G.length>0){i(G);const K=G.filter(R=>R.status==="pending"||R.status==="overdue");l(K),console.log("Cobranças filtradas:",K),k(!1);return}else console.log("Nenhuma cobrança retornada por fetchBillings, tentando buscar diretamente do Supabase...")}catch(G){console.error("Erro ao usar fetchBillings:",G),console.log("Tentando buscar cobranças diretamente do Supabase...")}const{data:L,error:J}=await ve.from("billings").select("*").or("status.eq.pending,status.eq.overdue");if(J)throw J;if(console.log("Cobranças carregadas diretamente do Supabase:",L),L){const G=L.map(K=>({id:K.id,unit:K.unit,unit_id:K.unit_id,resident:K.resident,description:K.description,amount:K.amount,dueDate:K.due_date,status:K.status,isPrinted:K.is_printed,isSent:K.is_sent}));i(G),l(G),console.log("Cobranças formatadas:",G)}else i([]),l([]),console.log("Nenhuma cobrança encontrada")}catch(L){console.error("Erro ao carregar cobranças existentes:",L),b({title:"Erro",description:"Erro ao carregar cobranças existentes",variant:"destructive"}),i([]),l([])}finally{k(!1)}})()},[b]),oe.useEffect(()=>{(async()=>{try{console.log("Carregando unidades e residentes...");const{data:L,error:J}=await ve.from("units").select("id, block, number").order("block").order("number");if(J)throw J;console.log("Unidades carregadas:",L),c(L||[]);const{data:G,error:K}=await ve.from("residents").select("id, name, unit_id").order("name");if(K)throw K;console.log("Residentes carregados:",G),v(G||[])}catch(L){console.error("Erro ao carregar unidades e residentes:",L),b({title:"Erro",description:"Erro ao carregar unidades e residentes",variant:"destructive"})}})()},[b]),oe.useEffect(()=>{console.log("Atualizando billingData com selectedBillings:",y),A({selectedBillings:y})},[y,A]);const h=(W,L)=>{L&&(console.log(`Alterando ${W} para:`,L),W==="startDate"?A({statementPeriod:{...x.statementPeriod,startDate:L}}):W==="endDate"&&A({statementPeriod:{...x.statementPeriod,endDate:L}}))},U=W=>{console.log("Selecionando/desselecionando cobrança:",W),_(L=>L.includes(W)?L.filter(J=>J!==W):[...L,W])},S=()=>{console.log("Selecionando/desselecionando todas as cobranças"),y.length===n.length?_([]):_(n.map(W=>W.id))},T=W=>{console.log("Unidade selecionada:",W);const L=parseInt(W);if(C({...w,unit:W,unit_id:L}),!isNaN(L)){const J=a.find(G=>G.id===L);if(J){const G=o.find(K=>K.unit_id===L);G?(console.log("Residente encontrado para a unidade:",G),C(K=>({...K,resident:G.name,resident_id:G.id}))):(console.log("Nenhum residente encontrado para a unidade"),C(K=>({...K,resident:`Proprietário ${J.block}-${J.number}`,resident_id:0})))}}},I=async()=>{console.log("Criando nova cobrança:",w);try{if(!w.unit_id||!w.description||!w.dueDate){b({title:"Erro",description:"Por favor, preencha todos os campos obrigatórios",variant:"destructive"});return}if(!w.amount||w.amount<=0){b({title:"Erro",description:"Por favor, informe um valor válido",variant:"destructive"});return}const W={...w,status:"pending"};console.log("Dados da cobrança a ser criada:",W);try{const L=await Xt(W);console.log("Cobrança criada com sucesso:",L),i(J=>[...J,L]),l(J=>[...J,L])}catch(L){console.error("Erro ao usar createBilling:",L),console.log("Tentando criar cobrança diretamente no Supabase...");const J=a.find(F=>F.id===w.unit_id),G=J?`${J.block}-${J.number}`:w.unit,{data:K,error:R}=await ve.from("billings").insert([{unit:G,unit_id:w.unit_id,resident:w.resident,description:w.description,amount:w.amount,due_date:w.dueDate,status:"pending",is_printed:!1,is_sent:!1,category:w.category}]).select();if(R)throw R;if(console.log("Cobrança criada diretamente no Supabase:",K),K&&K.length>0){const F={id:K[0].id,unit:K[0].unit,unit_id:K[0].unit_id,resident:K[0].resident,description:K[0].description,amount:K[0].amount,dueDate:K[0].due_date,status:K[0].status,isPrinted:K[0].is_printed,isSent:K[0].is_sent};i(ne=>[...ne,F]),l(ne=>[...ne,F])}}C({unit:"",unit_id:0,resident:"",resident_id:0,description:"",amount:0,dueDate:new Date().toISOString(),category:"taxa"}),m(!1),b({title:"Sucesso",description:"Cobrança criada com sucesso!"})}catch(W){console.error("Erro ao criar nova cobrança:",W),b({title:"Erro",description:"Erro ao criar nova cobrança",variant:"destructive"})}},V=W=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(W),O=W=>W?je(new Date(W),"dd/MM/yyyy",{locale:Ae}):"";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Período de Exibição do Balancete"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Define o período a ser considerado no balancete que acompanha o boleto."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(me,{htmlFor:"statement-start-date",children:"Data Inicial"}),e.jsxs(qe,{children:[e.jsx(He,{asChild:!0,children:e.jsxs(ue,{variant:"outline",className:"w-full justify-start text-left font-normal",id:"statement-start-date",children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),(f=x.statementPeriod)!=null&&f.startDate?je(new Date(x.statementPeriod.startDate),"dd 'de' MMMM 'de' yyyy",{locale:Ae}):e.jsx("span",{children:"Selecione a data inicial"})]})}),e.jsx(Ye,{className:"w-auto p-0",children:e.jsx(et,{mode:"single",selected:(z=x.statementPeriod)!=null&&z.startDate?new Date(x.statementPeriod.startDate):void 0,onSelect:W=>h("startDate",W),initialFocus:!0})})]})]}),e.jsxs("div",{children:[e.jsx(me,{htmlFor:"statement-end-date",children:"Data Final"}),e.jsxs(qe,{children:[e.jsx(He,{asChild:!0,children:e.jsxs(ue,{variant:"outline",className:"w-full justify-start text-left font-normal",id:"statement-end-date",children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),(r=x.statementPeriod)!=null&&r.endDate?je(new Date(x.statementPeriod.endDate),"dd 'de' MMMM 'de' yyyy",{locale:Ae}):e.jsx("span",{children:"Selecione a data final"})]})}),e.jsx(Ye,{className:"w-auto p-0",children:e.jsx(et,{mode:"single",selected:(B=x.statementPeriod)!=null&&B.endDate?new Date(x.statementPeriod.endDate):void 0,onSelect:W=>h("endDate",W),initialFocus:!0})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Itens de Cobrança"}),e.jsxs(it,{open:s,onOpenChange:m,children:[e.jsx(Mt,{asChild:!0,children:e.jsxs(ue,{className:"gap-2",children:[e.jsx(Ht,{size:16}),"Adicionar Cobrança"]})}),e.jsxs(ot,{className:"sm:max-w-[500px]",children:[e.jsxs(dt,{children:[e.jsx(lt,{children:"Nova Cobrança"}),e.jsx(ct,{children:"Adicione uma nova cobrança ao faturamento. Esta cobrança também será adicionada à página de Cobranças."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(me,{htmlFor:"unit",children:"Unidade"}),e.jsxs(Se,{value:w.unit,onValueChange:T,children:[e.jsx(Ne,{id:"unit",children:e.jsx(Ee,{placeholder:"Selecione uma unidade"})}),e.jsx(Ie,{children:a.map(W=>e.jsx(_e,{value:W.id.toString(),children:`${W.block}${W.number}`},W.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(me,{htmlFor:"resident",children:"Morador"}),e.jsx(ye,{id:"resident",value:w.resident,onChange:W=>C({...w,resident:W.target.value}),placeholder:"Nome do morador"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(me,{htmlFor:"description",children:"Descrição"}),e.jsx(ye,{id:"description",value:w.description,onChange:W=>C({...w,description:W.target.value}),placeholder:"Ex: Taxa de Condomínio - Janeiro/2024"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(me,{htmlFor:"amount",children:"Valor (R$)"}),e.jsx(ye,{id:"amount",type:"text",value:w.amount,onChange:W=>C({...w,amount:W.target.value}),placeholder:"0,00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(me,{htmlFor:"dueDate",children:"Data de Vencimento"}),e.jsx(ye,{id:"dueDate",type:"date",value:w.dueDate,onChange:W=>C({...w,dueDate:W.target.value})})]})]})]}),e.jsxs(ut,{children:[e.jsx(ue,{variant:"outline",onClick:()=>m(!1),children:"Cancelar"}),e.jsx(ue,{onClick:I,children:"Adicionar Cobrança"})]})]})]})]}),e.jsxs(ze,{children:[e.jsxs(tt,{className:"pb-3",children:[e.jsx(rt,{children:"Cobranças Existentes"}),e.jsx(nt,{children:"Selecione as cobranças que deseja incluir no faturamento."})]}),e.jsx(Fe,{children:j?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):n.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-center p-4",children:[e.jsx(Kt,{className:"h-8 w-8 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhuma cobrança pendente ou atrasada encontrada."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(ue,{variant:"outline",size:"sm",onClick:S,children:y.length===n.length?"Desmarcar Todas":"Selecionar Todas"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[y.length," de ",n.length," cobranças selecionadas"]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(Xe,{children:[e.jsx(Je,{children:e.jsxs(we,{children:[e.jsx(ge,{className:"w-[50px]"}),e.jsx(ge,{children:"Unidade"}),e.jsx(ge,{children:"Morador"}),e.jsx(ge,{children:"Descrição"}),e.jsx(ge,{children:"Vencimento"}),e.jsx(ge,{className:"text-right",children:"Valor"})]})}),e.jsx(Qe,{children:n.map(W=>e.jsxs(we,{className:y.includes(W.id)?"bg-muted/50":"",children:[e.jsx(fe,{children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("button",{className:`h-5 w-5 rounded border ${y.includes(W.id)?"bg-primary border-primary text-primary-foreground":"border-input"}`,onClick:()=>U(W.id),children:y.includes(W.id)&&e.jsx(yt,{className:"h-3.5 w-3.5"})})})}),e.jsx(fe,{children:W.unit}),e.jsx(fe,{children:W.resident}),e.jsx(fe,{children:W.description}),e.jsx(fe,{children:O(W.dueDate)}),e.jsx(fe,{className:"text-right font-medium",children:V(W.amount)})]},W.id))})]})}),y.length>0&&e.jsx("div",{className:"mt-4 p-4 bg-muted rounded-md",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Total selecionado:"}),e.jsx("span",{className:"font-bold text-lg",children:V(n.filter(W=>y.includes(W.id)).reduce((W,L)=>W+L.amount,0))})]})})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(me,{htmlFor:"notes",children:"Observações (opcional)"}),e.jsx(St,{id:"notes",placeholder:"Adicione observações que aparecerão no boleto...",value:x.notes||"",onChange:W=>A({notes:W.target.value}),className:"min-h-[100px]"})]})]})};function Ve(x){throw new Error('Could not dynamically require "'+x+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Nt={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(x,A){(function(g){x.exports=g()})(function(){return function g(P,b,d){function i(j,k){if(!b[j]){if(!P[j]){var y=typeof Ve=="function"&&Ve;if(!k&&y)return y(j,!0);if(n)return n(j,!0);var _=new Error("Cannot find module '"+j+"'");throw _.code="MODULE_NOT_FOUND",_}var s=b[j]={exports:{}};P[j][0].call(s.exports,function(m){var a=P[j][1][m];return i(a||m)},s,s.exports,g,P,b,d)}return b[j].exports}for(var n=typeof Ve=="function"&&Ve,l=0;l<d.length;l++)i(d[l]);return i}({1:[function(g,P,b){var d=g("./utils"),i=g("./support"),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";b.encode=function(l){for(var j,k,y,_,s,m,a,c=[],o=0,v=l.length,w=v,C=d.getTypeOf(l)!=="string";o<l.length;)w=v-o,y=C?(j=l[o++],k=o<v?l[o++]:0,o<v?l[o++]:0):(j=l.charCodeAt(o++),k=o<v?l.charCodeAt(o++):0,o<v?l.charCodeAt(o++):0),_=j>>2,s=(3&j)<<4|k>>4,m=1<w?(15&k)<<2|y>>6:64,a=2<w?63&y:64,c.push(n.charAt(_)+n.charAt(s)+n.charAt(m)+n.charAt(a));return c.join("")},b.decode=function(l){var j,k,y,_,s,m,a=0,c=0,o="data:";if(l.substr(0,o.length)===o)throw new Error("Invalid base64 input, it looks like a data url.");var v,w=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===n.charAt(64)&&w--,l.charAt(l.length-2)===n.charAt(64)&&w--,w%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=i.uint8array?new Uint8Array(0|w):new Array(0|w);a<l.length;)j=n.indexOf(l.charAt(a++))<<2|(_=n.indexOf(l.charAt(a++)))>>4,k=(15&_)<<4|(s=n.indexOf(l.charAt(a++)))>>2,y=(3&s)<<6|(m=n.indexOf(l.charAt(a++))),v[c++]=j,s!==64&&(v[c++]=k),m!==64&&(v[c++]=y);return v}},{"./support":30,"./utils":32}],2:[function(g,P,b){var d=g("./external"),i=g("./stream/DataWorker"),n=g("./stream/Crc32Probe"),l=g("./stream/DataLengthProbe");function j(k,y,_,s,m){this.compressedSize=k,this.uncompressedSize=y,this.crc32=_,this.compression=s,this.compressedContent=m}j.prototype={getContentWorker:function(){var k=new i(d.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),y=this;return k.on("end",function(){if(this.streamInfo.data_length!==y.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),k},getCompressedWorker:function(){return new i(d.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},j.createWorkerFrom=function(k,y,_){return k.pipe(new n).pipe(new l("uncompressedSize")).pipe(y.compressWorker(_)).pipe(new l("compressedSize")).withStreamInfo("compression",y)},P.exports=j},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(g,P,b){var d=g("./stream/GenericWorker");b.STORE={magic:"\0\0",compressWorker:function(){return new d("STORE compression")},uncompressWorker:function(){return new d("STORE decompression")}},b.DEFLATE=g("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(g,P,b){var d=g("./utils"),i=function(){for(var n,l=[],j=0;j<256;j++){n=j;for(var k=0;k<8;k++)n=1&n?3988292384^n>>>1:n>>>1;l[j]=n}return l}();P.exports=function(n,l){return n!==void 0&&n.length?d.getTypeOf(n)!=="string"?function(j,k,y,_){var s=i,m=_+y;j^=-1;for(var a=_;a<m;a++)j=j>>>8^s[255&(j^k[a])];return-1^j}(0|l,n,n.length,0):function(j,k,y,_){var s=i,m=_+y;j^=-1;for(var a=_;a<m;a++)j=j>>>8^s[255&(j^k.charCodeAt(a))];return-1^j}(0|l,n,n.length,0):0}},{"./utils":32}],5:[function(g,P,b){b.base64=!1,b.binary=!1,b.dir=!1,b.createFolders=!0,b.date=null,b.compression=null,b.compressionOptions=null,b.comment=null,b.unixPermissions=null,b.dosPermissions=null},{}],6:[function(g,P,b){var d=null;d=typeof Promise<"u"?Promise:g("lie"),P.exports={Promise:d}},{lie:37}],7:[function(g,P,b){var d=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",i=g("pako"),n=g("./utils"),l=g("./stream/GenericWorker"),j=d?"uint8array":"array";function k(y,_){l.call(this,"FlateWorker/"+y),this._pako=null,this._pakoAction=y,this._pakoOptions=_,this.meta={}}b.magic="\b\0",n.inherits(k,l),k.prototype.processChunk=function(y){this.meta=y.meta,this._pako===null&&this._createPako(),this._pako.push(n.transformTo(j,y.data),!1)},k.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},k.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},k.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var y=this;this._pako.onData=function(_){y.push({data:_,meta:y.meta})}},b.compressWorker=function(y){return new k("Deflate",y)},b.uncompressWorker=function(){return new k("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(g,P,b){function d(s,m){var a,c="";for(a=0;a<m;a++)c+=String.fromCharCode(255&s),s>>>=8;return c}function i(s,m,a,c,o,v){var w,C,h=s.file,U=s.compression,S=v!==j.utf8encode,T=n.transformTo("string",v(h.name)),I=n.transformTo("string",j.utf8encode(h.name)),V=h.comment,O=n.transformTo("string",v(V)),f=n.transformTo("string",j.utf8encode(V)),z=I.length!==h.name.length,r=f.length!==V.length,B="",W="",L="",J=h.dir,G=h.date,K={crc32:0,compressedSize:0,uncompressedSize:0};m&&!a||(K.crc32=s.crc32,K.compressedSize=s.compressedSize,K.uncompressedSize=s.uncompressedSize);var R=0;m&&(R|=8),S||!z&&!r||(R|=2048);var F=0,ne=0;J&&(F|=16),o==="UNIX"?(ne=798,F|=function(M,ee){var ie=M;return M||(ie=ee?16893:33204),(65535&ie)<<16}(h.unixPermissions,J)):(ne=20,F|=function(M){return 63&(M||0)}(h.dosPermissions)),w=G.getUTCHours(),w<<=6,w|=G.getUTCMinutes(),w<<=5,w|=G.getUTCSeconds()/2,C=G.getUTCFullYear()-1980,C<<=4,C|=G.getUTCMonth()+1,C<<=5,C|=G.getUTCDate(),z&&(W=d(1,1)+d(k(T),4)+I,B+="up"+d(W.length,2)+W),r&&(L=d(1,1)+d(k(O),4)+f,B+="uc"+d(L.length,2)+L);var N="";return N+=`
\0`,N+=d(R,2),N+=U.magic,N+=d(w,2),N+=d(C,2),N+=d(K.crc32,4),N+=d(K.compressedSize,4),N+=d(K.uncompressedSize,4),N+=d(T.length,2),N+=d(B.length,2),{fileRecord:y.LOCAL_FILE_HEADER+N+T+B,dirRecord:y.CENTRAL_FILE_HEADER+d(ne,2)+N+d(O.length,2)+"\0\0\0\0"+d(F,4)+d(c,4)+T+B+O}}var n=g("../utils"),l=g("../stream/GenericWorker"),j=g("../utf8"),k=g("../crc32"),y=g("../signature");function _(s,m,a,c){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=a,this.encodeFileName=c,this.streamFiles=s,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}n.inherits(_,l),_.prototype.push=function(s){var m=s.meta.percent||0,a=this.entriesCount,c=this._sources.length;this.accumulate?this.contentBuffer.push(s):(this.bytesWritten+=s.data.length,l.prototype.push.call(this,{data:s.data,meta:{currentFile:this.currentFile,percent:a?(m+100*(a-c-1))/a:100}}))},_.prototype.openedSource=function(s){this.currentSourceOffset=this.bytesWritten,this.currentFile=s.file.name;var m=this.streamFiles&&!s.file.dir;if(m){var a=i(s,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:a.fileRecord,meta:{percent:0}})}else this.accumulate=!0},_.prototype.closedSource=function(s){this.accumulate=!1;var m=this.streamFiles&&!s.file.dir,a=i(s,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(a.dirRecord),m)this.push({data:function(c){return y.DATA_DESCRIPTOR+d(c.crc32,4)+d(c.compressedSize,4)+d(c.uncompressedSize,4)}(s),meta:{percent:100}});else for(this.push({data:a.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},_.prototype.flush=function(){for(var s=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var a=this.bytesWritten-s,c=function(o,v,w,C,h){var U=n.transformTo("string",h(C));return y.CENTRAL_DIRECTORY_END+"\0\0\0\0"+d(o,2)+d(o,2)+d(v,4)+d(w,4)+d(U.length,2)+U}(this.dirRecords.length,a,s,this.zipComment,this.encodeFileName);this.push({data:c,meta:{percent:100}})},_.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},_.prototype.registerPrevious=function(s){this._sources.push(s);var m=this;return s.on("data",function(a){m.processChunk(a)}),s.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),s.on("error",function(a){m.error(a)}),this},_.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},_.prototype.error=function(s){var m=this._sources;if(!l.prototype.error.call(this,s))return!1;for(var a=0;a<m.length;a++)try{m[a].error(s)}catch{}return!0},_.prototype.lock=function(){l.prototype.lock.call(this);for(var s=this._sources,m=0;m<s.length;m++)s[m].lock()},P.exports=_},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(g,P,b){var d=g("../compressions"),i=g("./ZipFileWorker");b.generateWorker=function(n,l,j){var k=new i(l.streamFiles,j,l.platform,l.encodeFileName),y=0;try{n.forEach(function(_,s){y++;var m=function(v,w){var C=v||w,h=d[C];if(!h)throw new Error(C+" is not a valid compression method !");return h}(s.options.compression,l.compression),a=s.options.compressionOptions||l.compressionOptions||{},c=s.dir,o=s.date;s._compressWorker(m,a).withStreamInfo("file",{name:_,dir:c,date:o,comment:s.comment||"",unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions}).pipe(k)}),k.entriesCount=y}catch(_){k.error(_)}return k}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(g,P,b){function d(){if(!(this instanceof d))return new d;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var i=new d;for(var n in this)typeof this[n]!="function"&&(i[n]=this[n]);return i}}(d.prototype=g("./object")).loadAsync=g("./load"),d.support=g("./support"),d.defaults=g("./defaults"),d.version="3.10.1",d.loadAsync=function(i,n){return new d().loadAsync(i,n)},d.external=g("./external"),P.exports=d},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(g,P,b){var d=g("./utils"),i=g("./external"),n=g("./utf8"),l=g("./zipEntries"),j=g("./stream/Crc32Probe"),k=g("./nodejsUtils");function y(_){return new i.Promise(function(s,m){var a=_.decompressed.getContentWorker().pipe(new j);a.on("error",function(c){m(c)}).on("end",function(){a.streamInfo.crc32!==_.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):s()}).resume()})}P.exports=function(_,s){var m=this;return s=d.extend(s||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:n.utf8decode}),k.isNode&&k.isStream(_)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):d.prepareContent("the loaded zip file",_,!0,s.optimizedBinaryString,s.base64).then(function(a){var c=new l(s);return c.load(a),c}).then(function(a){var c=[i.Promise.resolve(a)],o=a.files;if(s.checkCRC32)for(var v=0;v<o.length;v++)c.push(y(o[v]));return i.Promise.all(c)}).then(function(a){for(var c=a.shift(),o=c.files,v=0;v<o.length;v++){var w=o[v],C=w.fileNameStr,h=d.resolve(w.fileNameStr);m.file(h,w.decompressed,{binary:!0,optimizedBinaryString:!0,date:w.date,dir:w.dir,comment:w.fileCommentStr.length?w.fileCommentStr:null,unixPermissions:w.unixPermissions,dosPermissions:w.dosPermissions,createFolders:s.createFolders}),w.dir||(m.file(h).unsafeOriginalName=C)}return c.zipComment.length&&(m.comment=c.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(g,P,b){var d=g("../utils"),i=g("../stream/GenericWorker");function n(l,j){i.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(j)}d.inherits(n,i),n.prototype._bindStream=function(l){var j=this;(this._stream=l).pause(),l.on("data",function(k){j.push({data:k,meta:{percent:0}})}).on("error",function(k){j.isPaused?this.generatedError=k:j.error(k)}).on("end",function(){j.isPaused?j._upstreamEnded=!0:j.end()})},n.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},n.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},P.exports=n},{"../stream/GenericWorker":28,"../utils":32}],13:[function(g,P,b){var d=g("readable-stream").Readable;function i(n,l,j){d.call(this,l),this._helper=n;var k=this;n.on("data",function(y,_){k.push(y)||k._helper.pause(),j&&j(_)}).on("error",function(y){k.emit("error",y)}).on("end",function(){k.push(null)})}g("../utils").inherits(i,d),i.prototype._read=function(){this._helper.resume()},P.exports=i},{"../utils":32,"readable-stream":16}],14:[function(g,P,b){P.exports={isNode:typeof Buffer<"u",newBufferFrom:function(d,i){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(d,i);if(typeof d=="number")throw new Error('The "data" argument must not be a number');return new Buffer(d,i)},allocBuffer:function(d){if(Buffer.alloc)return Buffer.alloc(d);var i=new Buffer(d);return i.fill(0),i},isBuffer:function(d){return Buffer.isBuffer(d)},isStream:function(d){return d&&typeof d.on=="function"&&typeof d.pause=="function"&&typeof d.resume=="function"}}},{}],15:[function(g,P,b){function d(h,U,S){var T,I=n.getTypeOf(U),V=n.extend(S||{},k);V.date=V.date||new Date,V.compression!==null&&(V.compression=V.compression.toUpperCase()),typeof V.unixPermissions=="string"&&(V.unixPermissions=parseInt(V.unixPermissions,8)),V.unixPermissions&&16384&V.unixPermissions&&(V.dir=!0),V.dosPermissions&&16&V.dosPermissions&&(V.dir=!0),V.dir&&(h=o(h)),V.createFolders&&(T=c(h))&&v.call(this,T,!0);var O=I==="string"&&V.binary===!1&&V.base64===!1;S&&S.binary!==void 0||(V.binary=!O),(U instanceof y&&U.uncompressedSize===0||V.dir||!U||U.length===0)&&(V.base64=!1,V.binary=!0,U="",V.compression="STORE",I="string");var f=null;f=U instanceof y||U instanceof l?U:m.isNode&&m.isStream(U)?new a(h,U):n.prepareContent(h,U,V.binary,V.optimizedBinaryString,V.base64);var z=new _(h,f,V);this.files[h]=z}var i=g("./utf8"),n=g("./utils"),l=g("./stream/GenericWorker"),j=g("./stream/StreamHelper"),k=g("./defaults"),y=g("./compressedObject"),_=g("./zipObject"),s=g("./generate"),m=g("./nodejsUtils"),a=g("./nodejs/NodejsStreamInputAdapter"),c=function(h){h.slice(-1)==="/"&&(h=h.substring(0,h.length-1));var U=h.lastIndexOf("/");return 0<U?h.substring(0,U):""},o=function(h){return h.slice(-1)!=="/"&&(h+="/"),h},v=function(h,U){return U=U!==void 0?U:k.createFolders,h=o(h),this.files[h]||d.call(this,h,null,{dir:!0,createFolders:U}),this.files[h]};function w(h){return Object.prototype.toString.call(h)==="[object RegExp]"}var C={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(h){var U,S,T;for(U in this.files)T=this.files[U],(S=U.slice(this.root.length,U.length))&&U.slice(0,this.root.length)===this.root&&h(S,T)},filter:function(h){var U=[];return this.forEach(function(S,T){h(S,T)&&U.push(T)}),U},file:function(h,U,S){if(arguments.length!==1)return h=this.root+h,d.call(this,h,U,S),this;if(w(h)){var T=h;return this.filter(function(V,O){return!O.dir&&T.test(V)})}var I=this.files[this.root+h];return I&&!I.dir?I:null},folder:function(h){if(!h)return this;if(w(h))return this.filter(function(I,V){return V.dir&&h.test(I)});var U=this.root+h,S=v.call(this,U),T=this.clone();return T.root=S.name,T},remove:function(h){h=this.root+h;var U=this.files[h];if(U||(h.slice(-1)!=="/"&&(h+="/"),U=this.files[h]),U&&!U.dir)delete this.files[h];else for(var S=this.filter(function(I,V){return V.name.slice(0,h.length)===h}),T=0;T<S.length;T++)delete this.files[S[T].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(h){var U,S={};try{if((S=n.extend(h||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=S.type.toLowerCase(),S.compression=S.compression.toUpperCase(),S.type==="binarystring"&&(S.type="string"),!S.type)throw new Error("No output type specified.");n.checkSupport(S.type),S.platform!=="darwin"&&S.platform!=="freebsd"&&S.platform!=="linux"&&S.platform!=="sunos"||(S.platform="UNIX"),S.platform==="win32"&&(S.platform="DOS");var T=S.comment||this.comment||"";U=s.generateWorker(this,S,T)}catch(I){(U=new l("error")).error(I)}return new j(U,S.type||"string",S.mimeType)},generateAsync:function(h,U){return this.generateInternalStream(h).accumulate(U)},generateNodeStream:function(h,U){return(h=h||{}).type||(h.type="nodebuffer"),this.generateInternalStream(h).toNodejsStream(U)}};P.exports=C},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(g,P,b){P.exports=g("stream")},{stream:void 0}],17:[function(g,P,b){var d=g("./DataReader");function i(n){d.call(this,n);for(var l=0;l<this.data.length;l++)n[l]=255&n[l]}g("../utils").inherits(i,d),i.prototype.byteAt=function(n){return this.data[this.zero+n]},i.prototype.lastIndexOfSignature=function(n){for(var l=n.charCodeAt(0),j=n.charCodeAt(1),k=n.charCodeAt(2),y=n.charCodeAt(3),_=this.length-4;0<=_;--_)if(this.data[_]===l&&this.data[_+1]===j&&this.data[_+2]===k&&this.data[_+3]===y)return _-this.zero;return-1},i.prototype.readAndCheckSignature=function(n){var l=n.charCodeAt(0),j=n.charCodeAt(1),k=n.charCodeAt(2),y=n.charCodeAt(3),_=this.readData(4);return l===_[0]&&j===_[1]&&k===_[2]&&y===_[3]},i.prototype.readData=function(n){if(this.checkOffset(n),n===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,l},P.exports=i},{"../utils":32,"./DataReader":18}],18:[function(g,P,b){var d=g("../utils");function i(n){this.data=n,this.length=n.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(n){this.checkIndex(this.index+n)},checkIndex:function(n){if(this.length<this.zero+n||n<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+n+"). Corrupted zip ?")},setIndex:function(n){this.checkIndex(n),this.index=n},skip:function(n){this.setIndex(this.index+n)},byteAt:function(){},readInt:function(n){var l,j=0;for(this.checkOffset(n),l=this.index+n-1;l>=this.index;l--)j=(j<<8)+this.byteAt(l);return this.index+=n,j},readString:function(n){return d.transformTo("string",this.readData(n))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var n=this.readInt(4);return new Date(Date.UTC(1980+(n>>25&127),(n>>21&15)-1,n>>16&31,n>>11&31,n>>5&63,(31&n)<<1))}},P.exports=i},{"../utils":32}],19:[function(g,P,b){var d=g("./Uint8ArrayReader");function i(n){d.call(this,n)}g("../utils").inherits(i,d),i.prototype.readData=function(n){this.checkOffset(n);var l=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,l},P.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(g,P,b){var d=g("./DataReader");function i(n){d.call(this,n)}g("../utils").inherits(i,d),i.prototype.byteAt=function(n){return this.data.charCodeAt(this.zero+n)},i.prototype.lastIndexOfSignature=function(n){return this.data.lastIndexOf(n)-this.zero},i.prototype.readAndCheckSignature=function(n){return n===this.readData(4)},i.prototype.readData=function(n){this.checkOffset(n);var l=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,l},P.exports=i},{"../utils":32,"./DataReader":18}],21:[function(g,P,b){var d=g("./ArrayReader");function i(n){d.call(this,n)}g("../utils").inherits(i,d),i.prototype.readData=function(n){if(this.checkOffset(n),n===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+n);return this.index+=n,l},P.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(g,P,b){var d=g("../utils"),i=g("../support"),n=g("./ArrayReader"),l=g("./StringReader"),j=g("./NodeBufferReader"),k=g("./Uint8ArrayReader");P.exports=function(y){var _=d.getTypeOf(y);return d.checkSupport(_),_!=="string"||i.uint8array?_==="nodebuffer"?new j(y):i.uint8array?new k(d.transformTo("uint8array",y)):new n(d.transformTo("array",y)):new l(y)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(g,P,b){b.LOCAL_FILE_HEADER="PK",b.CENTRAL_FILE_HEADER="PK",b.CENTRAL_DIRECTORY_END="PK",b.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",b.ZIP64_CENTRAL_DIRECTORY_END="PK",b.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(g,P,b){var d=g("./GenericWorker"),i=g("../utils");function n(l){d.call(this,"ConvertWorker to "+l),this.destType=l}i.inherits(n,d),n.prototype.processChunk=function(l){this.push({data:i.transformTo(this.destType,l.data),meta:l.meta})},P.exports=n},{"../utils":32,"./GenericWorker":28}],25:[function(g,P,b){var d=g("./GenericWorker"),i=g("../crc32");function n(){d.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}g("../utils").inherits(n,d),n.prototype.processChunk=function(l){this.streamInfo.crc32=i(l.data,this.streamInfo.crc32||0),this.push(l)},P.exports=n},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(g,P,b){var d=g("../utils"),i=g("./GenericWorker");function n(l){i.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}d.inherits(n,i),n.prototype.processChunk=function(l){if(l){var j=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=j+l.data.length}i.prototype.processChunk.call(this,l)},P.exports=n},{"../utils":32,"./GenericWorker":28}],27:[function(g,P,b){var d=g("../utils"),i=g("./GenericWorker");function n(l){i.call(this,"DataWorker");var j=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(k){j.dataIsReady=!0,j.data=k,j.max=k&&k.length||0,j.type=d.getTypeOf(k),j.isPaused||j._tickAndRepeat()},function(k){j.error(k)})}d.inherits(n,i),n.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,d.delay(this._tickAndRepeat,[],this)),!0)},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(d.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,j=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,j);break;case"uint8array":l=this.data.subarray(this.index,j);break;case"array":case"nodebuffer":l=this.data.slice(this.index,j)}return this.index=j,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},P.exports=n},{"../utils":32,"./GenericWorker":28}],28:[function(g,P,b){function d(i){this.name=i||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}d.prototype={push:function(i){this.emit("data",i)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(i){this.emit("error",i)}return!0},error:function(i){return!this.isFinished&&(this.isPaused?this.generatedError=i:(this.isFinished=!0,this.emit("error",i),this.previous&&this.previous.error(i),this.cleanUp()),!0)},on:function(i,n){return this._listeners[i].push(n),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(i,n){if(this._listeners[i])for(var l=0;l<this._listeners[i].length;l++)this._listeners[i][l].call(this,n)},pipe:function(i){return i.registerPrevious(this)},registerPrevious:function(i){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=i.streamInfo,this.mergeStreamInfo(),this.previous=i;var n=this;return i.on("data",function(l){n.processChunk(l)}),i.on("end",function(){n.end()}),i.on("error",function(l){n.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var i=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),i=!0),this.previous&&this.previous.resume(),!i},flush:function(){},processChunk:function(i){this.push(i)},withStreamInfo:function(i,n){return this.extraStreamInfo[i]=n,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var i in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,i)&&(this.streamInfo[i]=this.extraStreamInfo[i])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var i="Worker "+this.name;return this.previous?this.previous+" -> "+i:i}},P.exports=d},{}],29:[function(g,P,b){var d=g("../utils"),i=g("./ConvertWorker"),n=g("./GenericWorker"),l=g("../base64"),j=g("../support"),k=g("../external"),y=null;if(j.nodestream)try{y=g("../nodejs/NodejsStreamOutputAdapter")}catch{}function _(m,a){return new k.Promise(function(c,o){var v=[],w=m._internalType,C=m._outputType,h=m._mimeType;m.on("data",function(U,S){v.push(U),a&&a(S)}).on("error",function(U){v=[],o(U)}).on("end",function(){try{var U=function(S,T,I){switch(S){case"blob":return d.newBlob(d.transformTo("arraybuffer",T),I);case"base64":return l.encode(T);default:return d.transformTo(S,T)}}(C,function(S,T){var I,V=0,O=null,f=0;for(I=0;I<T.length;I++)f+=T[I].length;switch(S){case"string":return T.join("");case"array":return Array.prototype.concat.apply([],T);case"uint8array":for(O=new Uint8Array(f),I=0;I<T.length;I++)O.set(T[I],V),V+=T[I].length;return O;case"nodebuffer":return Buffer.concat(T);default:throw new Error("concat : unsupported type '"+S+"'")}}(w,v),h);c(U)}catch(S){o(S)}v=[]}).resume()})}function s(m,a,c){var o=a;switch(a){case"blob":case"arraybuffer":o="uint8array";break;case"base64":o="string"}try{this._internalType=o,this._outputType=a,this._mimeType=c,d.checkSupport(o),this._worker=m.pipe(new i(o)),m.lock()}catch(v){this._worker=new n("error"),this._worker.error(v)}}s.prototype={accumulate:function(m){return _(this,m)},on:function(m,a){var c=this;return m==="data"?this._worker.on(m,function(o){a.call(c,o.data,o.meta)}):this._worker.on(m,function(){d.delay(a,arguments,c)}),this},resume:function(){return d.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(d.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new y(this,{objectMode:this._outputType!=="nodebuffer"},m)}},P.exports=s},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(g,P,b){if(b.base64=!0,b.array=!0,b.string=!0,b.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",b.nodebuffer=typeof Buffer<"u",b.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")b.blob=!1;else{var d=new ArrayBuffer(0);try{b.blob=new Blob([d],{type:"application/zip"}).size===0}catch{try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(d),b.blob=i.getBlob("application/zip").size===0}catch{b.blob=!1}}}try{b.nodestream=!!g("readable-stream").Readable}catch{b.nodestream=!1}},{"readable-stream":16}],31:[function(g,P,b){for(var d=g("./utils"),i=g("./support"),n=g("./nodejsUtils"),l=g("./stream/GenericWorker"),j=new Array(256),k=0;k<256;k++)j[k]=252<=k?6:248<=k?5:240<=k?4:224<=k?3:192<=k?2:1;j[254]=j[254]=1;function y(){l.call(this,"utf-8 decode"),this.leftOver=null}function _(){l.call(this,"utf-8 encode")}b.utf8encode=function(s){return i.nodebuffer?n.newBufferFrom(s,"utf-8"):function(m){var a,c,o,v,w,C=m.length,h=0;for(v=0;v<C;v++)(64512&(c=m.charCodeAt(v)))==55296&&v+1<C&&(64512&(o=m.charCodeAt(v+1)))==56320&&(c=65536+(c-55296<<10)+(o-56320),v++),h+=c<128?1:c<2048?2:c<65536?3:4;for(a=i.uint8array?new Uint8Array(h):new Array(h),v=w=0;w<h;v++)(64512&(c=m.charCodeAt(v)))==55296&&v+1<C&&(64512&(o=m.charCodeAt(v+1)))==56320&&(c=65536+(c-55296<<10)+(o-56320),v++),c<128?a[w++]=c:(c<2048?a[w++]=192|c>>>6:(c<65536?a[w++]=224|c>>>12:(a[w++]=240|c>>>18,a[w++]=128|c>>>12&63),a[w++]=128|c>>>6&63),a[w++]=128|63&c);return a}(s)},b.utf8decode=function(s){return i.nodebuffer?d.transformTo("nodebuffer",s).toString("utf-8"):function(m){var a,c,o,v,w=m.length,C=new Array(2*w);for(a=c=0;a<w;)if((o=m[a++])<128)C[c++]=o;else if(4<(v=j[o]))C[c++]=65533,a+=v-1;else{for(o&=v===2?31:v===3?15:7;1<v&&a<w;)o=o<<6|63&m[a++],v--;1<v?C[c++]=65533:o<65536?C[c++]=o:(o-=65536,C[c++]=55296|o>>10&1023,C[c++]=56320|1023&o)}return C.length!==c&&(C.subarray?C=C.subarray(0,c):C.length=c),d.applyFromCharCode(C)}(s=d.transformTo(i.uint8array?"uint8array":"array",s))},d.inherits(y,l),y.prototype.processChunk=function(s){var m=d.transformTo(i.uint8array?"uint8array":"array",s.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var a=m;(m=new Uint8Array(a.length+this.leftOver.length)).set(this.leftOver,0),m.set(a,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var c=function(v,w){var C;for((w=w||v.length)>v.length&&(w=v.length),C=w-1;0<=C&&(192&v[C])==128;)C--;return C<0||C===0?w:C+j[v[C]]>w?C:w}(m),o=m;c!==m.length&&(i.uint8array?(o=m.subarray(0,c),this.leftOver=m.subarray(c,m.length)):(o=m.slice(0,c),this.leftOver=m.slice(c,m.length))),this.push({data:b.utf8decode(o),meta:s.meta})},y.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:b.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},b.Utf8DecodeWorker=y,d.inherits(_,l),_.prototype.processChunk=function(s){this.push({data:b.utf8encode(s.data),meta:s.meta})},b.Utf8EncodeWorker=_},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(g,P,b){var d=g("./support"),i=g("./base64"),n=g("./nodejsUtils"),l=g("./external");function j(a){return a}function k(a,c){for(var o=0;o<a.length;++o)c[o]=255&a.charCodeAt(o);return c}g("setimmediate"),b.newBlob=function(a,c){b.checkSupport("blob");try{return new Blob([a],{type:c})}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return o.append(a),o.getBlob(c)}catch{throw new Error("Bug : can't construct the Blob.")}}};var y={stringifyByChunk:function(a,c,o){var v=[],w=0,C=a.length;if(C<=o)return String.fromCharCode.apply(null,a);for(;w<C;)c==="array"||c==="nodebuffer"?v.push(String.fromCharCode.apply(null,a.slice(w,Math.min(w+o,C)))):v.push(String.fromCharCode.apply(null,a.subarray(w,Math.min(w+o,C)))),w+=o;return v.join("")},stringifyByChar:function(a){for(var c="",o=0;o<a.length;o++)c+=String.fromCharCode(a[o]);return c},applyCanBeUsed:{uint8array:function(){try{return d.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return d.nodebuffer&&String.fromCharCode.apply(null,n.allocBuffer(1)).length===1}catch{return!1}}()}};function _(a){var c=65536,o=b.getTypeOf(a),v=!0;if(o==="uint8array"?v=y.applyCanBeUsed.uint8array:o==="nodebuffer"&&(v=y.applyCanBeUsed.nodebuffer),v)for(;1<c;)try{return y.stringifyByChunk(a,o,c)}catch{c=Math.floor(c/2)}return y.stringifyByChar(a)}function s(a,c){for(var o=0;o<a.length;o++)c[o]=a[o];return c}b.applyFromCharCode=_;var m={};m.string={string:j,array:function(a){return k(a,new Array(a.length))},arraybuffer:function(a){return m.string.uint8array(a).buffer},uint8array:function(a){return k(a,new Uint8Array(a.length))},nodebuffer:function(a){return k(a,n.allocBuffer(a.length))}},m.array={string:_,array:j,arraybuffer:function(a){return new Uint8Array(a).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return n.newBufferFrom(a)}},m.arraybuffer={string:function(a){return _(new Uint8Array(a))},array:function(a){return s(new Uint8Array(a),new Array(a.byteLength))},arraybuffer:j,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return n.newBufferFrom(new Uint8Array(a))}},m.uint8array={string:_,array:function(a){return s(a,new Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:j,nodebuffer:function(a){return n.newBufferFrom(a)}},m.nodebuffer={string:_,array:function(a){return s(a,new Array(a.length))},arraybuffer:function(a){return m.nodebuffer.uint8array(a).buffer},uint8array:function(a){return s(a,new Uint8Array(a.length))},nodebuffer:j},b.transformTo=function(a,c){if(c=c||"",!a)return c;b.checkSupport(a);var o=b.getTypeOf(c);return m[o][a](c)},b.resolve=function(a){for(var c=a.split("/"),o=[],v=0;v<c.length;v++){var w=c[v];w==="."||w===""&&v!==0&&v!==c.length-1||(w===".."?o.pop():o.push(w))}return o.join("/")},b.getTypeOf=function(a){return typeof a=="string"?"string":Object.prototype.toString.call(a)==="[object Array]"?"array":d.nodebuffer&&n.isBuffer(a)?"nodebuffer":d.uint8array&&a instanceof Uint8Array?"uint8array":d.arraybuffer&&a instanceof ArrayBuffer?"arraybuffer":void 0},b.checkSupport=function(a){if(!d[a.toLowerCase()])throw new Error(a+" is not supported by this platform")},b.MAX_VALUE_16BITS=65535,b.MAX_VALUE_32BITS=-1,b.pretty=function(a){var c,o,v="";for(o=0;o<(a||"").length;o++)v+="\\x"+((c=a.charCodeAt(o))<16?"0":"")+c.toString(16).toUpperCase();return v},b.delay=function(a,c,o){setImmediate(function(){a.apply(o||null,c||[])})},b.inherits=function(a,c){function o(){}o.prototype=c.prototype,a.prototype=new o},b.extend=function(){var a,c,o={};for(a=0;a<arguments.length;a++)for(c in arguments[a])Object.prototype.hasOwnProperty.call(arguments[a],c)&&o[c]===void 0&&(o[c]=arguments[a][c]);return o},b.prepareContent=function(a,c,o,v,w){return l.Promise.resolve(c).then(function(C){return d.blob&&(C instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(C))!==-1)&&typeof FileReader<"u"?new l.Promise(function(h,U){var S=new FileReader;S.onload=function(T){h(T.target.result)},S.onerror=function(T){U(T.target.error)},S.readAsArrayBuffer(C)}):C}).then(function(C){var h=b.getTypeOf(C);return h?(h==="arraybuffer"?C=b.transformTo("uint8array",C):h==="string"&&(w?C=i.decode(C):o&&v!==!0&&(C=function(U){return k(U,d.uint8array?new Uint8Array(U.length):new Array(U.length))}(C))),C):l.Promise.reject(new Error("Can't read the data of '"+a+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(g,P,b){var d=g("./reader/readerFor"),i=g("./utils"),n=g("./signature"),l=g("./zipEntry"),j=g("./support");function k(y){this.files=[],this.loadOptions=y}k.prototype={checkSignature:function(y){if(!this.reader.readAndCheckSignature(y)){this.reader.index-=4;var _=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(_)+", expected "+i.pretty(y)+")")}},isSignature:function(y,_){var s=this.reader.index;this.reader.setIndex(y);var m=this.reader.readString(4)===_;return this.reader.setIndex(s),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var y=this.reader.readData(this.zipCommentLength),_=j.uint8array?"uint8array":"array",s=i.transformTo(_,y);this.zipComment=this.loadOptions.decodeFileName(s)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var y,_,s,m=this.zip64EndOfCentralSize-44;0<m;)y=this.reader.readInt(2),_=this.reader.readInt(4),s=this.reader.readData(_),this.zip64ExtensibleData[y]={id:y,length:_,value:s}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var y,_;for(y=0;y<this.files.length;y++)_=this.files[y],this.reader.setIndex(_.localHeaderOffset),this.checkSignature(n.LOCAL_FILE_HEADER),_.readLocalPart(this.reader),_.handleUTF8(),_.processAttributes()},readCentralDir:function(){var y;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(n.CENTRAL_FILE_HEADER);)(y=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(y);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var y=this.reader.lastIndexOfSignature(n.CENTRAL_DIRECTORY_END);if(y<0)throw this.isSignature(0,n.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(y);var _=y;if(this.checkSignature(n.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(y=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(y),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,n.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var s=this.centralDirOffset+this.centralDirSize;this.zip64&&(s+=20,s+=12+this.zip64EndOfCentralSize);var m=_-s;if(0<m)this.isSignature(_,n.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(y){this.reader=d(y)},load:function(y){this.prepareReader(y),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},P.exports=k},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(g,P,b){var d=g("./reader/readerFor"),i=g("./utils"),n=g("./compressedObject"),l=g("./crc32"),j=g("./utf8"),k=g("./compressions"),y=g("./support");function _(s,m){this.options=s,this.loadOptions=m}_.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(s){var m,a;if(s.skip(22),this.fileNameLength=s.readInt(2),a=s.readInt(2),this.fileName=s.readData(this.fileNameLength),s.skip(a),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(c){for(var o in k)if(Object.prototype.hasOwnProperty.call(k,o)&&k[o].magic===c)return k[o];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new n(this.compressedSize,this.uncompressedSize,this.crc32,m,s.readData(this.compressedSize))},readCentralPart:function(s){this.versionMadeBy=s.readInt(2),s.skip(2),this.bitFlag=s.readInt(2),this.compressionMethod=s.readString(2),this.date=s.readDate(),this.crc32=s.readInt(4),this.compressedSize=s.readInt(4),this.uncompressedSize=s.readInt(4);var m=s.readInt(2);if(this.extraFieldsLength=s.readInt(2),this.fileCommentLength=s.readInt(2),this.diskNumberStart=s.readInt(2),this.internalFileAttributes=s.readInt(2),this.externalFileAttributes=s.readInt(4),this.localHeaderOffset=s.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");s.skip(m),this.readExtraFields(s),this.parseZIP64ExtraField(s),this.fileComment=s.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var s=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),s==0&&(this.dosPermissions=63&this.externalFileAttributes),s==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var s=d(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=s.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=s.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=s.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=s.readInt(4))}},readExtraFields:function(s){var m,a,c,o=s.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});s.index+4<o;)m=s.readInt(2),a=s.readInt(2),c=s.readData(a),this.extraFields[m]={id:m,length:a,value:c};s.setIndex(o)},handleUTF8:function(){var s=y.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=j.utf8decode(this.fileName),this.fileCommentStr=j.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var a=i.transformTo(s,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(a)}var c=this.findExtraFieldUnicodeComment();if(c!==null)this.fileCommentStr=c;else{var o=i.transformTo(s,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(o)}}},findExtraFieldUnicodePath:function(){var s=this.extraFields[28789];if(s){var m=d(s.value);return m.readInt(1)!==1||l(this.fileName)!==m.readInt(4)?null:j.utf8decode(m.readData(s.length-5))}return null},findExtraFieldUnicodeComment:function(){var s=this.extraFields[25461];if(s){var m=d(s.value);return m.readInt(1)!==1||l(this.fileComment)!==m.readInt(4)?null:j.utf8decode(m.readData(s.length-5))}return null}},P.exports=_},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(g,P,b){function d(m,a,c){this.name=m,this.dir=c.dir,this.date=c.date,this.comment=c.comment,this.unixPermissions=c.unixPermissions,this.dosPermissions=c.dosPermissions,this._data=a,this._dataBinary=c.binary,this.options={compression:c.compression,compressionOptions:c.compressionOptions}}var i=g("./stream/StreamHelper"),n=g("./stream/DataWorker"),l=g("./utf8"),j=g("./compressedObject"),k=g("./stream/GenericWorker");d.prototype={internalStream:function(m){var a=null,c="string";try{if(!m)throw new Error("No output type specified.");var o=(c=m.toLowerCase())==="string"||c==="text";c!=="binarystring"&&c!=="text"||(c="string"),a=this._decompressWorker();var v=!this._dataBinary;v&&!o&&(a=a.pipe(new l.Utf8EncodeWorker)),!v&&o&&(a=a.pipe(new l.Utf8DecodeWorker))}catch(w){(a=new k("error")).error(w)}return new i(a,c,"")},async:function(m,a){return this.internalStream(m).accumulate(a)},nodeStream:function(m,a){return this.internalStream(m||"nodebuffer").toNodejsStream(a)},_compressWorker:function(m,a){if(this._data instanceof j&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var c=this._decompressWorker();return this._dataBinary||(c=c.pipe(new l.Utf8EncodeWorker)),j.createWorkerFrom(c,m,a)},_decompressWorker:function(){return this._data instanceof j?this._data.getContentWorker():this._data instanceof k?this._data:new n(this._data)}};for(var y=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],_=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},s=0;s<y.length;s++)d.prototype[y[s]]=_;P.exports=d},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(g,P,b){(function(d){var i,n,l=d.MutationObserver||d.WebKitMutationObserver;if(l){var j=0,k=new l(m),y=d.document.createTextNode("");k.observe(y,{characterData:!0}),i=function(){y.data=j=++j%2}}else if(d.setImmediate||d.MessageChannel===void 0)i="document"in d&&"onreadystatechange"in d.document.createElement("script")?function(){var a=d.document.createElement("script");a.onreadystatechange=function(){m(),a.onreadystatechange=null,a.parentNode.removeChild(a),a=null},d.document.documentElement.appendChild(a)}:function(){setTimeout(m,0)};else{var _=new d.MessageChannel;_.port1.onmessage=m,i=function(){_.port2.postMessage(0)}}var s=[];function m(){var a,c;n=!0;for(var o=s.length;o;){for(c=s,s=[],a=-1;++a<o;)c[a]();o=s.length}n=!1}P.exports=function(a){s.push(a)!==1||n||i()}}).call(this,typeof Ge<"u"?Ge:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(g,P,b){var d=g("immediate");function i(){}var n={},l=["REJECTED"],j=["FULFILLED"],k=["PENDING"];function y(o){if(typeof o!="function")throw new TypeError("resolver must be a function");this.state=k,this.queue=[],this.outcome=void 0,o!==i&&a(this,o)}function _(o,v,w){this.promise=o,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof w=="function"&&(this.onRejected=w,this.callRejected=this.otherCallRejected)}function s(o,v,w){d(function(){var C;try{C=v(w)}catch(h){return n.reject(o,h)}C===o?n.reject(o,new TypeError("Cannot resolve promise with itself")):n.resolve(o,C)})}function m(o){var v=o&&o.then;if(o&&(typeof o=="object"||typeof o=="function")&&typeof v=="function")return function(){v.apply(o,arguments)}}function a(o,v){var w=!1;function C(S){w||(w=!0,n.reject(o,S))}function h(S){w||(w=!0,n.resolve(o,S))}var U=c(function(){v(h,C)});U.status==="error"&&C(U.value)}function c(o,v){var w={};try{w.value=o(v),w.status="success"}catch(C){w.status="error",w.value=C}return w}(P.exports=y).prototype.finally=function(o){if(typeof o!="function")return this;var v=this.constructor;return this.then(function(w){return v.resolve(o()).then(function(){return w})},function(w){return v.resolve(o()).then(function(){throw w})})},y.prototype.catch=function(o){return this.then(null,o)},y.prototype.then=function(o,v){if(typeof o!="function"&&this.state===j||typeof v!="function"&&this.state===l)return this;var w=new this.constructor(i);return this.state!==k?s(w,this.state===j?o:v,this.outcome):this.queue.push(new _(w,o,v)),w},_.prototype.callFulfilled=function(o){n.resolve(this.promise,o)},_.prototype.otherCallFulfilled=function(o){s(this.promise,this.onFulfilled,o)},_.prototype.callRejected=function(o){n.reject(this.promise,o)},_.prototype.otherCallRejected=function(o){s(this.promise,this.onRejected,o)},n.resolve=function(o,v){var w=c(m,v);if(w.status==="error")return n.reject(o,w.value);var C=w.value;if(C)a(o,C);else{o.state=j,o.outcome=v;for(var h=-1,U=o.queue.length;++h<U;)o.queue[h].callFulfilled(v)}return o},n.reject=function(o,v){o.state=l,o.outcome=v;for(var w=-1,C=o.queue.length;++w<C;)o.queue[w].callRejected(v);return o},y.resolve=function(o){return o instanceof this?o:n.resolve(new this(i),o)},y.reject=function(o){var v=new this(i);return n.reject(v,o)},y.all=function(o){var v=this;if(Object.prototype.toString.call(o)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=o.length,C=!1;if(!w)return this.resolve([]);for(var h=new Array(w),U=0,S=-1,T=new this(i);++S<w;)I(o[S],S);return T;function I(V,O){v.resolve(V).then(function(f){h[O]=f,++U!==w||C||(C=!0,n.resolve(T,h))},function(f){C||(C=!0,n.reject(T,f))})}},y.race=function(o){var v=this;if(Object.prototype.toString.call(o)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=o.length,C=!1;if(!w)return this.resolve([]);for(var h=-1,U=new this(i);++h<w;)S=o[h],v.resolve(S).then(function(T){C||(C=!0,n.resolve(U,T))},function(T){C||(C=!0,n.reject(U,T))});var S;return U}},{immediate:36}],38:[function(g,P,b){var d={};(0,g("./lib/utils/common").assign)(d,g("./lib/deflate"),g("./lib/inflate"),g("./lib/zlib/constants")),P.exports=d},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(g,P,b){var d=g("./zlib/deflate"),i=g("./utils/common"),n=g("./utils/strings"),l=g("./zlib/messages"),j=g("./zlib/zstream"),k=Object.prototype.toString,y=0,_=-1,s=0,m=8;function a(o){if(!(this instanceof a))return new a(o);this.options=i.assign({level:_,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:s,to:""},o||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new j,this.strm.avail_out=0;var w=d.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(w!==y)throw new Error(l[w]);if(v.header&&d.deflateSetHeader(this.strm,v.header),v.dictionary){var C;if(C=typeof v.dictionary=="string"?n.string2buf(v.dictionary):k.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(w=d.deflateSetDictionary(this.strm,C))!==y)throw new Error(l[w]);this._dict_set=!0}}function c(o,v){var w=new a(v);if(w.push(o,!0),w.err)throw w.msg||l[w.err];return w.result}a.prototype.push=function(o,v){var w,C,h=this.strm,U=this.options.chunkSize;if(this.ended)return!1;C=v===~~v?v:v===!0?4:0,typeof o=="string"?h.input=n.string2buf(o):k.call(o)==="[object ArrayBuffer]"?h.input=new Uint8Array(o):h.input=o,h.next_in=0,h.avail_in=h.input.length;do{if(h.avail_out===0&&(h.output=new i.Buf8(U),h.next_out=0,h.avail_out=U),(w=d.deflate(h,C))!==1&&w!==y)return this.onEnd(w),!(this.ended=!0);h.avail_out!==0&&(h.avail_in!==0||C!==4&&C!==2)||(this.options.to==="string"?this.onData(n.buf2binstring(i.shrinkBuf(h.output,h.next_out))):this.onData(i.shrinkBuf(h.output,h.next_out)))}while((0<h.avail_in||h.avail_out===0)&&w!==1);return C===4?(w=d.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===y):C!==2||(this.onEnd(y),!(h.avail_out=0))},a.prototype.onData=function(o){this.chunks.push(o)},a.prototype.onEnd=function(o){o===y&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.msg=this.strm.msg},b.Deflate=a,b.deflate=c,b.deflateRaw=function(o,v){return(v=v||{}).raw=!0,c(o,v)},b.gzip=function(o,v){return(v=v||{}).gzip=!0,c(o,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(g,P,b){var d=g("./zlib/inflate"),i=g("./utils/common"),n=g("./utils/strings"),l=g("./zlib/constants"),j=g("./zlib/messages"),k=g("./zlib/zstream"),y=g("./zlib/gzheader"),_=Object.prototype.toString;function s(a){if(!(this instanceof s))return new s(a);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},a||{});var c=this.options;c.raw&&0<=c.windowBits&&c.windowBits<16&&(c.windowBits=-c.windowBits,c.windowBits===0&&(c.windowBits=-15)),!(0<=c.windowBits&&c.windowBits<16)||a&&a.windowBits||(c.windowBits+=32),15<c.windowBits&&c.windowBits<48&&!(15&c.windowBits)&&(c.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new k,this.strm.avail_out=0;var o=d.inflateInit2(this.strm,c.windowBits);if(o!==l.Z_OK)throw new Error(j[o]);this.header=new y,d.inflateGetHeader(this.strm,this.header)}function m(a,c){var o=new s(c);if(o.push(a,!0),o.err)throw o.msg||j[o.err];return o.result}s.prototype.push=function(a,c){var o,v,w,C,h,U,S=this.strm,T=this.options.chunkSize,I=this.options.dictionary,V=!1;if(this.ended)return!1;v=c===~~c?c:c===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof a=="string"?S.input=n.binstring2buf(a):_.call(a)==="[object ArrayBuffer]"?S.input=new Uint8Array(a):S.input=a,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new i.Buf8(T),S.next_out=0,S.avail_out=T),(o=d.inflate(S,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&I&&(U=typeof I=="string"?n.string2buf(I):_.call(I)==="[object ArrayBuffer]"?new Uint8Array(I):I,o=d.inflateSetDictionary(this.strm,U)),o===l.Z_BUF_ERROR&&V===!0&&(o=l.Z_OK,V=!1),o!==l.Z_STREAM_END&&o!==l.Z_OK)return this.onEnd(o),!(this.ended=!0);S.next_out&&(S.avail_out!==0&&o!==l.Z_STREAM_END&&(S.avail_in!==0||v!==l.Z_FINISH&&v!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(w=n.utf8border(S.output,S.next_out),C=S.next_out-w,h=n.buf2string(S.output,w),S.next_out=C,S.avail_out=T-C,C&&i.arraySet(S.output,S.output,w,C,0),this.onData(h)):this.onData(i.shrinkBuf(S.output,S.next_out)))),S.avail_in===0&&S.avail_out===0&&(V=!0)}while((0<S.avail_in||S.avail_out===0)&&o!==l.Z_STREAM_END);return o===l.Z_STREAM_END&&(v=l.Z_FINISH),v===l.Z_FINISH?(o=d.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===l.Z_OK):v!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(S.avail_out=0))},s.prototype.onData=function(a){this.chunks.push(a)},s.prototype.onEnd=function(a){a===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},b.Inflate=s,b.inflate=m,b.inflateRaw=function(a,c){return(c=c||{}).raw=!0,m(a,c)},b.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(g,P,b){var d=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";b.assign=function(l){for(var j=Array.prototype.slice.call(arguments,1);j.length;){var k=j.shift();if(k){if(typeof k!="object")throw new TypeError(k+"must be non-object");for(var y in k)k.hasOwnProperty(y)&&(l[y]=k[y])}}return l},b.shrinkBuf=function(l,j){return l.length===j?l:l.subarray?l.subarray(0,j):(l.length=j,l)};var i={arraySet:function(l,j,k,y,_){if(j.subarray&&l.subarray)l.set(j.subarray(k,k+y),_);else for(var s=0;s<y;s++)l[_+s]=j[k+s]},flattenChunks:function(l){var j,k,y,_,s,m;for(j=y=0,k=l.length;j<k;j++)y+=l[j].length;for(m=new Uint8Array(y),j=_=0,k=l.length;j<k;j++)s=l[j],m.set(s,_),_+=s.length;return m}},n={arraySet:function(l,j,k,y,_){for(var s=0;s<y;s++)l[_+s]=j[k+s]},flattenChunks:function(l){return[].concat.apply([],l)}};b.setTyped=function(l){l?(b.Buf8=Uint8Array,b.Buf16=Uint16Array,b.Buf32=Int32Array,b.assign(b,i)):(b.Buf8=Array,b.Buf16=Array,b.Buf32=Array,b.assign(b,n))},b.setTyped(d)},{}],42:[function(g,P,b){var d=g("./common"),i=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch{i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{n=!1}for(var l=new d.Buf8(256),j=0;j<256;j++)l[j]=252<=j?6:248<=j?5:240<=j?4:224<=j?3:192<=j?2:1;function k(y,_){if(_<65537&&(y.subarray&&n||!y.subarray&&i))return String.fromCharCode.apply(null,d.shrinkBuf(y,_));for(var s="",m=0;m<_;m++)s+=String.fromCharCode(y[m]);return s}l[254]=l[254]=1,b.string2buf=function(y){var _,s,m,a,c,o=y.length,v=0;for(a=0;a<o;a++)(64512&(s=y.charCodeAt(a)))==55296&&a+1<o&&(64512&(m=y.charCodeAt(a+1)))==56320&&(s=65536+(s-55296<<10)+(m-56320),a++),v+=s<128?1:s<2048?2:s<65536?3:4;for(_=new d.Buf8(v),a=c=0;c<v;a++)(64512&(s=y.charCodeAt(a)))==55296&&a+1<o&&(64512&(m=y.charCodeAt(a+1)))==56320&&(s=65536+(s-55296<<10)+(m-56320),a++),s<128?_[c++]=s:(s<2048?_[c++]=192|s>>>6:(s<65536?_[c++]=224|s>>>12:(_[c++]=240|s>>>18,_[c++]=128|s>>>12&63),_[c++]=128|s>>>6&63),_[c++]=128|63&s);return _},b.buf2binstring=function(y){return k(y,y.length)},b.binstring2buf=function(y){for(var _=new d.Buf8(y.length),s=0,m=_.length;s<m;s++)_[s]=y.charCodeAt(s);return _},b.buf2string=function(y,_){var s,m,a,c,o=_||y.length,v=new Array(2*o);for(s=m=0;s<o;)if((a=y[s++])<128)v[m++]=a;else if(4<(c=l[a]))v[m++]=65533,s+=c-1;else{for(a&=c===2?31:c===3?15:7;1<c&&s<o;)a=a<<6|63&y[s++],c--;1<c?v[m++]=65533:a<65536?v[m++]=a:(a-=65536,v[m++]=55296|a>>10&1023,v[m++]=56320|1023&a)}return k(v,m)},b.utf8border=function(y,_){var s;for((_=_||y.length)>y.length&&(_=y.length),s=_-1;0<=s&&(192&y[s])==128;)s--;return s<0||s===0?_:s+l[y[s]]>_?s:_}},{"./common":41}],43:[function(g,P,b){P.exports=function(d,i,n,l){for(var j=65535&d|0,k=d>>>16&65535|0,y=0;n!==0;){for(n-=y=2e3<n?2e3:n;k=k+(j=j+i[l++]|0)|0,--y;);j%=65521,k%=65521}return j|k<<16|0}},{}],44:[function(g,P,b){P.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(g,P,b){var d=function(){for(var i,n=[],l=0;l<256;l++){i=l;for(var j=0;j<8;j++)i=1&i?3988292384^i>>>1:i>>>1;n[l]=i}return n}();P.exports=function(i,n,l,j){var k=d,y=j+l;i^=-1;for(var _=j;_<y;_++)i=i>>>8^k[255&(i^n[_])];return-1^i}},{}],46:[function(g,P,b){var d,i=g("../utils/common"),n=g("./trees"),l=g("./adler32"),j=g("./crc32"),k=g("./messages"),y=0,_=4,s=0,m=-2,a=-1,c=4,o=2,v=8,w=9,C=286,h=30,U=19,S=2*C+1,T=15,I=3,V=258,O=V+I+1,f=42,z=113,r=1,B=2,W=3,L=4;function J(t,Z){return t.msg=k[Z],Z}function G(t){return(t<<1)-(4<t?9:0)}function K(t){for(var Z=t.length;0<=--Z;)t[Z]=0}function R(t){var Z=t.state,$=Z.pending;$>t.avail_out&&($=t.avail_out),$!==0&&(i.arraySet(t.output,Z.pending_buf,Z.pending_out,$,t.next_out),t.next_out+=$,Z.pending_out+=$,t.total_out+=$,t.avail_out-=$,Z.pending-=$,Z.pending===0&&(Z.pending_out=0))}function F(t,Z){n._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,Z),t.block_start=t.strstart,R(t.strm)}function ne(t,Z){t.pending_buf[t.pending++]=Z}function N(t,Z){t.pending_buf[t.pending++]=Z>>>8&255,t.pending_buf[t.pending++]=255&Z}function M(t,Z){var $,p,u=t.max_chain_length,E=t.strstart,q=t.prev_length,H=t.nice_match,D=t.strstart>t.w_size-O?t.strstart-(t.w_size-O):0,Y=t.window,Q=t.w_mask,X=t.prev,se=t.strstart+V,pe=Y[E+q-1],ce=Y[E+q];t.prev_length>=t.good_match&&(u>>=2),H>t.lookahead&&(H=t.lookahead);do if(Y[($=Z)+q]===ce&&Y[$+q-1]===pe&&Y[$]===Y[E]&&Y[++$]===Y[E+1]){E+=2,$++;do;while(Y[++E]===Y[++$]&&Y[++E]===Y[++$]&&Y[++E]===Y[++$]&&Y[++E]===Y[++$]&&Y[++E]===Y[++$]&&Y[++E]===Y[++$]&&Y[++E]===Y[++$]&&Y[++E]===Y[++$]&&E<se);if(p=V-(se-E),E=se-V,q<p){if(t.match_start=Z,H<=(q=p))break;pe=Y[E+q-1],ce=Y[E+q]}}while((Z=X[Z&Q])>D&&--u!=0);return q<=t.lookahead?q:t.lookahead}function ee(t){var Z,$,p,u,E,q,H,D,Y,Q,X=t.w_size;do{if(u=t.window_size-t.lookahead-t.strstart,t.strstart>=X+(X-O)){for(i.arraySet(t.window,t.window,X,X,0),t.match_start-=X,t.strstart-=X,t.block_start-=X,Z=$=t.hash_size;p=t.head[--Z],t.head[Z]=X<=p?p-X:0,--$;);for(Z=$=X;p=t.prev[--Z],t.prev[Z]=X<=p?p-X:0,--$;);u+=X}if(t.strm.avail_in===0)break;if(q=t.strm,H=t.window,D=t.strstart+t.lookahead,Y=u,Q=void 0,Q=q.avail_in,Y<Q&&(Q=Y),$=Q===0?0:(q.avail_in-=Q,i.arraySet(H,q.input,q.next_in,Q,D),q.state.wrap===1?q.adler=l(q.adler,H,Q,D):q.state.wrap===2&&(q.adler=j(q.adler,H,Q,D)),q.next_in+=Q,q.total_in+=Q,Q),t.lookahead+=$,t.lookahead+t.insert>=I)for(E=t.strstart-t.insert,t.ins_h=t.window[E],t.ins_h=(t.ins_h<<t.hash_shift^t.window[E+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[E+I-1])&t.hash_mask,t.prev[E&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=E,E++,t.insert--,!(t.lookahead+t.insert<I)););}while(t.lookahead<O&&t.strm.avail_in!==0)}function ie(t,Z){for(var $,p;;){if(t.lookahead<O){if(ee(t),t.lookahead<O&&Z===y)return r;if(t.lookahead===0)break}if($=0,t.lookahead>=I&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+I-1])&t.hash_mask,$=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),$!==0&&t.strstart-$<=t.w_size-O&&(t.match_length=M(t,$)),t.match_length>=I)if(p=n._tr_tally(t,t.strstart-t.match_start,t.match_length-I),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=I){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+I-1])&t.hash_mask,$=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,--t.match_length!=0;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else p=n._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(p&&(F(t,!1),t.strm.avail_out===0))return r}return t.insert=t.strstart<I-1?t.strstart:I-1,Z===_?(F(t,!0),t.strm.avail_out===0?W:L):t.last_lit&&(F(t,!1),t.strm.avail_out===0)?r:B}function re(t,Z){for(var $,p,u;;){if(t.lookahead<O){if(ee(t),t.lookahead<O&&Z===y)return r;if(t.lookahead===0)break}if($=0,t.lookahead>=I&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+I-1])&t.hash_mask,$=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=I-1,$!==0&&t.prev_length<t.max_lazy_match&&t.strstart-$<=t.w_size-O&&(t.match_length=M(t,$),t.match_length<=5&&(t.strategy===1||t.match_length===I&&4096<t.strstart-t.match_start)&&(t.match_length=I-1)),t.prev_length>=I&&t.match_length<=t.prev_length){for(u=t.strstart+t.lookahead-I,p=n._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-I),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=u&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+I-1])&t.hash_mask,$=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),--t.prev_length!=0;);if(t.match_available=0,t.match_length=I-1,t.strstart++,p&&(F(t,!1),t.strm.avail_out===0))return r}else if(t.match_available){if((p=n._tr_tally(t,0,t.window[t.strstart-1]))&&F(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return r}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(p=n._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<I-1?t.strstart:I-1,Z===_?(F(t,!0),t.strm.avail_out===0?W:L):t.last_lit&&(F(t,!1),t.strm.avail_out===0)?r:B}function ae(t,Z,$,p,u){this.good_length=t,this.max_lazy=Z,this.nice_length=$,this.max_chain=p,this.func=u}function te(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*S),this.dyn_dtree=new i.Buf16(2*(2*h+1)),this.bl_tree=new i.Buf16(2*(2*U+1)),K(this.dyn_ltree),K(this.dyn_dtree),K(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(T+1),this.heap=new i.Buf16(2*C+1),K(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*C+1),K(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function de(t){var Z;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=o,(Z=t.state).pending=0,Z.pending_out=0,Z.wrap<0&&(Z.wrap=-Z.wrap),Z.status=Z.wrap?f:z,t.adler=Z.wrap===2?0:1,Z.last_flush=y,n._tr_init(Z),s):J(t,m)}function le(t){var Z=de(t);return Z===s&&function($){$.window_size=2*$.w_size,K($.head),$.max_lazy_match=d[$.level].max_lazy,$.good_match=d[$.level].good_length,$.nice_match=d[$.level].nice_length,$.max_chain_length=d[$.level].max_chain,$.strstart=0,$.block_start=0,$.lookahead=0,$.insert=0,$.match_length=$.prev_length=I-1,$.match_available=0,$.ins_h=0}(t.state),Z}function he(t,Z,$,p,u,E){if(!t)return m;var q=1;if(Z===a&&(Z=6),p<0?(q=0,p=-p):15<p&&(q=2,p-=16),u<1||w<u||$!==v||p<8||15<p||Z<0||9<Z||E<0||c<E)return J(t,m);p===8&&(p=9);var H=new te;return(t.state=H).strm=t,H.wrap=q,H.gzhead=null,H.w_bits=p,H.w_size=1<<H.w_bits,H.w_mask=H.w_size-1,H.hash_bits=u+7,H.hash_size=1<<H.hash_bits,H.hash_mask=H.hash_size-1,H.hash_shift=~~((H.hash_bits+I-1)/I),H.window=new i.Buf8(2*H.w_size),H.head=new i.Buf16(H.hash_size),H.prev=new i.Buf16(H.w_size),H.lit_bufsize=1<<u+6,H.pending_buf_size=4*H.lit_bufsize,H.pending_buf=new i.Buf8(H.pending_buf_size),H.d_buf=1*H.lit_bufsize,H.l_buf=3*H.lit_bufsize,H.level=Z,H.strategy=E,H.method=$,le(t)}d=[new ae(0,0,0,0,function(t,Z){var $=65535;for($>t.pending_buf_size-5&&($=t.pending_buf_size-5);;){if(t.lookahead<=1){if(ee(t),t.lookahead===0&&Z===y)return r;if(t.lookahead===0)break}t.strstart+=t.lookahead,t.lookahead=0;var p=t.block_start+$;if((t.strstart===0||t.strstart>=p)&&(t.lookahead=t.strstart-p,t.strstart=p,F(t,!1),t.strm.avail_out===0)||t.strstart-t.block_start>=t.w_size-O&&(F(t,!1),t.strm.avail_out===0))return r}return t.insert=0,Z===_?(F(t,!0),t.strm.avail_out===0?W:L):(t.strstart>t.block_start&&(F(t,!1),t.strm.avail_out),r)}),new ae(4,4,8,4,ie),new ae(4,5,16,8,ie),new ae(4,6,32,32,ie),new ae(4,4,16,16,re),new ae(8,16,32,32,re),new ae(8,16,128,128,re),new ae(8,32,128,256,re),new ae(32,128,258,1024,re),new ae(32,258,258,4096,re)],b.deflateInit=function(t,Z){return he(t,Z,v,15,8,0)},b.deflateInit2=he,b.deflateReset=le,b.deflateResetKeep=de,b.deflateSetHeader=function(t,Z){return t&&t.state?t.state.wrap!==2?m:(t.state.gzhead=Z,s):m},b.deflate=function(t,Z){var $,p,u,E;if(!t||!t.state||5<Z||Z<0)return t?J(t,m):m;if(p=t.state,!t.output||!t.input&&t.avail_in!==0||p.status===666&&Z!==_)return J(t,t.avail_out===0?-5:m);if(p.strm=t,$=p.last_flush,p.last_flush=Z,p.status===f)if(p.wrap===2)t.adler=0,ne(p,31),ne(p,139),ne(p,8),p.gzhead?(ne(p,(p.gzhead.text?1:0)+(p.gzhead.hcrc?2:0)+(p.gzhead.extra?4:0)+(p.gzhead.name?8:0)+(p.gzhead.comment?16:0)),ne(p,255&p.gzhead.time),ne(p,p.gzhead.time>>8&255),ne(p,p.gzhead.time>>16&255),ne(p,p.gzhead.time>>24&255),ne(p,p.level===9?2:2<=p.strategy||p.level<2?4:0),ne(p,255&p.gzhead.os),p.gzhead.extra&&p.gzhead.extra.length&&(ne(p,255&p.gzhead.extra.length),ne(p,p.gzhead.extra.length>>8&255)),p.gzhead.hcrc&&(t.adler=j(t.adler,p.pending_buf,p.pending,0)),p.gzindex=0,p.status=69):(ne(p,0),ne(p,0),ne(p,0),ne(p,0),ne(p,0),ne(p,p.level===9?2:2<=p.strategy||p.level<2?4:0),ne(p,3),p.status=z);else{var q=v+(p.w_bits-8<<4)<<8;q|=(2<=p.strategy||p.level<2?0:p.level<6?1:p.level===6?2:3)<<6,p.strstart!==0&&(q|=32),q+=31-q%31,p.status=z,N(p,q),p.strstart!==0&&(N(p,t.adler>>>16),N(p,65535&t.adler)),t.adler=1}if(p.status===69)if(p.gzhead.extra){for(u=p.pending;p.gzindex<(65535&p.gzhead.extra.length)&&(p.pending!==p.pending_buf_size||(p.gzhead.hcrc&&p.pending>u&&(t.adler=j(t.adler,p.pending_buf,p.pending-u,u)),R(t),u=p.pending,p.pending!==p.pending_buf_size));)ne(p,255&p.gzhead.extra[p.gzindex]),p.gzindex++;p.gzhead.hcrc&&p.pending>u&&(t.adler=j(t.adler,p.pending_buf,p.pending-u,u)),p.gzindex===p.gzhead.extra.length&&(p.gzindex=0,p.status=73)}else p.status=73;if(p.status===73)if(p.gzhead.name){u=p.pending;do{if(p.pending===p.pending_buf_size&&(p.gzhead.hcrc&&p.pending>u&&(t.adler=j(t.adler,p.pending_buf,p.pending-u,u)),R(t),u=p.pending,p.pending===p.pending_buf_size)){E=1;break}E=p.gzindex<p.gzhead.name.length?255&p.gzhead.name.charCodeAt(p.gzindex++):0,ne(p,E)}while(E!==0);p.gzhead.hcrc&&p.pending>u&&(t.adler=j(t.adler,p.pending_buf,p.pending-u,u)),E===0&&(p.gzindex=0,p.status=91)}else p.status=91;if(p.status===91)if(p.gzhead.comment){u=p.pending;do{if(p.pending===p.pending_buf_size&&(p.gzhead.hcrc&&p.pending>u&&(t.adler=j(t.adler,p.pending_buf,p.pending-u,u)),R(t),u=p.pending,p.pending===p.pending_buf_size)){E=1;break}E=p.gzindex<p.gzhead.comment.length?255&p.gzhead.comment.charCodeAt(p.gzindex++):0,ne(p,E)}while(E!==0);p.gzhead.hcrc&&p.pending>u&&(t.adler=j(t.adler,p.pending_buf,p.pending-u,u)),E===0&&(p.status=103)}else p.status=103;if(p.status===103&&(p.gzhead.hcrc?(p.pending+2>p.pending_buf_size&&R(t),p.pending+2<=p.pending_buf_size&&(ne(p,255&t.adler),ne(p,t.adler>>8&255),t.adler=0,p.status=z)):p.status=z),p.pending!==0){if(R(t),t.avail_out===0)return p.last_flush=-1,s}else if(t.avail_in===0&&G(Z)<=G($)&&Z!==_)return J(t,-5);if(p.status===666&&t.avail_in!==0)return J(t,-5);if(t.avail_in!==0||p.lookahead!==0||Z!==y&&p.status!==666){var H=p.strategy===2?function(D,Y){for(var Q;;){if(D.lookahead===0&&(ee(D),D.lookahead===0)){if(Y===y)return r;break}if(D.match_length=0,Q=n._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++,Q&&(F(D,!1),D.strm.avail_out===0))return r}return D.insert=0,Y===_?(F(D,!0),D.strm.avail_out===0?W:L):D.last_lit&&(F(D,!1),D.strm.avail_out===0)?r:B}(p,Z):p.strategy===3?function(D,Y){for(var Q,X,se,pe,ce=D.window;;){if(D.lookahead<=V){if(ee(D),D.lookahead<=V&&Y===y)return r;if(D.lookahead===0)break}if(D.match_length=0,D.lookahead>=I&&0<D.strstart&&(X=ce[se=D.strstart-1])===ce[++se]&&X===ce[++se]&&X===ce[++se]){pe=D.strstart+V;do;while(X===ce[++se]&&X===ce[++se]&&X===ce[++se]&&X===ce[++se]&&X===ce[++se]&&X===ce[++se]&&X===ce[++se]&&X===ce[++se]&&se<pe);D.match_length=V-(pe-se),D.match_length>D.lookahead&&(D.match_length=D.lookahead)}if(D.match_length>=I?(Q=n._tr_tally(D,1,D.match_length-I),D.lookahead-=D.match_length,D.strstart+=D.match_length,D.match_length=0):(Q=n._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++),Q&&(F(D,!1),D.strm.avail_out===0))return r}return D.insert=0,Y===_?(F(D,!0),D.strm.avail_out===0?W:L):D.last_lit&&(F(D,!1),D.strm.avail_out===0)?r:B}(p,Z):d[p.level].func(p,Z);if(H!==W&&H!==L||(p.status=666),H===r||H===W)return t.avail_out===0&&(p.last_flush=-1),s;if(H===B&&(Z===1?n._tr_align(p):Z!==5&&(n._tr_stored_block(p,0,0,!1),Z===3&&(K(p.head),p.lookahead===0&&(p.strstart=0,p.block_start=0,p.insert=0))),R(t),t.avail_out===0))return p.last_flush=-1,s}return Z!==_?s:p.wrap<=0?1:(p.wrap===2?(ne(p,255&t.adler),ne(p,t.adler>>8&255),ne(p,t.adler>>16&255),ne(p,t.adler>>24&255),ne(p,255&t.total_in),ne(p,t.total_in>>8&255),ne(p,t.total_in>>16&255),ne(p,t.total_in>>24&255)):(N(p,t.adler>>>16),N(p,65535&t.adler)),R(t),0<p.wrap&&(p.wrap=-p.wrap),p.pending!==0?s:1)},b.deflateEnd=function(t){var Z;return t&&t.state?(Z=t.state.status)!==f&&Z!==69&&Z!==73&&Z!==91&&Z!==103&&Z!==z&&Z!==666?J(t,m):(t.state=null,Z===z?J(t,-3):s):m},b.deflateSetDictionary=function(t,Z){var $,p,u,E,q,H,D,Y,Q=Z.length;if(!t||!t.state||(E=($=t.state).wrap)===2||E===1&&$.status!==f||$.lookahead)return m;for(E===1&&(t.adler=l(t.adler,Z,Q,0)),$.wrap=0,Q>=$.w_size&&(E===0&&(K($.head),$.strstart=0,$.block_start=0,$.insert=0),Y=new i.Buf8($.w_size),i.arraySet(Y,Z,Q-$.w_size,$.w_size,0),Z=Y,Q=$.w_size),q=t.avail_in,H=t.next_in,D=t.input,t.avail_in=Q,t.next_in=0,t.input=Z,ee($);$.lookahead>=I;){for(p=$.strstart,u=$.lookahead-(I-1);$.ins_h=($.ins_h<<$.hash_shift^$.window[p+I-1])&$.hash_mask,$.prev[p&$.w_mask]=$.head[$.ins_h],$.head[$.ins_h]=p,p++,--u;);$.strstart=p,$.lookahead=I-1,ee($)}return $.strstart+=$.lookahead,$.block_start=$.strstart,$.insert=$.lookahead,$.lookahead=0,$.match_length=$.prev_length=I-1,$.match_available=0,t.next_in=H,t.input=D,t.avail_in=q,$.wrap=E,s},b.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(g,P,b){P.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(g,P,b){P.exports=function(d,i){var n,l,j,k,y,_,s,m,a,c,o,v,w,C,h,U,S,T,I,V,O,f,z,r,B;n=d.state,l=d.next_in,r=d.input,j=l+(d.avail_in-5),k=d.next_out,B=d.output,y=k-(i-d.avail_out),_=k+(d.avail_out-257),s=n.dmax,m=n.wsize,a=n.whave,c=n.wnext,o=n.window,v=n.hold,w=n.bits,C=n.lencode,h=n.distcode,U=(1<<n.lenbits)-1,S=(1<<n.distbits)-1;e:do{w<15&&(v+=r[l++]<<w,w+=8,v+=r[l++]<<w,w+=8),T=C[v&U];t:for(;;){if(v>>>=I=T>>>24,w-=I,(I=T>>>16&255)===0)B[k++]=65535&T;else{if(!(16&I)){if(!(64&I)){T=C[(65535&T)+(v&(1<<I)-1)];continue t}if(32&I){n.mode=12;break e}d.msg="invalid literal/length code",n.mode=30;break e}V=65535&T,(I&=15)&&(w<I&&(v+=r[l++]<<w,w+=8),V+=v&(1<<I)-1,v>>>=I,w-=I),w<15&&(v+=r[l++]<<w,w+=8,v+=r[l++]<<w,w+=8),T=h[v&S];r:for(;;){if(v>>>=I=T>>>24,w-=I,!(16&(I=T>>>16&255))){if(!(64&I)){T=h[(65535&T)+(v&(1<<I)-1)];continue r}d.msg="invalid distance code",n.mode=30;break e}if(O=65535&T,w<(I&=15)&&(v+=r[l++]<<w,(w+=8)<I&&(v+=r[l++]<<w,w+=8)),s<(O+=v&(1<<I)-1)){d.msg="invalid distance too far back",n.mode=30;break e}if(v>>>=I,w-=I,(I=k-y)<O){if(a<(I=O-I)&&n.sane){d.msg="invalid distance too far back",n.mode=30;break e}if(z=o,(f=0)===c){if(f+=m-I,I<V){for(V-=I;B[k++]=o[f++],--I;);f=k-O,z=B}}else if(c<I){if(f+=m+c-I,(I-=c)<V){for(V-=I;B[k++]=o[f++],--I;);if(f=0,c<V){for(V-=I=c;B[k++]=o[f++],--I;);f=k-O,z=B}}}else if(f+=c-I,I<V){for(V-=I;B[k++]=o[f++],--I;);f=k-O,z=B}for(;2<V;)B[k++]=z[f++],B[k++]=z[f++],B[k++]=z[f++],V-=3;V&&(B[k++]=z[f++],1<V&&(B[k++]=z[f++]))}else{for(f=k-O;B[k++]=B[f++],B[k++]=B[f++],B[k++]=B[f++],2<(V-=3););V&&(B[k++]=B[f++],1<V&&(B[k++]=B[f++]))}break}}break}}while(l<j&&k<_);l-=V=w>>3,v&=(1<<(w-=V<<3))-1,d.next_in=l,d.next_out=k,d.avail_in=l<j?j-l+5:5-(l-j),d.avail_out=k<_?_-k+257:257-(k-_),n.hold=v,n.bits=w}},{}],49:[function(g,P,b){var d=g("../utils/common"),i=g("./adler32"),n=g("./crc32"),l=g("./inffast"),j=g("./inftrees"),k=1,y=2,_=0,s=-2,m=1,a=852,c=592;function o(f){return(f>>>24&255)+(f>>>8&65280)+((65280&f)<<8)+((255&f)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new d.Buf16(320),this.work=new d.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function w(f){var z;return f&&f.state?(z=f.state,f.total_in=f.total_out=z.total=0,f.msg="",z.wrap&&(f.adler=1&z.wrap),z.mode=m,z.last=0,z.havedict=0,z.dmax=32768,z.head=null,z.hold=0,z.bits=0,z.lencode=z.lendyn=new d.Buf32(a),z.distcode=z.distdyn=new d.Buf32(c),z.sane=1,z.back=-1,_):s}function C(f){var z;return f&&f.state?((z=f.state).wsize=0,z.whave=0,z.wnext=0,w(f)):s}function h(f,z){var r,B;return f&&f.state?(B=f.state,z<0?(r=0,z=-z):(r=1+(z>>4),z<48&&(z&=15)),z&&(z<8||15<z)?s:(B.window!==null&&B.wbits!==z&&(B.window=null),B.wrap=r,B.wbits=z,C(f))):s}function U(f,z){var r,B;return f?(B=new v,(f.state=B).window=null,(r=h(f,z))!==_&&(f.state=null),r):s}var S,T,I=!0;function V(f){if(I){var z;for(S=new d.Buf32(512),T=new d.Buf32(32),z=0;z<144;)f.lens[z++]=8;for(;z<256;)f.lens[z++]=9;for(;z<280;)f.lens[z++]=7;for(;z<288;)f.lens[z++]=8;for(j(k,f.lens,0,288,S,0,f.work,{bits:9}),z=0;z<32;)f.lens[z++]=5;j(y,f.lens,0,32,T,0,f.work,{bits:5}),I=!1}f.lencode=S,f.lenbits=9,f.distcode=T,f.distbits=5}function O(f,z,r,B){var W,L=f.state;return L.window===null&&(L.wsize=1<<L.wbits,L.wnext=0,L.whave=0,L.window=new d.Buf8(L.wsize)),B>=L.wsize?(d.arraySet(L.window,z,r-L.wsize,L.wsize,0),L.wnext=0,L.whave=L.wsize):(B<(W=L.wsize-L.wnext)&&(W=B),d.arraySet(L.window,z,r-B,W,L.wnext),(B-=W)?(d.arraySet(L.window,z,r-B,B,0),L.wnext=B,L.whave=L.wsize):(L.wnext+=W,L.wnext===L.wsize&&(L.wnext=0),L.whave<L.wsize&&(L.whave+=W))),0}b.inflateReset=C,b.inflateReset2=h,b.inflateResetKeep=w,b.inflateInit=function(f){return U(f,15)},b.inflateInit2=U,b.inflate=function(f,z){var r,B,W,L,J,G,K,R,F,ne,N,M,ee,ie,re,ae,te,de,le,he,t,Z,$,p,u=0,E=new d.Buf8(4),q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!f||!f.state||!f.output||!f.input&&f.avail_in!==0)return s;(r=f.state).mode===12&&(r.mode=13),J=f.next_out,W=f.output,K=f.avail_out,L=f.next_in,B=f.input,G=f.avail_in,R=r.hold,F=r.bits,ne=G,N=K,Z=_;e:for(;;)switch(r.mode){case m:if(r.wrap===0){r.mode=13;break}for(;F<16;){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}if(2&r.wrap&&R===35615){E[r.check=0]=255&R,E[1]=R>>>8&255,r.check=n(r.check,E,2,0),F=R=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&R)<<8)+(R>>8))%31){f.msg="incorrect header check",r.mode=30;break}if((15&R)!=8){f.msg="unknown compression method",r.mode=30;break}if(F-=4,t=8+(15&(R>>>=4)),r.wbits===0)r.wbits=t;else if(t>r.wbits){f.msg="invalid window size",r.mode=30;break}r.dmax=1<<t,f.adler=r.check=1,r.mode=512&R?10:12,F=R=0;break;case 2:for(;F<16;){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}if(r.flags=R,(255&r.flags)!=8){f.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){f.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=R>>8&1),512&r.flags&&(E[0]=255&R,E[1]=R>>>8&255,r.check=n(r.check,E,2,0)),F=R=0,r.mode=3;case 3:for(;F<32;){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}r.head&&(r.head.time=R),512&r.flags&&(E[0]=255&R,E[1]=R>>>8&255,E[2]=R>>>16&255,E[3]=R>>>24&255,r.check=n(r.check,E,4,0)),F=R=0,r.mode=4;case 4:for(;F<16;){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}r.head&&(r.head.xflags=255&R,r.head.os=R>>8),512&r.flags&&(E[0]=255&R,E[1]=R>>>8&255,r.check=n(r.check,E,2,0)),F=R=0,r.mode=5;case 5:if(1024&r.flags){for(;F<16;){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}r.length=R,r.head&&(r.head.extra_len=R),512&r.flags&&(E[0]=255&R,E[1]=R>>>8&255,r.check=n(r.check,E,2,0)),F=R=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(G<(M=r.length)&&(M=G),M&&(r.head&&(t=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),d.arraySet(r.head.extra,B,L,M,t)),512&r.flags&&(r.check=n(r.check,B,M,L)),G-=M,L+=M,r.length-=M),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(G===0)break e;for(M=0;t=B[L+M++],r.head&&t&&r.length<65536&&(r.head.name+=String.fromCharCode(t)),t&&M<G;);if(512&r.flags&&(r.check=n(r.check,B,M,L)),G-=M,L+=M,t)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(G===0)break e;for(M=0;t=B[L+M++],r.head&&t&&r.length<65536&&(r.head.comment+=String.fromCharCode(t)),t&&M<G;);if(512&r.flags&&(r.check=n(r.check,B,M,L)),G-=M,L+=M,t)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;F<16;){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}if(R!==(65535&r.check)){f.msg="header crc mismatch",r.mode=30;break}F=R=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),f.adler=r.check=0,r.mode=12;break;case 10:for(;F<32;){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}f.adler=r.check=o(R),F=R=0,r.mode=11;case 11:if(r.havedict===0)return f.next_out=J,f.avail_out=K,f.next_in=L,f.avail_in=G,r.hold=R,r.bits=F,2;f.adler=r.check=1,r.mode=12;case 12:if(z===5||z===6)break e;case 13:if(r.last){R>>>=7&F,F-=7&F,r.mode=27;break}for(;F<3;){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}switch(r.last=1&R,F-=1,3&(R>>>=1)){case 0:r.mode=14;break;case 1:if(V(r),r.mode=20,z!==6)break;R>>>=2,F-=2;break e;case 2:r.mode=17;break;case 3:f.msg="invalid block type",r.mode=30}R>>>=2,F-=2;break;case 14:for(R>>>=7&F,F-=7&F;F<32;){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}if((65535&R)!=(R>>>16^65535)){f.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&R,F=R=0,r.mode=15,z===6)break e;case 15:r.mode=16;case 16:if(M=r.length){if(G<M&&(M=G),K<M&&(M=K),M===0)break e;d.arraySet(W,B,L,M,J),G-=M,L+=M,K-=M,J+=M,r.length-=M;break}r.mode=12;break;case 17:for(;F<14;){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}if(r.nlen=257+(31&R),R>>>=5,F-=5,r.ndist=1+(31&R),R>>>=5,F-=5,r.ncode=4+(15&R),R>>>=4,F-=4,286<r.nlen||30<r.ndist){f.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;F<3;){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}r.lens[q[r.have++]]=7&R,R>>>=3,F-=3}for(;r.have<19;)r.lens[q[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,$={bits:r.lenbits},Z=j(0,r.lens,0,19,r.lencode,0,r.work,$),r.lenbits=$.bits,Z){f.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;ae=(u=r.lencode[R&(1<<r.lenbits)-1])>>>16&255,te=65535&u,!((re=u>>>24)<=F);){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}if(te<16)R>>>=re,F-=re,r.lens[r.have++]=te;else{if(te===16){for(p=re+2;F<p;){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}if(R>>>=re,F-=re,r.have===0){f.msg="invalid bit length repeat",r.mode=30;break}t=r.lens[r.have-1],M=3+(3&R),R>>>=2,F-=2}else if(te===17){for(p=re+3;F<p;){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}F-=re,t=0,M=3+(7&(R>>>=re)),R>>>=3,F-=3}else{for(p=re+7;F<p;){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}F-=re,t=0,M=11+(127&(R>>>=re)),R>>>=7,F-=7}if(r.have+M>r.nlen+r.ndist){f.msg="invalid bit length repeat",r.mode=30;break}for(;M--;)r.lens[r.have++]=t}}if(r.mode===30)break;if(r.lens[256]===0){f.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,$={bits:r.lenbits},Z=j(k,r.lens,0,r.nlen,r.lencode,0,r.work,$),r.lenbits=$.bits,Z){f.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,$={bits:r.distbits},Z=j(y,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,$),r.distbits=$.bits,Z){f.msg="invalid distances set",r.mode=30;break}if(r.mode=20,z===6)break e;case 20:r.mode=21;case 21:if(6<=G&&258<=K){f.next_out=J,f.avail_out=K,f.next_in=L,f.avail_in=G,r.hold=R,r.bits=F,l(f,N),J=f.next_out,W=f.output,K=f.avail_out,L=f.next_in,B=f.input,G=f.avail_in,R=r.hold,F=r.bits,r.mode===12&&(r.back=-1);break}for(r.back=0;ae=(u=r.lencode[R&(1<<r.lenbits)-1])>>>16&255,te=65535&u,!((re=u>>>24)<=F);){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}if(ae&&!(240&ae)){for(de=re,le=ae,he=te;ae=(u=r.lencode[he+((R&(1<<de+le)-1)>>de)])>>>16&255,te=65535&u,!(de+(re=u>>>24)<=F);){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}R>>>=de,F-=de,r.back+=de}if(R>>>=re,F-=re,r.back+=re,r.length=te,ae===0){r.mode=26;break}if(32&ae){r.back=-1,r.mode=12;break}if(64&ae){f.msg="invalid literal/length code",r.mode=30;break}r.extra=15&ae,r.mode=22;case 22:if(r.extra){for(p=r.extra;F<p;){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}r.length+=R&(1<<r.extra)-1,R>>>=r.extra,F-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;ae=(u=r.distcode[R&(1<<r.distbits)-1])>>>16&255,te=65535&u,!((re=u>>>24)<=F);){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}if(!(240&ae)){for(de=re,le=ae,he=te;ae=(u=r.distcode[he+((R&(1<<de+le)-1)>>de)])>>>16&255,te=65535&u,!(de+(re=u>>>24)<=F);){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}R>>>=de,F-=de,r.back+=de}if(R>>>=re,F-=re,r.back+=re,64&ae){f.msg="invalid distance code",r.mode=30;break}r.offset=te,r.extra=15&ae,r.mode=24;case 24:if(r.extra){for(p=r.extra;F<p;){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}r.offset+=R&(1<<r.extra)-1,R>>>=r.extra,F-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){f.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(K===0)break e;if(M=N-K,r.offset>M){if((M=r.offset-M)>r.whave&&r.sane){f.msg="invalid distance too far back",r.mode=30;break}ee=M>r.wnext?(M-=r.wnext,r.wsize-M):r.wnext-M,M>r.length&&(M=r.length),ie=r.window}else ie=W,ee=J-r.offset,M=r.length;for(K<M&&(M=K),K-=M,r.length-=M;W[J++]=ie[ee++],--M;);r.length===0&&(r.mode=21);break;case 26:if(K===0)break e;W[J++]=r.length,K--,r.mode=21;break;case 27:if(r.wrap){for(;F<32;){if(G===0)break e;G--,R|=B[L++]<<F,F+=8}if(N-=K,f.total_out+=N,r.total+=N,N&&(f.adler=r.check=r.flags?n(r.check,W,N,J-N):i(r.check,W,N,J-N)),N=K,(r.flags?R:o(R))!==r.check){f.msg="incorrect data check",r.mode=30;break}F=R=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;F<32;){if(G===0)break e;G--,R+=B[L++]<<F,F+=8}if(R!==(4294967295&r.total)){f.msg="incorrect length check",r.mode=30;break}F=R=0}r.mode=29;case 29:Z=1;break e;case 30:Z=-3;break e;case 31:return-4;case 32:default:return s}return f.next_out=J,f.avail_out=K,f.next_in=L,f.avail_in=G,r.hold=R,r.bits=F,(r.wsize||N!==f.avail_out&&r.mode<30&&(r.mode<27||z!==4))&&O(f,f.output,f.next_out,N-f.avail_out)?(r.mode=31,-4):(ne-=f.avail_in,N-=f.avail_out,f.total_in+=ne,f.total_out+=N,r.total+=N,r.wrap&&N&&(f.adler=r.check=r.flags?n(r.check,W,N,f.next_out-N):i(r.check,W,N,f.next_out-N)),f.data_type=r.bits+(r.last?64:0)+(r.mode===12?128:0)+(r.mode===20||r.mode===15?256:0),(ne==0&&N===0||z===4)&&Z===_&&(Z=-5),Z)},b.inflateEnd=function(f){if(!f||!f.state)return s;var z=f.state;return z.window&&(z.window=null),f.state=null,_},b.inflateGetHeader=function(f,z){var r;return f&&f.state&&2&(r=f.state).wrap?((r.head=z).done=!1,_):s},b.inflateSetDictionary=function(f,z){var r,B=z.length;return f&&f.state?(r=f.state).wrap!==0&&r.mode!==11?s:r.mode===11&&i(1,z,B,0)!==r.check?-3:O(f,z,B,B)?(r.mode=31,-4):(r.havedict=1,_):s},b.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(g,P,b){var d=g("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],j=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];P.exports=function(k,y,_,s,m,a,c,o){var v,w,C,h,U,S,T,I,V,O=o.bits,f=0,z=0,r=0,B=0,W=0,L=0,J=0,G=0,K=0,R=0,F=null,ne=0,N=new d.Buf16(16),M=new d.Buf16(16),ee=null,ie=0;for(f=0;f<=15;f++)N[f]=0;for(z=0;z<s;z++)N[y[_+z]]++;for(W=O,B=15;1<=B&&N[B]===0;B--);if(B<W&&(W=B),B===0)return m[a++]=20971520,m[a++]=20971520,o.bits=1,0;for(r=1;r<B&&N[r]===0;r++);for(W<r&&(W=r),f=G=1;f<=15;f++)if(G<<=1,(G-=N[f])<0)return-1;if(0<G&&(k===0||B!==1))return-1;for(M[1]=0,f=1;f<15;f++)M[f+1]=M[f]+N[f];for(z=0;z<s;z++)y[_+z]!==0&&(c[M[y[_+z]]++]=z);if(S=k===0?(F=ee=c,19):k===1?(F=i,ne-=257,ee=n,ie-=257,256):(F=l,ee=j,-1),f=r,U=a,J=z=R=0,C=-1,h=(K=1<<(L=W))-1,k===1&&852<K||k===2&&592<K)return 1;for(;;){for(T=f-J,V=c[z]<S?(I=0,c[z]):c[z]>S?(I=ee[ie+c[z]],F[ne+c[z]]):(I=96,0),v=1<<f-J,r=w=1<<L;m[U+(R>>J)+(w-=v)]=T<<24|I<<16|V|0,w!==0;);for(v=1<<f-1;R&v;)v>>=1;if(v!==0?(R&=v-1,R+=v):R=0,z++,--N[f]==0){if(f===B)break;f=y[_+c[z]]}if(W<f&&(R&h)!==C){for(J===0&&(J=W),U+=r,G=1<<(L=f-J);L+J<B&&!((G-=N[L+J])<=0);)L++,G<<=1;if(K+=1<<L,k===1&&852<K||k===2&&592<K)return 1;m[C=R&h]=W<<24|L<<16|U-a|0}}return R!==0&&(m[U+R]=f-J<<24|64<<16|0),o.bits=W,0}},{"../utils/common":41}],51:[function(g,P,b){P.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(g,P,b){var d=g("../utils/common"),i=0,n=1;function l(u){for(var E=u.length;0<=--E;)u[E]=0}var j=0,k=29,y=256,_=y+1+k,s=30,m=19,a=2*_+1,c=15,o=16,v=7,w=256,C=16,h=17,U=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],T=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],O=new Array(2*(_+2));l(O);var f=new Array(2*s);l(f);var z=new Array(512);l(z);var r=new Array(256);l(r);var B=new Array(k);l(B);var W,L,J,G=new Array(s);function K(u,E,q,H,D){this.static_tree=u,this.extra_bits=E,this.extra_base=q,this.elems=H,this.max_length=D,this.has_stree=u&&u.length}function R(u,E){this.dyn_tree=u,this.max_code=0,this.stat_desc=E}function F(u){return u<256?z[u]:z[256+(u>>>7)]}function ne(u,E){u.pending_buf[u.pending++]=255&E,u.pending_buf[u.pending++]=E>>>8&255}function N(u,E,q){u.bi_valid>o-q?(u.bi_buf|=E<<u.bi_valid&65535,ne(u,u.bi_buf),u.bi_buf=E>>o-u.bi_valid,u.bi_valid+=q-o):(u.bi_buf|=E<<u.bi_valid&65535,u.bi_valid+=q)}function M(u,E,q){N(u,q[2*E],q[2*E+1])}function ee(u,E){for(var q=0;q|=1&u,u>>>=1,q<<=1,0<--E;);return q>>>1}function ie(u,E,q){var H,D,Y=new Array(c+1),Q=0;for(H=1;H<=c;H++)Y[H]=Q=Q+q[H-1]<<1;for(D=0;D<=E;D++){var X=u[2*D+1];X!==0&&(u[2*D]=ee(Y[X]++,X))}}function re(u){var E;for(E=0;E<_;E++)u.dyn_ltree[2*E]=0;for(E=0;E<s;E++)u.dyn_dtree[2*E]=0;for(E=0;E<m;E++)u.bl_tree[2*E]=0;u.dyn_ltree[2*w]=1,u.opt_len=u.static_len=0,u.last_lit=u.matches=0}function ae(u){8<u.bi_valid?ne(u,u.bi_buf):0<u.bi_valid&&(u.pending_buf[u.pending++]=u.bi_buf),u.bi_buf=0,u.bi_valid=0}function te(u,E,q,H){var D=2*E,Y=2*q;return u[D]<u[Y]||u[D]===u[Y]&&H[E]<=H[q]}function de(u,E,q){for(var H=u.heap[q],D=q<<1;D<=u.heap_len&&(D<u.heap_len&&te(E,u.heap[D+1],u.heap[D],u.depth)&&D++,!te(E,H,u.heap[D],u.depth));)u.heap[q]=u.heap[D],q=D,D<<=1;u.heap[q]=H}function le(u,E,q){var H,D,Y,Q,X=0;if(u.last_lit!==0)for(;H=u.pending_buf[u.d_buf+2*X]<<8|u.pending_buf[u.d_buf+2*X+1],D=u.pending_buf[u.l_buf+X],X++,H===0?M(u,D,E):(M(u,(Y=r[D])+y+1,E),(Q=S[Y])!==0&&N(u,D-=B[Y],Q),M(u,Y=F(--H),q),(Q=T[Y])!==0&&N(u,H-=G[Y],Q)),X<u.last_lit;);M(u,w,E)}function he(u,E){var q,H,D,Y=E.dyn_tree,Q=E.stat_desc.static_tree,X=E.stat_desc.has_stree,se=E.stat_desc.elems,pe=-1;for(u.heap_len=0,u.heap_max=a,q=0;q<se;q++)Y[2*q]!==0?(u.heap[++u.heap_len]=pe=q,u.depth[q]=0):Y[2*q+1]=0;for(;u.heap_len<2;)Y[2*(D=u.heap[++u.heap_len]=pe<2?++pe:0)]=1,u.depth[D]=0,u.opt_len--,X&&(u.static_len-=Q[2*D+1]);for(E.max_code=pe,q=u.heap_len>>1;1<=q;q--)de(u,Y,q);for(D=se;q=u.heap[1],u.heap[1]=u.heap[u.heap_len--],de(u,Y,1),H=u.heap[1],u.heap[--u.heap_max]=q,u.heap[--u.heap_max]=H,Y[2*D]=Y[2*q]+Y[2*H],u.depth[D]=(u.depth[q]>=u.depth[H]?u.depth[q]:u.depth[H])+1,Y[2*q+1]=Y[2*H+1]=D,u.heap[1]=D++,de(u,Y,1),2<=u.heap_len;);u.heap[--u.heap_max]=u.heap[1],function(ce,be){var Pe,ke,Re,xe,$e,at,Ce=be.dyn_tree,ft=be.max_code,Et=be.stat_desc.static_tree,It=be.stat_desc.has_stree,At=be.stat_desc.extra_bits,mt=be.stat_desc.extra_base,Be=be.stat_desc.max_length,We=0;for(xe=0;xe<=c;xe++)ce.bl_count[xe]=0;for(Ce[2*ce.heap[ce.heap_max]+1]=0,Pe=ce.heap_max+1;Pe<a;Pe++)Be<(xe=Ce[2*Ce[2*(ke=ce.heap[Pe])+1]+1]+1)&&(xe=Be,We++),Ce[2*ke+1]=xe,ft<ke||(ce.bl_count[xe]++,$e=0,mt<=ke&&($e=At[ke-mt]),at=Ce[2*ke],ce.opt_len+=at*(xe+$e),It&&(ce.static_len+=at*(Et[2*ke+1]+$e)));if(We!==0){do{for(xe=Be-1;ce.bl_count[xe]===0;)xe--;ce.bl_count[xe]--,ce.bl_count[xe+1]+=2,ce.bl_count[Be]--,We-=2}while(0<We);for(xe=Be;xe!==0;xe--)for(ke=ce.bl_count[xe];ke!==0;)ft<(Re=ce.heap[--Pe])||(Ce[2*Re+1]!==xe&&(ce.opt_len+=(xe-Ce[2*Re+1])*Ce[2*Re],Ce[2*Re+1]=xe),ke--)}}(u,E),ie(Y,pe,u.bl_count)}function t(u,E,q){var H,D,Y=-1,Q=E[1],X=0,se=7,pe=4;for(Q===0&&(se=138,pe=3),E[2*(q+1)+1]=65535,H=0;H<=q;H++)D=Q,Q=E[2*(H+1)+1],++X<se&&D===Q||(X<pe?u.bl_tree[2*D]+=X:D!==0?(D!==Y&&u.bl_tree[2*D]++,u.bl_tree[2*C]++):X<=10?u.bl_tree[2*h]++:u.bl_tree[2*U]++,Y=D,pe=(X=0)===Q?(se=138,3):D===Q?(se=6,3):(se=7,4))}function Z(u,E,q){var H,D,Y=-1,Q=E[1],X=0,se=7,pe=4;for(Q===0&&(se=138,pe=3),H=0;H<=q;H++)if(D=Q,Q=E[2*(H+1)+1],!(++X<se&&D===Q)){if(X<pe)for(;M(u,D,u.bl_tree),--X!=0;);else D!==0?(D!==Y&&(M(u,D,u.bl_tree),X--),M(u,C,u.bl_tree),N(u,X-3,2)):X<=10?(M(u,h,u.bl_tree),N(u,X-3,3)):(M(u,U,u.bl_tree),N(u,X-11,7));Y=D,pe=(X=0)===Q?(se=138,3):D===Q?(se=6,3):(se=7,4)}}l(G);var $=!1;function p(u,E,q,H){N(u,(j<<1)+(H?1:0),3),function(D,Y,Q,X){ae(D),ne(D,Q),ne(D,~Q),d.arraySet(D.pending_buf,D.window,Y,Q,D.pending),D.pending+=Q}(u,E,q)}b._tr_init=function(u){$||(function(){var E,q,H,D,Y,Q=new Array(c+1);for(D=H=0;D<k-1;D++)for(B[D]=H,E=0;E<1<<S[D];E++)r[H++]=D;for(r[H-1]=D,D=Y=0;D<16;D++)for(G[D]=Y,E=0;E<1<<T[D];E++)z[Y++]=D;for(Y>>=7;D<s;D++)for(G[D]=Y<<7,E=0;E<1<<T[D]-7;E++)z[256+Y++]=D;for(q=0;q<=c;q++)Q[q]=0;for(E=0;E<=143;)O[2*E+1]=8,E++,Q[8]++;for(;E<=255;)O[2*E+1]=9,E++,Q[9]++;for(;E<=279;)O[2*E+1]=7,E++,Q[7]++;for(;E<=287;)O[2*E+1]=8,E++,Q[8]++;for(ie(O,_+1,Q),E=0;E<s;E++)f[2*E+1]=5,f[2*E]=ee(E,5);W=new K(O,S,y+1,_,c),L=new K(f,T,0,s,c),J=new K(new Array(0),I,0,m,v)}(),$=!0),u.l_desc=new R(u.dyn_ltree,W),u.d_desc=new R(u.dyn_dtree,L),u.bl_desc=new R(u.bl_tree,J),u.bi_buf=0,u.bi_valid=0,re(u)},b._tr_stored_block=p,b._tr_flush_block=function(u,E,q,H){var D,Y,Q=0;0<u.level?(u.strm.data_type===2&&(u.strm.data_type=function(X){var se,pe=4093624447;for(se=0;se<=31;se++,pe>>>=1)if(1&pe&&X.dyn_ltree[2*se]!==0)return i;if(X.dyn_ltree[18]!==0||X.dyn_ltree[20]!==0||X.dyn_ltree[26]!==0)return n;for(se=32;se<y;se++)if(X.dyn_ltree[2*se]!==0)return n;return i}(u)),he(u,u.l_desc),he(u,u.d_desc),Q=function(X){var se;for(t(X,X.dyn_ltree,X.l_desc.max_code),t(X,X.dyn_dtree,X.d_desc.max_code),he(X,X.bl_desc),se=m-1;3<=se&&X.bl_tree[2*V[se]+1]===0;se--);return X.opt_len+=3*(se+1)+5+5+4,se}(u),D=u.opt_len+3+7>>>3,(Y=u.static_len+3+7>>>3)<=D&&(D=Y)):D=Y=q+5,q+4<=D&&E!==-1?p(u,E,q,H):u.strategy===4||Y===D?(N(u,2+(H?1:0),3),le(u,O,f)):(N(u,4+(H?1:0),3),function(X,se,pe,ce){var be;for(N(X,se-257,5),N(X,pe-1,5),N(X,ce-4,4),be=0;be<ce;be++)N(X,X.bl_tree[2*V[be]+1],3);Z(X,X.dyn_ltree,se-1),Z(X,X.dyn_dtree,pe-1)}(u,u.l_desc.max_code+1,u.d_desc.max_code+1,Q+1),le(u,u.dyn_ltree,u.dyn_dtree)),re(u),H&&ae(u)},b._tr_tally=function(u,E,q){return u.pending_buf[u.d_buf+2*u.last_lit]=E>>>8&255,u.pending_buf[u.d_buf+2*u.last_lit+1]=255&E,u.pending_buf[u.l_buf+u.last_lit]=255&q,u.last_lit++,E===0?u.dyn_ltree[2*q]++:(u.matches++,E--,u.dyn_ltree[2*(r[q]+y+1)]++,u.dyn_dtree[2*F(E)]++),u.last_lit===u.lit_bufsize-1},b._tr_align=function(u){N(u,2,3),M(u,w,O),function(E){E.bi_valid===16?(ne(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):8<=E.bi_valid&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)}(u)}},{"../utils/common":41}],53:[function(g,P,b){P.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(g,P,b){(function(d){(function(i,n){if(!i.setImmediate){var l,j,k,y,_=1,s={},m=!1,a=i.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(i);c=c&&c.setTimeout?c:i,l={}.toString.call(i.process)==="[object process]"?function(C){process.nextTick(function(){v(C)})}:function(){if(i.postMessage&&!i.importScripts){var C=!0,h=i.onmessage;return i.onmessage=function(){C=!1},i.postMessage("","*"),i.onmessage=h,C}}()?(y="setImmediate$"+Math.random()+"$",i.addEventListener?i.addEventListener("message",w,!1):i.attachEvent("onmessage",w),function(C){i.postMessage(y+C,"*")}):i.MessageChannel?((k=new MessageChannel).port1.onmessage=function(C){v(C.data)},function(C){k.port2.postMessage(C)}):a&&"onreadystatechange"in a.createElement("script")?(j=a.documentElement,function(C){var h=a.createElement("script");h.onreadystatechange=function(){v(C),h.onreadystatechange=null,j.removeChild(h),h=null},j.appendChild(h)}):function(C){setTimeout(v,0,C)},c.setImmediate=function(C){typeof C!="function"&&(C=new Function(""+C));for(var h=new Array(arguments.length-1),U=0;U<h.length;U++)h[U]=arguments[U+1];var S={callback:C,args:h};return s[_]=S,l(_),_++},c.clearImmediate=o}function o(C){delete s[C]}function v(C){if(m)setTimeout(v,0,C);else{var h=s[C];if(h){m=!0;try{(function(U){var S=U.callback,T=U.args;switch(T.length){case 0:S();break;case 1:S(T[0]);break;case 2:S(T[0],T[1]);break;case 3:S(T[0],T[1],T[2]);break;default:S.apply(n,T)}})(h)}finally{o(C),m=!1}}}}function w(C){C.source===i&&typeof C.data=="string"&&C.data.indexOf(y)===0&&v(+C.data.slice(y.length))}})(typeof self>"u"?d===void 0?this:d:self)}).call(this,typeof Ge<"u"?Ge:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Nt);var vr=Nt.exports;const _r=Bt(vr),yr=x=>["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"][x-1],br=({billingData:x,updateBillingData:A,prevStep:g,resetStep:P,handleSubmit:b})=>{var h,U;const{toast:d}=Me(),[i,n]=oe.useState(!1),[l,j]=oe.useState(!1),[k,y]=oe.useState([]),[_,s]=oe.useState({}),[m,a]=oe.useState(!1);oe.useEffect(()=>{async function S(){try{console.log("Carregando dados para o passo 4...");const{data:T,error:I}=await ve.from("units").select("*").order("block").order("number");if(I)throw console.error("Erro ao carregar unidades:",I),I;console.log("Unidades carregadas:",T),y(T||[]);try{console.log("Verificando se há conta com PIX...");const V=await rr();console.log("Resultado da verificação de PIX:",V),a(V),V||d({title:"Aviso",description:"Não há conta bancária com chave PIX configurada. Os QR codes PIX não serão gerados."})}catch(V){console.error("Erro ao verificar contas com PIX:",V),d({title:"Aviso",description:"Não foi possível verificar se há conta bancária com PIX. Os QR codes PIX podem não ser gerados corretamente."})}}catch(T){console.error("Erro ao carregar dados:",T),d({title:"Erro",description:"Erro ao carregar dados. Algumas funcionalidades podem não estar disponíveis.",variant:"destructive"})}}S()},[d]);const c=((h=x.chargeItems)==null?void 0:h.reduce((S,T)=>S+(T.value||0),0))||0,o=async S=>{try{const T=`${S.block}-${S.number}`;if(console.log(`Iniciando geração de fatura para a unidade ${T}...`),_[T]){console.log(`Fatura para a unidade ${T} já foi gerada.`),d({title:"Informação",description:`A fatura para a unidade ${T} já foi gerada.`});return}n(!0);const I=x.chargeItems.filter(r=>r.unit==="all"||r.unit===S.id.toString());if(console.log(`Itens de cobrança para a unidade ${T}:`,I),x.includeGasConsumption){const r=x.gasConsumptionItems.filter(B=>B.unit===S.id.toString());console.log(`Itens de consumo de gás para a unidade ${T}:`,r),I.push(...r)}if(x.includeWaterConsumption){const r=x.waterConsumptionItems.filter(B=>B.unit===S.id.toString());console.log(`Itens de consumo de água para a unidade ${T}:`,r),I.push(...r)}if(I.length===0){console.log(`Não há itens de cobrança para a unidade ${T}.`),d({title:"Informação",description:`Não há itens de cobrança para a unidade ${T}.`}),n(!1);return}const V=I.reduce((r,B)=>r+(B.value||0),0);console.log(`Total para a unidade ${T}: ${V}`),console.log("Estrutura detalhada dos itens:",JSON.stringify(I,null,2));const O=typeof x.dueDate=="string"?x.dueDate:x.dueDate instanceof Date?x.dueDate.toISOString():new Date().toISOString(),z=(await Promise.all(I.map(async r=>{try{if(r.id&&!isNaN(parseInt(r.id.toString())))return parseInt(r.id.toString());console.log(`Criando novo item de cobrança para: ${r.description}`);const B={unit:T,unit_id:S.id,resident:S.owner||"Proprietário",description:r.description,amount:r.value||0,due_date:O,status:"pending",is_printed:!1,is_sent:!1},{data:W,error:L}=await ve.from("billings").insert([B]).select();return L?(console.error(`Erro ao criar item de cobrança: ${L.message}`),null):W&&W.length>0?(console.log(`Item de cobrança criado com ID: ${W[0].id}`),W[0].id):null}catch(B){return console.error(`Erro ao processar item: ${B.message}`),null}}))).filter(r=>r!==null);if(console.log(`Novos IDs válidos para a unidade ${T}:`,z),z.length===0)throw console.error(`Não foi possível criar itens de cobrança válidos para a unidade ${T}`),new Error("Não foi possível criar itens de cobrança válidos para esta unidade");return z}catch(T){throw console.error(`Erro ao processar itens de cobrança para a unidade ${S.block}-${S.number}:`,T),T}},v=async S=>{try{const T=`${S.block}-${S.number}`,I=await o(S),V=typeof x.dueDate=="string"?x.dueDate:x.dueDate instanceof Date?x.dueDate.toISOString():new Date().toISOString();console.log("Criando fatura no banco de dados com os seguintes dados:",{unitId:S.id,unitKey:T,owner:S.owner||"Proprietário",dueDate:V,validItemIds:I,month:x.reference.month,year:x.reference.year,notes:x.notes});const O=I.map(W=>Number(W)),f=await Vt(S.id,T,S.owner||"Proprietário",V,O,x.reference.month,x.reference.year,x.notes);if(!f)throw console.error(`Falha ao criar a fatura no banco de dados para a unidade ${T}`),new Error("Falha ao criar a fatura no banco de dados");console.log(`Fatura criada com sucesso para a unidade ${T}:`,f);const z=x.chargeItems.filter(W=>W.unit==="all"||W.unit===S.id.toString()).map(W=>({id:W.id,description:W.description,value:W.value})),r=dr({...x,chargeItems:z,resident:S.owner||"Proprietário"},S);console.log("Dados da fatura preparados:",r),console.log("Gerando PDF da fatura...");const B=await kt(r);if(!B||B.size===0)throw console.error("PDF gerado está vazio"),new Error("PDF gerado está vazio");return console.log(`PDF gerado com sucesso, tamanho: ${B.size} bytes`),{invoice:f,pdfBlob:B,unitKey:T}}catch(T){throw console.error(`Erro ao processar fatura para a unidade ${S.block}-${S.number}:`,T),T}},w=async S=>{try{const T=`${S.block}-${S.number}`;if(_[T]){d({title:"Informação",description:`A fatura para a unidade ${T} já foi gerada.`});return}n(!0);const{pdfBlob:I,unitKey:V}=await v(S),O=URL.createObjectURL(I),f=document.createElement("a");f.href=O,f.download=`fatura_${S.block}-${S.number}_${x.reference.month}_${x.reference.year}.pdf`,document.body.appendChild(f),f.click(),setTimeout(()=>{document.body.removeChild(f),URL.revokeObjectURL(O)},100),s(z=>({...z,[V]:!0})),console.log(`Fatura para a unidade ${V} gerada com sucesso!`),d({title:"Sucesso",description:`Fatura para a unidade ${V} gerada com sucesso!`})}catch(T){console.error(`Erro ao gerar fatura para a unidade ${S.block}-${S.number}:`,T),d({title:"Erro",description:`Erro ao gerar fatura para a unidade ${S.block}-${S.number}: ${T.message}`,variant:"destructive"})}finally{n(!1)}},C=async()=>{try{j(!0),console.log("Iniciando geração de todas as faturas...");const S=new _r;let T=0,I=0;for(const z of k)try{const r=`${z.block}-${z.number}`;console.log(`Processando unidade: ${r}`);const{pdfBlob:B,unitKey:W}=await v(z),L=`fatura_${W}_${x.reference.month}_${x.reference.year}.pdf`;S.file(L,B),s(J=>({...J,[W]:!0})),T++}catch(r){console.error(`Erro ao processar a unidade ${z.block}-${z.number}:`,r),I++}if(T===0)throw console.error("Nenhuma fatura foi gerada com sucesso"),new Error("Nenhuma fatura foi gerada com sucesso");console.log(`Gerando arquivo ZIP com ${T} faturas`);const V=await S.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}});if(console.log(`Arquivo ZIP gerado com sucesso, tamanho: ${V.size} bytes`),!V||V.size===0)throw console.error("Arquivo ZIP gerado está vazio"),new Error("Arquivo ZIP gerado está vazio");const O=URL.createObjectURL(V),f=document.createElement("a");f.href=O,f.download=`faturas_${x.reference.month}_${x.reference.year}.zip`,document.body.appendChild(f),f.click(),setTimeout(()=>{document.body.removeChild(f),URL.revokeObjectURL(O)},100),console.log(`${T} faturas geradas com sucesso${I>0?` (${I} com erro)`:""}.`),d({title:"Sucesso",description:`${T} faturas geradas com sucesso${I>0?` (${I} com erro)`:""}.`})}catch(S){console.error("Erro ao gerar todas as faturas:",S),d({title:"Erro",description:`Erro ao gerar todas as faturas: ${S.message}`,variant:"destructive"})}finally{j(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Geração de Faturas"}),e.jsx("p",{className:"text-muted-foreground",children:"Revise as informações e gere as faturas para as unidades selecionadas."})]}),e.jsx(ze,{children:e.jsx(Fe,{className:"pt-6",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Resumo do Faturamento"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"font-medium text-sm text-muted-foreground mb-1",children:"Mês de Referência"}),e.jsxs("div",{className:"font-semibold",children:[yr(x.reference.month||1)," / ",x.reference.year||new Date().getFullYear()]})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"font-medium text-sm text-muted-foreground mb-1",children:"Data de Vencimento"}),e.jsx("div",{className:"font-semibold",children:x.dueDate?je(new Date(x.dueDate),"dd/MM/yyyy"):"Não definida"})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"font-medium text-sm text-muted-foreground mb-1",children:"Total a Faturar"}),e.jsx("div",{className:"font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c)})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Itens de Cobrança"}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Descrição"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Valor"})]})}),e.jsx("tbody",{children:(U=x.chargeItems)==null?void 0:U.map((S,T)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2",children:S.description}),e.jsx("td",{className:"px-4 py-2 text-right",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(S.value||0)})]},T))}),e.jsx("tfoot",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 font-semibold",children:"Total"}),e.jsx("td",{className:"px-4 py-2 text-right font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c)})]})})]})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Gerar Todas as Faturas"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(ue,{variant:"outline",onClick:g,disabled:i||l,children:"Voltar"}),e.jsx(ue,{variant:"default",onClick:C,disabled:i||l,children:l?e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"mr-2 h-4 w-4 animate-spin"}),"Gerando ZIP..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"mr-2 h-4 w-4"}),"Gerar Todas as Faturas (ZIP)"]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Faturas Individuais"}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Unidade"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Proprietário"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Ações"})]})}),e.jsx("tbody",{children:k.map(S=>e.jsxs("tr",{className:"border-t",children:[e.jsxs("td",{className:"px-4 py-2",children:[S.block,"-",S.number]}),e.jsx("td",{className:"px-4 py-2",children:S.owner||"Proprietário"}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsx(ue,{variant:"outline",size:"sm",onClick:()=>w(S),disabled:i||l||_[`${S.block}-${S.number}`],children:_[`${S.block}-${S.number}`]?e.jsxs(e.Fragment,{children:[e.jsx(jt,{className:"mr-2 h-4 w-4 text-green-500"}),"Gerada"]}):i?e.jsxs(e.Fragment,{children:[e.jsx(st,{className:"mr-2 h-4 w-4 animate-spin"}),"Gerando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(st,{className:"mr-2 h-4 w-4"}),"Gerar Fatura"]})})})]},S.id))})]})})]})]})})})]})},wr=({activeStep:x,prevStep:A,nextStep:g,handleSubmit:P})=>e.jsxs("div",{className:"flex justify-between mt-6",children:[x>1?e.jsxs(ue,{variant:"outline",onClick:A,children:[e.jsx(nr,{className:"mr-2 h-4 w-4"}),"Voltar"]}):e.jsx("div",{}),x<4?e.jsxs(ue,{onClick:g,children:["Avançar",e.jsx(Lt,{className:"ml-2 h-4 w-4"})]}):x===4?e.jsxs(ue,{onClick:P,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(yt,{className:"mr-2 h-4 w-4"}),"Gerar Faturas"]}):e.jsxs(ue,{variant:"outline",onClick:()=>window.location.reload(),children:[e.jsx(ir,{className:"mr-2 h-4 w-4"}),"Voltar ao Início"]})]}),jr=({activeStep:x,billingData:A,updateBillingData:g,nextStep:P,prevStep:b,resetStep:d,handleSubmit:i})=>e.jsxs("div",{className:"space-y-6",children:[e.jsx(fr,{activeStep:x}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[x===1&&e.jsx(pr,{billingData:A,updateBillingData:g,nextStep:P}),x===2&&e.jsx(gr,{billingData:A,updateBillingData:g,nextStep:P}),x===3&&e.jsx(xr,{billingData:A,updateBillingData:g,nextStep:P,prevStep:b}),x===4&&e.jsx(br,{billingData:A,updateBillingData:g,prevStep:b,resetStep:d,handleSubmit:i})]}),x!==2&&e.jsx(wr,{activeStep:x,nextStep:P,prevStep:b,handleSubmit:i})]}),kr=({activeTab:x,setActiveTab:A,activeStep:g,billingData:P,updateBillingData:b,nextStep:d,prevStep:i,resetStep:n,handleSubmit:l})=>e.jsxs(bt,{value:x,onValueChange:A,className:"w-full",children:[e.jsxs(wt,{className:"grid grid-cols-4 w-full",children:[e.jsxs(Te,{value:"generator",className:"gap-2",children:[e.jsx(st,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Gerador de Faturamento"})]}),e.jsxs(Te,{value:"history",className:"gap-2",children:[e.jsx(ar,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Histórico de Faturamentos"})]}),e.jsxs(Te,{value:"charges",className:"gap-2",children:[e.jsx(_t,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Cobranças Lançadas"})]}),e.jsxs(Te,{value:"settings",className:"gap-2",children:[e.jsx(Ut,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Configurações de Pagamento"})]})]}),e.jsx(Oe,{value:"generator",className:"mt-6",children:e.jsx(jr,{activeStep:g,billingData:P,updateBillingData:b,nextStep:d,prevStep:i,resetStep:n,handleSubmit:l})}),e.jsx(Oe,{value:"history",className:"mt-6",children:e.jsx(cr,{})}),e.jsx(Oe,{value:"charges",className:"mt-6",children:e.jsx(ur,{})}),e.jsx(Oe,{value:"settings",className:"mt-6",children:e.jsx(hr,{})})]}),Cr=()=>{const[x,A]=oe.useState({reference:{month:new Date().getMonth(),year:new Date().getFullYear()},name:"",dueDate:"",includeGasConsumption:!1,includeWaterConsumption:!1,gasConsumptionItems:[],waterConsumptionItems:[],gasConsumptionData:[],waterConsumptionData:[],consumptionPeriod:{start_date:"",end_date:""},earlyPaymentDiscount:{enabled:!1,dueDate:"",discountType:"fixed",discountValue:0},chargeItems:[],targetUnits:"all",specificUnit:"",statementPeriod:{startDate:"",endDate:""},additionalMessage:"",notes:"",existingBillings:[],selectedBillings:[],periodManuallyEdited:!1,periodAutoSet:!1});return{billingData:x,updateBillingData:b=>{A(d=>({...d,...b}))},prepareAllChargeItems:()=>{let b=[...x.chargeItems];return x.includeGasConsumption&&x.gasConsumptionItems.length>0&&(b=[...b,...x.gasConsumptionItems]),x.includeWaterConsumption&&x.waterConsumptionItems.length>0&&(b=[...b,...x.waterConsumptionItems]),b}}},Ur=()=>{const{toast:x}=Me(),[A,g]=oe.useState(1),[P,b]=oe.useState("generator"),{billingData:d,updateBillingData:i}=Cr(),n=()=>{A<ht.length&&g(A+1)},l=()=>{A>1&&g(A-1)},j=()=>{g(1)},k=()=>{x({title:"Faturamento gerado com sucesso!",description:"Os boletos foram gerados e estão disponíveis para download."}),n()};return e.jsxs("div",{className:"container max-w-7xl mx-auto py-6 space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Faturamento"}),e.jsx("p",{className:"text-muted-foreground",children:"Gere faturas para as unidades do condomínio"})]}),e.jsx(kr,{activeTab:P,setActiveTab:b,activeStep:A,billingData:d,updateBillingData:i,nextStep:n,prevStep:l,resetStep:j,handleSubmit:k})]})};export{Ur as default};
