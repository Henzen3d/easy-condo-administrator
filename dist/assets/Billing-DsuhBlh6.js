import{c as Wa,s as oe,f as Ha,r as i,u as ca,j as e,g as Ja,P as Oe,h as Qa,i as fs,k as Xa,l as js,m as vs,R as se,n as bs,o as da,I as Z,p as va,q as ba,a as U,C as ra,t as Na,v as wa,w as ya,x as Ca,y as Sa,J as u,z as Ns,A as Da,D as Ye,b as Ke,d as Ze,F as ws,G as Ea,e as de,H as _a,K as Aa,L as Ia,M as Fa,N as Pa,T as ys,O as Cs,Q as Ss,V as Ds,B as Es}from"./index-PF3D36V0.js";import{C as na,S as je,e as ve,f as be,g as Ne,h as j,D as Fe,j as Ra,a as Pe,b as Re,c as ke,d as Be,k as ka,i as _s}from"./select-BUw1FKH9.js";import{T as Te,a as $e,b as ae,c as L,d as Me,e as I,P as As}from"./table-Pv-7lEPL.js";import{L as E,T as Is,a as Fs,b as ze}from"./tabs-DTHgOjkY.js";import{E as Ba,g as Ps,a as Rs,b as ks}from"./pdfService-Bwb66BPv.js";import{f as ea,C as Ta,p as Ge,a as $a,b as Bs,P as Ts,u as Ma,m as aa}from"./calendar-BTUSM4vi.js";import{P as Oa,f as $s}from"./invoiceService-_JBDSHYM.js";import{A as Ms,a as Os,b as Ls,c as Us,d as Vs,e as zs,f as Gs,g as qs}from"./alert-dialog-BY15mkZN.js";import{I as sa}from"./info-DYRJQGRw.js";import{D as Ws}from"./download-Cr82A7Gw.js";import{E as La}from"./eye-CcKAEFEB.js";import"./addDays-Db2LM6jR.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=Wa("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=Wa("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);async function Ua(a,l){console.log(`Getting latest ${l} reading for unit ${a}`);try{const{data:t,error:d}=await oe.from("meter_readings").select("*").eq("unit_id",a).eq("utility_type",l).order("reading_date",{ascending:!1}).limit(1);return d?(console.error(`Error fetching latest ${l} meter reading:`,d),null):!t||t.length===0?(console.log(`No ${l} readings found for unit ${a}`),null):(console.log(`Found ${l} reading:`,t[0]),t[0])}catch(t){return console.error(`Exception in getLatestMeterReading for ${l}:`,t),null}}async function Va(a){console.log(`Getting current ${a} rate`);try{const{data:l,error:t}=await oe.from("utility_rates").select("*").eq("utility_type",a).order("effective_date",{ascending:!1}).limit(1);return t?(console.error(`Error fetching current ${a} rate:`,t),null):!l||l.length===0?(console.log(`No ${a} rates found`),null):(console.log(`Found ${a} rate:`,l[0]),l[0])}catch(l){return console.error(`Exception in getCurrentUtilityRate for ${a}:`,l),null}}function za(a,l,t){if(isNaN(a)||isNaN(l)||isNaN(t)||l<a)return console.log("Invalid consumption calculation inputs:",{previous:a,current:l,rate:t}),{consumption:0,total:0};const d=l-a,x=d*t;return console.log("Consumption calculation:",{previous:a,current:l,consumption:d,rate:t,total:x}),{consumption:d,total:x}}async function Ya(){console.log("Fetching units from database...");try{const{data:a,error:l}=await oe.from("units").select("*");if(l)return console.error("Error fetching units:",l),[];if(console.log(`Units fetched: ${(a==null?void 0:a.length)||0} total units`),console.log("Raw units data from database:",JSON.stringify(a,null,2)),a&&a.length>0){a.forEach((h,g)=>{console.log(`Unit ${g+1}: ID=${h.id}, Block=${h.block||"N/A"}, Number=${h.number||"N/A"}`)});const t=a.filter(h=>!h.id||!h.number||!h.block);t.length>0&&console.warn("Found units with missing critical values:",t);const d=new Set,x=a.filter(h=>{const g=`${h.block}${h.number}`;return d.has(g)?!0:(d.add(g),!1)});x.length>0&&console.warn("Found potential duplicate units:",x)}return a||[]}catch(a){return console.error("Exception while fetching units:",a),[]}}async function Ga(a,l,t){try{const{data:d,error:x}=await oe.from("billings").select("*").eq("id",a).single();if(x)throw x;if(!d)throw new Error("Cobrança não encontrada");console.log(`Updating billing ${a} ${l} to ${t}`);const{error:h}=await oe.from("billings").update({[l]:t,updated_at:new Date().toISOString()}).eq("id",a);return h?(console.error(`Error updating billing ${l}:`,h),{success:!1}):(console.log(`Billing ${a} ${l} updated successfully to ${t}`),{success:!0,billing:{...d,[l]:t}})}catch(d){return console.error(`Exception while updating billing ${l}:`,d),{success:!1}}}async function qa(a){try{console.log(`Fetching billing with id ${a}`);const{data:l,error:t}=await oe.from("billings").select("*").eq("id",a).maybeSingle();return t?(console.error("Error fetching billing:",t),null):l?(console.log("Billing fetched:",l),l):(console.log(`No billing found with id ${a}`),null)}catch(l){return console.error("Exception while fetching billing:",l),null}}var ua="Collapsible",[Qs,Ka]=Ha(ua),[Xs,ma]=Qs(ua),Za=i.forwardRef((a,l)=>{const{__scopeCollapsible:t,open:d,defaultOpen:x,disabled:h,onOpenChange:g,...y}=a,[w=!1,D]=ca({prop:d,defaultProp:x,onChange:g});return e.jsx(Xs,{scope:t,disabled:h,contentId:Ja(),open:w,onOpenToggle:i.useCallback(()=>D(F=>!F),[D]),children:e.jsx(Oe.div,{"data-state":xa(w),"data-disabled":h?"":void 0,...y,ref:l})})});Za.displayName=ua;var es="CollapsibleTrigger",as=i.forwardRef((a,l)=>{const{__scopeCollapsible:t,...d}=a,x=ma(es,t);return e.jsx(Oe.button,{type:"button","aria-controls":x.contentId,"aria-expanded":x.open||!1,"data-state":xa(x.open),"data-disabled":x.disabled?"":void 0,disabled:x.disabled,...d,ref:l,onClick:Qa(a.onClick,x.onOpenToggle)})});as.displayName=es;var ha="CollapsibleContent",ss=i.forwardRef((a,l)=>{const{forceMount:t,...d}=a,x=ma(ha,a.__scopeCollapsible);return e.jsx(fs,{present:t||x.open,children:({present:h})=>e.jsx(Ys,{...d,ref:l,present:h})})});ss.displayName=ha;var Ys=i.forwardRef((a,l)=>{const{__scopeCollapsible:t,present:d,children:x,...h}=a,g=ma(ha,t),[y,w]=i.useState(d),D=i.useRef(null),F=Xa(l,D),P=i.useRef(0),T=P.current,G=i.useRef(0),k=G.current,$=g.open||y,re=i.useRef($),z=i.useRef();return i.useEffect(()=>{const C=requestAnimationFrame(()=>re.current=!1);return()=>cancelAnimationFrame(C)},[]),js(()=>{const C=D.current;if(C){z.current=z.current||{transitionDuration:C.style.transitionDuration,animationName:C.style.animationName},C.style.transitionDuration="0s",C.style.animationName="none";const W=C.getBoundingClientRect();P.current=W.height,G.current=W.width,re.current||(C.style.transitionDuration=z.current.transitionDuration,C.style.animationName=z.current.animationName),w(d)}},[g.open,d]),e.jsx(Oe.div,{"data-state":xa(g.open),"data-disabled":g.disabled?"":void 0,id:g.contentId,hidden:!$,...h,ref:F,style:{"--radix-collapsible-content-height":T?`${T}px`:void 0,"--radix-collapsible-content-width":k?`${k}px`:void 0,...a.style},children:$&&x})});function xa(a){return a?"open":"closed"}var Ks=Za,Zs=as,er=ss,xe="Accordion",ar=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[ga,sr,rr]=vs(xe),[He,Ir]=Ha(xe,[rr,Ka]),pa=Ka(),rs=se.forwardRef((a,l)=>{const{type:t,...d}=a,x=d,h=d;return e.jsx(ga.Provider,{scope:a.__scopeAccordion,children:t==="multiple"?e.jsx(ir,{...h,ref:l}):e.jsx(or,{...x,ref:l})})});rs.displayName=xe;var[ns,nr]=He(xe),[ts,tr]=He(xe,{collapsible:!1}),or=se.forwardRef((a,l)=>{const{value:t,defaultValue:d,onValueChange:x=()=>{},collapsible:h=!1,...g}=a,[y,w]=ca({prop:t,defaultProp:d,onChange:x});return e.jsx(ns,{scope:a.__scopeAccordion,value:y?[y]:[],onItemOpen:w,onItemClose:se.useCallback(()=>h&&w(""),[h,w]),children:e.jsx(ts,{scope:a.__scopeAccordion,collapsible:h,children:e.jsx(os,{...g,ref:l})})})}),ir=se.forwardRef((a,l)=>{const{value:t,defaultValue:d,onValueChange:x=()=>{},...h}=a,[g=[],y]=ca({prop:t,defaultProp:d,onChange:x}),w=se.useCallback(F=>y((P=[])=>[...P,F]),[y]),D=se.useCallback(F=>y((P=[])=>P.filter(T=>T!==F)),[y]);return e.jsx(ns,{scope:a.__scopeAccordion,value:g,onItemOpen:w,onItemClose:D,children:e.jsx(ts,{scope:a.__scopeAccordion,collapsible:!0,children:e.jsx(os,{...h,ref:l})})})}),[lr,Je]=He(xe),os=se.forwardRef((a,l)=>{const{__scopeAccordion:t,disabled:d,dir:x,orientation:h="vertical",...g}=a,y=se.useRef(null),w=Xa(y,l),D=sr(t),P=bs(x)==="ltr",T=Qa(a.onKeyDown,G=>{var H;if(!ar.includes(G.key))return;const k=G.target,$=D().filter(ie=>{var B;return!((B=ie.ref.current)!=null&&B.disabled)}),re=$.findIndex(ie=>ie.ref.current===k),z=$.length;if(re===-1)return;G.preventDefault();let C=re;const W=0,ne=z-1,ee=()=>{C=re+1,C>ne&&(C=W)},N=()=>{C=re-1,C<W&&(C=ne)};switch(G.key){case"Home":C=W;break;case"End":C=ne;break;case"ArrowRight":h==="horizontal"&&(P?ee():N());break;case"ArrowDown":h==="vertical"&&ee();break;case"ArrowLeft":h==="horizontal"&&(P?N():ee());break;case"ArrowUp":h==="vertical"&&N();break}const ce=C%z;(H=$[ce].ref.current)==null||H.focus()});return e.jsx(lr,{scope:t,disabled:d,direction:x,orientation:h,children:e.jsx(ga.Slot,{scope:t,children:e.jsx(Oe.div,{...g,"data-orientation":h,ref:w,onKeyDown:d?void 0:T})})})}),We="AccordionItem",[cr,fa]=He(We),is=se.forwardRef((a,l)=>{const{__scopeAccordion:t,value:d,...x}=a,h=Je(We,t),g=nr(We,t),y=pa(t),w=Ja(),D=d&&g.value.includes(d)||!1,F=h.disabled||a.disabled;return e.jsx(cr,{scope:t,open:D,disabled:F,triggerId:w,children:e.jsx(Ks,{"data-orientation":h.orientation,"data-state":hs(D),...y,...x,ref:l,disabled:F,open:D,onOpenChange:P=>{P?g.onItemOpen(d):g.onItemClose(d)}})})});is.displayName=We;var ls="AccordionHeader",cs=se.forwardRef((a,l)=>{const{__scopeAccordion:t,...d}=a,x=Je(xe,t),h=fa(ls,t);return e.jsx(Oe.h3,{"data-orientation":x.orientation,"data-state":hs(h.open),"data-disabled":h.disabled?"":void 0,...d,ref:l})});cs.displayName=ls;var ta="AccordionTrigger",ds=se.forwardRef((a,l)=>{const{__scopeAccordion:t,...d}=a,x=Je(xe,t),h=fa(ta,t),g=tr(ta,t),y=pa(t);return e.jsx(ga.ItemSlot,{scope:t,children:e.jsx(Zs,{"aria-disabled":h.open&&!g.collapsible||void 0,"data-orientation":x.orientation,id:h.triggerId,...y,...d,ref:l})})});ds.displayName=ta;var us="AccordionContent",ms=se.forwardRef((a,l)=>{const{__scopeAccordion:t,...d}=a,x=Je(xe,t),h=fa(us,t),g=pa(t);return e.jsx(er,{role:"region","aria-labelledby":h.triggerId,"data-orientation":x.orientation,...g,...d,ref:l,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...a.style}})});ms.displayName=us;function hs(a){return a?"open":"closed"}var dr=rs,ur=is,mr=cs,xs=ds,gs=ms;const hr=dr,oa=i.forwardRef(({className:a,...l},t)=>e.jsx(ur,{ref:t,className:da("border-b",a),...l}));oa.displayName="AccordionItem";const ia=i.forwardRef(({className:a,children:l,...t},d)=>e.jsx(mr,{className:"flex",children:e.jsxs(xs,{ref:d,className:da("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",a),...t,children:[l,e.jsx(na,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));ia.displayName=xs.displayName;const la=i.forwardRef(({className:a,children:l,...t},d)=>e.jsx(gs,{ref:d,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...t,children:e.jsx("div",{className:da("pb-4 pt-0",a),children:l})}));la.displayName=gs.displayName;const ge="all-units",xr=({onClose:a,onSave:l})=>{const[t,d]=i.useState([]),[x,h]=i.useState([]),[g,y]=i.useState(""),[w,D]=i.useState(null),[F,P]=i.useState(""),[T,G]=i.useState("fixed"),[k,$]=i.useState("condo"),[re,z]=i.useState("renovation"),[C,W]=i.useState(""),[ne,ee]=i.useState(""),[N,ce]=i.useState(""),[H,ie]=i.useState(new Date),[B,Se]=i.useState(!1),[q,ue]=i.useState(""),[v,K]=i.useState(""),[M,O]=i.useState(""),[le,we]=i.useState(0),[me,Le]=i.useState(!0),[J,Ue]=i.useState(!1),[Q,De]=i.useState(""),[V,Ee]=i.useState(""),[he,pe]=i.useState(""),[ye,fe]=i.useState(0),[o,s]=i.useState(!0),[c,A]=i.useState(0),[p,n]=i.useState(!1),[_,S]=i.useState(!0),[_e,Ce]=i.useState(!1),Qe=r=>{if(r){const b=new Date(r.getFullYear(),r.getMonth(),1);ie(b)}};i.useEffect(()=>{async function r(){try{S(!0),console.log("Fetching units and residents...");const b=await Ya();console.log("Units data fetched:",b),b.length===0&&console.log("No units found in the database. This could indicate an empty table or permissions issue."),d(b);const{data:Y,error:te}=await oe.from("residents").select("*");if(te)throw console.error("Error fetching residents:",te),te;console.log("Residents data fetched:",Y),h(Y||[])}catch(b){console.error("Error fetching units and residents:",b),u.error("Erro ao carregar unidades e moradores")}finally{S(!1)}}r()},[]),i.useEffect(()=>{if(typeof q=="number"&&typeof v=="number"&&typeof M=="number"){const{total:r}=za(q,v,M);we(r)}else we(0)},[q,v,M]),i.useEffect(()=>{if(typeof Q=="number"&&typeof V=="number"&&typeof he=="number"){const{total:r}=za(Q,V,he);fe(r)}else fe(0)},[Q,V,he]),i.useEffect(()=>{let r=0;typeof ne=="number"&&(r+=ne),B&&(r+=le),J&&(r+=ye),A(r)},[ne,B,le,J,ye]),i.useEffect(()=>{async function r(){if(B&&M===""){const b=await Va("gas");b&&O(b.rate_per_cubic_meter)}if(J&&he===""){const b=await Va("water");b&&pe(b.rate_per_cubic_meter)}}r()},[B,J,M,he]),i.useEffect(()=>{async function r(){if(w){if(console.log("[NewBillingForm] Iniciando busca de leituras anteriores para unidade ID:",w),B){console.log("[NewBillingForm] Buscando leitura de gás atualizada do Supabase");try{const b=await Ua(w,"gas");console.log("[NewBillingForm] Resposta da busca de leitura de gás:",b),b?(console.log(`[NewBillingForm] Atribuindo valor de leitura anterior de gás: ${b.reading_value}`),ue(b.reading_value),Le(!1)):(console.log("[NewBillingForm] Nenhuma leitura de gás encontrada, configurando para leitura inicial"),ue(""),Le(!0))}catch(b){console.error("[NewBillingForm] Erro ao buscar leitura de gás:",b)}}if(J){console.log("[NewBillingForm] Buscando leitura de água atualizada do Supabase");try{const b=await Ua(w,"water");console.log("[NewBillingForm] Resposta da busca de leitura de água:",b),b?(console.log(`[NewBillingForm] Atribuindo valor de leitura anterior de água: ${b.reading_value}`),De(b.reading_value),s(!1)):(console.log("[NewBillingForm] Nenhuma leitura de água encontrada, configurando para leitura inicial"),De(""),s(!0))}catch(b){console.error("[NewBillingForm] Erro ao buscar leitura de água:",b)}}}}r()},[w,B,J]),i.useEffect(()=>{g===ge&&(G("fixed"),Se(!1),Ue(!1))},[g]);const f=r=>{if(console.log("Unit selected:",r),y(r),r===ge){D(null),P("Todos os moradores");return}const b=parseInt(r);if(isNaN(b))D(null),P("");else{D(b);const Y=t.find(te=>te.id===b);if(console.log("Selected unit object:",Y),Y){console.log("Setting resident to owner:",Y.owner),P(Y.owner);const te=x.find(Ae=>Ae.unit_id===Y.id);te&&(console.log("Found resident for unit:",te),P(te.name))}}},X=async()=>{if(!w)return;const r=[];if(B&&(me&&typeof q=="number"&&q>0&&(r.push({unit_id:w,utility_type:"gas",reading_value:q,reading_date:new Date().toISOString().split("T")[0]}),console.log("Saving initial gas reading:",q)),typeof v=="number"&&v>0&&(r.push({unit_id:w,utility_type:"gas",reading_value:v,reading_date:new Date().toISOString().split("T")[0]}),console.log("Saving current gas reading:",v))),J&&(o&&typeof Q=="number"&&Q>0&&(r.push({unit_id:w,utility_type:"water",reading_value:Q,reading_date:new Date().toISOString().split("T")[0]}),console.log("Saving initial water reading:",Q)),typeof V=="number"&&V>0&&(r.push({unit_id:w,utility_type:"water",reading_value:V,reading_date:new Date().toISOString().split("T")[0]}),console.log("Saving current water reading:",V))),r.length>0){console.log("Saving meter readings:",r);const{error:b}=await oe.from("meter_readings").insert(r);if(b)return console.error("Error saving meter readings:",b),!1}return!0},R=async()=>{try{if(!C||!N||c<=0){u.error("Por favor, preencha todos os campos obrigatórios");return}if(g===ge){Ce(!0);return}await m()}catch(r){console.error("Error in handleSubmit:",r),u.error("Erro ao processar formulário")}},Ve=async()=>{try{if(n(!0),!C||!N||c<=0){u.error("Por favor, preencha todos os campos obrigatórios"),n(!1);return}if(T==="consumption"){u.error("Cobranças de consumo não podem ser aplicadas a todas as unidades"),n(!1);return}const r=t.map(Y=>{var Ie;const te=`${Y.block}${Y.number}`,Ae=((Ie=x.find(ja=>ja.unit_id===Y.id))==null?void 0:Ie.name)||Y.owner;return{unit:te,unit_id:Y.id,resident:Ae,description:C,amount:c,due_date:N,status:"pending",is_printed:!1,is_sent:!1}});console.log(`Criando ${r.length} cobranças para todas as unidades:`,r);const{error:b}=await oe.from("billings").insert(r);if(b)throw console.error("Erro ao salvar cobranças para todas as unidades:",b),b;u.success(`${r.length} cobranças criadas com sucesso!`),l&&l(),a()}catch(r){console.error("Error saving billings for all units:",r),u.error("Erro ao salvar cobranças para todas as unidades")}finally{n(!1),Ce(!1)}},m=async()=>{try{if(n(!0),!H){u.error("Mês de referência é obrigatório");return}if(!w||!g||!F||!C||!N||c<=0){u.error("Por favor, preencha todos os campos obrigatórios"),n(!1);return}if(T==="consumption"){if(B){if(me&&(!q||typeof q=="string"||q<=0)){u.error("Por favor, informe a leitura inicial de gás"),n(!1);return}if(!v||typeof v=="string"||v<=0){u.error("Por favor, informe a leitura atual de gás"),n(!1);return}if(!me&&typeof q=="number"&&typeof v=="number"&&v<=q){u.error("A leitura atual de gás deve ser maior que a leitura anterior"),n(!1);return}}if(J){if(o&&(!Q||typeof Q=="string"||Q<=0)){u.error("Por favor, informe a leitura inicial de água"),n(!1);return}if(!V||typeof V=="string"||V<=0){u.error("Por favor, informe a leitura atual de água"),n(!1);return}if(!o&&typeof Q=="number"&&typeof V=="number"&&V<=Q){u.error("A leitura atual de água deve ser maior que a leitura anterior"),n(!1);return}}}if(!await X()){u.error("Erro ao salvar leituras de medidores"),n(!1);return}const b=t.find(ps=>ps.id===w),Y=b?`${b.block}${b.number}`:g,te=H.getFullYear(),Ae=ea(H,"MM"),Ie={unit:Y,unit_id:w,resident:F,description:C,amount:Number(c),due_date:new Date(N).toISOString().split("T")[0],status:"pending",is_printed:!1,is_sent:!1,reference_month:Ae,reference_year:te,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};console.log("Creating new billing:",Ie);const{data:ja,error:Xe}=await oe.from("billings").insert([Ie]).select();if(Xe)throw console.error("Error details:",Xe),Xe;u.success("Cobrança criada com sucesso!"),l&&l(),a()}catch(r){console.error("Error creating billing:",r),u.error("Erro ao criar cobrança")}finally{n(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"unit",children:"Unidade"}),e.jsxs(je,{value:g,onValueChange:f,children:[e.jsx(ve,{id:"unit",children:e.jsx(be,{placeholder:_?"Carregando unidades...":"Selecione uma unidade"})}),e.jsx(Ne,{children:t.length===0&&!_?e.jsx(j,{value:"no-units",disabled:!0,children:"Nenhuma unidade encontrada"}):e.jsxs(e.Fragment,{children:[e.jsx(j,{value:ge,children:"Todas as unidades"}),t.map(r=>e.jsx(j,{value:r.id.toString(),children:`${r.block}${r.number}`},r.id))]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"resident",children:"Morador"}),e.jsx(Z,{id:"resident",placeholder:"Nome do morador",value:F,onChange:r=>P(r.target.value),readOnly:w!==null,className:w!==null?"bg-gray-50":""})]})]}),g===ge&&e.jsx("div",{className:"col-span-2 bg-blue-50 border border-blue-200 rounded-md p-3 mb-2",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(sa,{className:"h-5 w-5 text-blue-500 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Cobrança para todas as unidades"}),e.jsx("p",{className:"text-xs text-blue-600",children:"Esta opção criará uma cobrança com o mesmo valor para cada unidade do condomínio. Ideal para taxas condominiais, fundos de reserva e outras cobranças fixas."})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"charge-type",children:"Tipo de Cobrança"}),e.jsxs(je,{value:T,onValueChange:G,disabled:g===ge,children:[e.jsx(ve,{id:"charge-type",children:e.jsx(be,{placeholder:"Selecione o tipo de cobrança"})}),e.jsxs(Ne,{children:[e.jsx(j,{value:"fixed",children:"Taxa Fixa"}),e.jsx(j,{value:"consumption",disabled:g===ge,children:"Consumo"}),e.jsx(j,{value:"extra",children:"Taxa Extra"}),e.jsx(j,{value:"custom",children:"Personalizado"})]})]}),g===ge&&T==="fixed"&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Cobranças de consumo não estão disponíveis para todas as unidades."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Mês de Referência"}),e.jsxs(va,{children:[e.jsx(ba,{asChild:!0,children:e.jsxs(U,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(ra,{className:"mr-2 h-4 w-4"}),ea(H,"MMMM 'de' yyyy",{locale:Ge})]})}),e.jsx(Na,{className:"w-auto p-0",align:"start",children:e.jsx(Ta,{mode:"single",selected:H,onSelect:Qe,initialFocus:!0,locale:Ge,fromMonth:new Date(2023,0),toMonth:new Date(2025,11),disabled:r=>r.getDate()!==1,ISOWeek:!0})})]})]})]}),T==="fixed"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Taxa Fixa"}),e.jsxs(je,{value:k,onValueChange:r=>$(r),children:[e.jsx(ve,{children:e.jsx(be,{placeholder:"Selecione o tipo de taxa"})}),e.jsxs(Ne,{children:[e.jsx(j,{value:"condo",children:"Taxa Condominial"}),e.jsx(j,{value:"reserve",children:"Fundo de Reserva"}),e.jsx(j,{value:"maintenance",children:"Taxa de Manutenção"}),e.jsx(j,{value:"insurance",children:"Seguro"})]})]})]}),T==="consumption"&&e.jsx(e.Fragment,{children:e.jsxs(hr,{type:"single",collapsible:!0,className:"w-full",children:[e.jsxs(oa,{value:"gas",children:[e.jsx(ia,{className:"flex items-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($a,{id:"include-gas",checked:B,onCheckedChange:r=>Se(!!r)}),e.jsx(E,{htmlFor:"include-gas",className:"font-normal cursor-pointer",children:"Consumo de Gás"}),e.jsx(wa,{children:e.jsxs(ya,{children:[e.jsx(Ca,{asChild:!0,children:e.jsx(sa,{className:"h-4 w-4 text-blue-500 cursor-help"})}),e.jsx(Sa,{className:"max-w-xs text-left",side:"right",children:e.jsxs("div",{className:"space-y-2 p-1 text-sm",children:[e.jsx("p",{className:"font-semibold",children:"Como funciona o cálculo de consumo:"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsxs("li",{children:["Na primeira cobrança, você informa a ",e.jsx("strong",{children:"Leitura Inicial"})," que servirá como referência."]}),e.jsxs("li",{children:["Nas cobranças seguintes, o sistema carrega a última leitura como ",e.jsx("strong",{children:"Leitura Anterior"}),"."]}),e.jsxs("li",{children:["Você insere a ",e.jsx("strong",{children:"Leitura Atual"})," e o sistema calcula o consumo (Atual - Anterior)."]}),e.jsx("li",{children:"A leitura atual é salva e servirá como Leitura Anterior na próxima cobrança."})]})]})})]})})]})}),e.jsx(la,{children:B&&e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"gas-previous",children:me?"Leitura Inicial de Gás (m³)":"Leitura Anterior de Gás (m³)"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Z,{id:"gas-previous",type:"number",placeholder:"Leitura anterior",value:q,onChange:r=>ue(parseFloat(r.target.value)||""),readOnly:!me,className:me?"":"bg-muted"}),me?e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Primeira leitura para esta unidade"}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Última leitura registrada"})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"gas-current",children:"Leitura Atual de Gás (m³)"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Z,{id:"gas-current",type:"number",placeholder:"Leitura atual",value:v,onChange:r=>K(parseFloat(r.target.value)||"")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Leitura atual para calcular consumo"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"gas-rate",children:"Taxa por m³ (R$)"}),e.jsx(Z,{id:"gas-rate",type:"number",min:"0",step:"0.01",value:M===""?"":M,onChange:r=>O(r.target.value===""?"":parseFloat(r.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"gas-total",children:"Total (R$)"}),e.jsx(Z,{id:"gas-total",type:"number",min:"0",step:"0.01",value:le.toFixed(2),readOnly:!0,className:"bg-gray-50"})]})]})]})})]}),e.jsxs(oa,{value:"water",children:[e.jsx(ia,{className:"flex items-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($a,{id:"include-water",checked:J,onCheckedChange:r=>Ue(!!r)}),e.jsx(E,{htmlFor:"include-water",className:"font-normal cursor-pointer",children:"Consumo de Água"}),e.jsx(wa,{children:e.jsxs(ya,{children:[e.jsx(Ca,{asChild:!0,children:e.jsx(sa,{className:"h-4 w-4 text-blue-500 cursor-help"})}),e.jsx(Sa,{className:"max-w-xs text-left",side:"right",children:e.jsxs("div",{className:"space-y-2 p-1 text-sm",children:[e.jsx("p",{className:"font-semibold",children:"Como funciona o cálculo de consumo:"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsxs("li",{children:["Na primeira cobrança, você informa a ",e.jsx("strong",{children:"Leitura Inicial"})," que servirá como referência."]}),e.jsxs("li",{children:["Nas cobranças seguintes, o sistema carrega a última leitura como ",e.jsx("strong",{children:"Leitura Anterior"}),"."]}),e.jsxs("li",{children:["Você insere a ",e.jsx("strong",{children:"Leitura Atual"})," e o sistema calcula o consumo (Atual - Anterior)."]}),e.jsx("li",{children:"A leitura atual é salva e servirá como Leitura Anterior na próxima cobrança."})]})]})})]})})]})}),e.jsx(la,{children:J&&e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"water-previous",children:o?"Leitura Inicial de Água (m³)":"Leitura Anterior de Água (m³)"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Z,{id:"water-previous",type:"number",placeholder:"Leitura anterior",value:Q,onChange:r=>De(parseFloat(r.target.value)||""),readOnly:!o,className:o?"":"bg-muted"}),o?e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Primeira leitura para esta unidade"}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Última leitura registrada"})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"water-current",children:"Leitura Atual de Água (m³)"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Z,{id:"water-current",type:"number",placeholder:"Leitura atual",value:V,onChange:r=>Ee(parseFloat(r.target.value)||"")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Leitura atual para calcular consumo"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"water-rate",children:"Taxa por m³ (R$)"}),e.jsx(Z,{id:"water-rate",type:"number",min:"0",step:"0.01",value:he===""?"":he,onChange:r=>pe(r.target.value===""?"":parseFloat(r.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"water-total",children:"Total (R$)"}),e.jsx(Z,{id:"water-total",type:"number",min:"0",step:"0.01",value:ye.toFixed(2),readOnly:!0,className:"bg-gray-50"})]})]})]})})]})]})}),T==="extra"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Taxa Extra"}),e.jsxs(je,{value:re,onValueChange:r=>z(r),children:[e.jsx(ve,{children:e.jsx(be,{placeholder:"Selecione o tipo de taxa extra"})}),e.jsxs(Ne,{children:[e.jsx(j,{value:"renovation",children:"Reforma"}),e.jsx(j,{value:"holiday",children:"Festas/Comemorações"}),e.jsx(j,{value:"special",children:"Despesa Especial"}),e.jsx(j,{value:"other",children:"Outro"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"description",children:"Descrição"}),e.jsx(Z,{id:"description",placeholder:"ex: Taxa Condominial - Janeiro/2024",value:C,onChange:r=>W(r.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"amount",children:"Valor Base (R$)"}),e.jsx(Z,{id:"amount",type:"number",step:"0.01",min:"0",placeholder:"0,00",value:ne===""?"":ne,onChange:r=>ee(r.target.value===""?"":parseFloat(r.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"due-date",children:"Data de Vencimento"}),e.jsxs(va,{children:[e.jsx(ba,{asChild:!0,children:e.jsxs(U,{variant:"outline",className:"w-full justify-start text-left font-normal",id:"due-date",children:[e.jsx(ra,{className:"mr-2 h-4 w-4"}),N?ea(new Date(N),"dd 'de' MMMM 'de' yyyy",{locale:Ge}):e.jsx("span",{children:"Selecione a data"})]})}),e.jsx(Na,{className:"w-auto p-0",children:e.jsx(Ta,{mode:"single",selected:N?new Date(N):void 0,onSelect:r=>r&&ce(r.toISOString().split("T")[0]),initialFocus:!0,locale:Ge})})]})]})]}),e.jsx("div",{className:"pt-2 bg-slate-50 p-3 rounded-md mt-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Valor Total:"}),e.jsx("span",{className:"text-lg font-bold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c)})]})}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-2",children:[e.jsx(U,{variant:"outline",onClick:a,disabled:p,children:"Cancelar"}),e.jsx(U,{onClick:R,disabled:p,children:p?"Salvando...":"Salvar Cobrança"})]})]}),e.jsx(Ms,{open:_e,onOpenChange:Ce,children:e.jsxs(Os,{children:[e.jsxs(Ls,{children:[e.jsx(Us,{children:"Confirmar criação de múltiplas cobranças"}),e.jsxs(Vs,{children:["Você está prestes a criar uma cobrança de ",e.jsx("strong",{children:gr(c)})," para ",e.jsxs("strong",{children:["todas as ",t.length," unidades"]})," do condomínio.",e.jsxs("div",{className:"mt-2 flex items-start bg-amber-50 p-3 rounded-md border border-amber-200",children:[e.jsx(Bs,{className:"h-5 w-5 text-amber-500 mr-2 mt-0.5"}),e.jsxs("p",{className:"text-sm text-amber-700",children:["Esta ação criará ",t.length," cobranças separadas e não pode ser desfeita facilmente."]})]})]})]}),e.jsxs(zs,{children:[e.jsx(Gs,{children:"Cancelar"}),e.jsx(qs,{onClick:Ve,disabled:p,children:p?"Processando...":"Confirmar"})]})]})})]})},gr=a=>a===""||typeof a=="string"?"R$ 0,00":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a),pr=({billing:a,onClose:l,onSave:t})=>{var ue;const[d,x]=i.useState([]),[h,g]=i.useState([]),[y,w]=i.useState(((ue=a.unit_id)==null?void 0:ue.toString())||""),[D,F]=i.useState(a.unit_id||null),[P,T]=i.useState(a.resident||"");i.useState("custom");const[G,k]=i.useState(a.description||""),[$,re]=i.useState(a.amount||""),[z,C]=i.useState(a.dueDate||""),[W,ne]=i.useState(a.status||"pending"),[ee,N]=i.useState(a.amount||0),[ce,H]=i.useState(!1),[ie,B]=i.useState(!0);i.useEffect(()=>{async function v(){try{B(!0);const K=await Ya();x(K);const{data:M,error:O}=await oe.from("residents").select("*");if(O)throw console.error("Error fetching residents:",O),O;g(M||[])}catch(K){console.error("Error fetching units and residents:",K),u.error("Erro ao carregar unidades e moradores")}finally{B(!1)}}v()},[]),i.useEffect(()=>{N(typeof $=="number"?$:0)},[$]);const Se=v=>{w(v);const K=parseInt(v);if(isNaN(K))F(null),T("");else{F(K);const M=d.find(O=>O.id===K);if(M){T(M.owner);const O=h.find(le=>le.unit_id===M.id);O&&T(O.name)}}},q=async()=>{try{if(H(!0),!G||!z||ee<=0){u.error("Por favor, preencha todos os campos obrigatórios"),H(!1);return}let v=a.unit;if(D!==a.unit_id){const O=d.find(le=>le.id===D);v=O?`${O.block}${O.number}`:y}const K={unit:v,unit_id:D,resident:P,description:G,amount:ee,due_date:z,status:W};console.log("Updating billing:",K);const{error:M}=await oe.from("billings").update(K).eq("id",a.id);if(M)throw console.error("Error updating billing:",M),M;u.success("Cobrança atualizada com sucesso!"),t&&t(),l()}catch(v){console.error("Error updating billing:",v),u.error("Erro ao atualizar cobrança")}finally{H(!1)}};return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"unit",children:"Unidade"}),e.jsxs(je,{value:y,onValueChange:Se,children:[e.jsx(ve,{id:"unit",children:e.jsx(be,{placeholder:ie?"Carregando unidades...":"Selecione uma unidade"})}),e.jsx(Ne,{children:d.length===0&&!ie?e.jsx(j,{value:"no-units",disabled:!0,children:"Nenhuma unidade encontrada"}):d.map(v=>e.jsx(j,{value:v.id.toString(),children:`${v.block}${v.number}`},v.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"resident",children:"Morador"}),e.jsx(Z,{id:"resident",placeholder:"Nome do morador",value:P,onChange:v=>T(v.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"description",children:"Descrição"}),e.jsx(Z,{id:"description",placeholder:"ex: Taxa Condominial - Janeiro/2024",value:G,onChange:v=>k(v.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"amount",children:"Valor (R$)"}),e.jsx(Z,{id:"amount",type:"number",step:"0.01",min:"0",placeholder:"0,00",value:$===""?"":$,onChange:v=>re(v.target.value===""?"":parseFloat(v.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"dueDate",children:"Data de Vencimento"}),e.jsx(Z,{id:"dueDate",type:"date",value:z,onChange:v=>C(v.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"status",children:"Status"}),e.jsxs(je,{value:W,onValueChange:ne,children:[e.jsx(ve,{id:"status",children:e.jsx(be,{placeholder:"Selecione o status"})}),e.jsxs(Ne,{children:[e.jsx(j,{value:"pending",children:"Pendente"}),e.jsx(j,{value:"paid",children:"Pago"}),e.jsx(j,{value:"overdue",children:"Atrasado"}),e.jsx(j,{value:"cancelled",children:"Cancelado"})]})]})]}),e.jsx("div",{className:"pt-2 bg-slate-50 p-3 rounded-md mt-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Valor Total:"}),e.jsx("span",{className:"text-lg font-bold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(ee)})]})}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-2",children:[e.jsx(U,{variant:"outline",onClick:l,disabled:ce,children:"Cancelar"}),e.jsx(U,{onClick:q,disabled:ce,children:ce?"Salvando...":"Salvar Alterações"})]})]})},fr={pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",paid:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",overdue:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",cancelled:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300"},qe=({status:a})=>{const l={pending:"Pendente",paid:"Pago",overdue:"Atrasado",cancelled:"Cancelado"};return e.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium ${fr[a]}`,children:l[a]})},Fr=()=>{const[a,l]=i.useState(!1),[t,d]=i.useState("all"),[x,h]=i.useState("all"),[g,y]=i.useState([]),[w,D]=i.useState([]),[F,P]=i.useState(new Set),[T,G]=i.useState(!0),[k,$]=i.useState(null),[re,z]=i.useState(!1),[C,W]=i.useState(!1),[ne,ee]=i.useState(!1),[N,ce]=i.useState(null),[H,ie]=i.useState(!1),[B,Se]=i.useState({status:"all",unit:"",unit_id:"all",resident:"",startDate:null,endDate:null}),[q,ue]=i.useState(!1),{bankAccounts:v,addTransaction:K,updateBankAccount:M}=Ns(),O=i.useCallback(async()=>{try{G(!0),console.log("Iniciando busca de cobranças do Supabase...");const{data:o,error:s}=await oe.from("billings").select("*").order("created_at",{ascending:!1});if(s){console.error("Error fetching billings:",s),u.error("Erro ao carregar cobranças"),y([]);return}if(console.log("Dados recebidos do Supabase:",o),o){const c=o.map(A=>{const p=le(A.status);return{...A,dueDate:A.due_date,status:p}});console.log("Cobranças formatadas:",c),y(c),we(c,B,t,x)}else y([]),D([])}catch(o){console.error("Error fetching billings:",o),u.error("Erro ao carregar cobranças"),y([]),D([])}finally{G(!1)}},[B,t,x]),le=o=>o==="pending"||o==="paid"||o==="overdue"||o==="cancelled"?o:"pending";i.useEffect(()=>{O()},[O]);const we=(o,s,c,A="all")=>{console.log("Billing: Iniciando aplicação de filtros",{totalBillings:o.length,filters:s,currentTab:c,currentMonth:A});let p=[...o];if(c!=="all"&&(console.log(`Billing: Filtrando por tab "${c}"`),p=p.filter(n=>n.status===c),console.log(`Billing: ${p.length} cobranças após filtro de tab`)),A!=="all"&&(console.log(`Billing: Filtrando por mês "${A}"`),p=p.filter(n=>{if(!n.dueDate)return!1;const _=new Date(n.dueDate),S=_.getMonth()+1,_e=_.getFullYear();return`${S}-${_e}`===A}),console.log(`Billing: ${p.length} cobranças após filtro de mês`)),s.status!=="all"&&(c==="all"||s.status!==c)&&(console.log(`Billing: Filtrando por status "${s.status}"`),p=p.filter(n=>n.status===s.status),console.log(`Billing: ${p.length} cobranças após filtro de status`)),s.unit_id&&s.unit_id!=="all"){console.log(`Billing: Filtrando por unit_id "${s.unit_id}"`);const n=p.filter(_=>{var S;return((S=_.unit_id)==null?void 0:S.toString())===s.unit_id});n.length===0&&(console.warn(`Billing: Nenhuma cobrança encontrada com unit_id="${s.unit_id}"`),console.log("Billing: IDs de unidades disponíveis nas cobranças:",[...new Set(p.map(_=>{var S;return(S=_.unit_id)==null?void 0:S.toString()}))].filter(Boolean).join(", "))),p=n,console.log(`Billing: ${p.length} cobranças após filtro de unit_id`)}if(s.resident){console.log(`Billing: Filtrando por residente "${s.resident}"`);const n=s.resident.toLowerCase();p=p.filter(_=>_.resident.toLowerCase().includes(n)),console.log(`Billing: ${p.length} cobranças após filtro de residente`)}if(s.startDate){console.log(`Billing: Filtrando por data inicial "${s.startDate}"`);const n=new Date(s.startDate);n.setHours(0,0,0,0),p=p.filter(_=>new Date(_.dueDate)>=n),console.log(`Billing: ${p.length} cobranças após filtro de data inicial`)}if(s.endDate){console.log(`Billing: Filtrando por data final "${s.endDate}"`);const n=new Date(s.endDate);n.setHours(23,59,59,999),p=p.filter(_=>new Date(_.dueDate)<=n),console.log(`Billing: ${p.length} cobranças após filtro de data final`)}console.log("Billing: Resultado final da filtragem:",{initialCount:o.length,filteredCount:p.length}),p.length===0&&o.length>0&&console.warn("Billing: Todos os registros foram filtrados - revisar critérios"),D(p)},me=o=>{d(o),we(g,B,o,x)},Le=o=>{h(o),we(g,B,t,o)},J=(o,s,c,A,p)=>{ce({type:o,id:s,title:c,description:A,actionText:p}),ee(!0)},Ue=async()=>{if(!N)return;ie(!0);let o;try{switch(N.type){case"pay":const s=g.find(n=>n.id===N.id);if(!s){u.error("Cobrança não encontrada");break}if(await $s(N.id)){u.error("Esta cobrança está associada a uma fatura. Por favor, efetue o pagamento através da fatura.");break}if(v.length===0){u.error("Não há contas bancárias cadastradas para registrar o pagamento");break}const A=v[0];if(o=await Ma(N.id,"paid"),o.success){const n=_=>_.map(S=>S.id===N.id?{...S,status:"paid"}:S);y(n),D(n),s&&(K({account:A.id.toString(),amount:s.amount,category:"Receita",date:new Date().toISOString().split("T")[0],description:`Pagamento de cobrança: ${s.description}`,payee:s.resident,status:"completed",type:"income",unit:s.unit}),M({...A,balance:A.balance+s.amount})),u.success("Cobrança marcada como paga")}else u.error("Erro ao marcar cobrança como paga");break;case"send":if(o=await Ga(N.id,"is_sent",!0),o.success){const n=_=>_.map(S=>S.id===N.id?{...S,is_sent:!0}:S);y(n),D(n),u.success("Cobrança marcada como enviada")}else u.error("Erro ao marcar cobrança como enviada");break;case"print":if(o=await Ga(N.id,"is_printed",!0),o.success){const n=_=>_.map(S=>S.id===N.id?{...S,is_printed:!0}:S);y(n),D(n),u.success("Cobrança marcada como impressa")}else u.error("Erro ao marcar cobrança como impressa");break;case"cancel":const p=g.find(n=>n.id===N.id);if(!p){u.error("Cobrança não encontrada");break}if(p.status==="paid"){if(v.length===0){u.error("Não há contas bancárias cadastradas");break}const n=v[0];K({account:n.id.toString(),amount:p.amount,category:"Estorno",date:new Date().toISOString().split("T")[0],description:`Estorno por cancelamento de cobrança: ${p.description}`,payee:p.resident,status:"completed",type:"expense",unit:p.unit}),M({...n,balance:n.balance-p.amount})}if(o=await Ma(N.id,"cancelled"),o.success){const n=_=>_.map(S=>S.id===N.id?{...S,status:"cancelled"}:S);y(n),D(n),u.success("Cobrança cancelada e saldo atualizado")}else u.error("Erro ao cancelar cobrança");break}}catch(s){console.error("Error executing action:",s),u.error(`Erro ao executar ação: ${N.title}`)}finally{ie(!1),ee(!1),ce(null)}},Q=async o=>{try{const s=g.find(c=>c.id===o);if(s)$(s),z(!0);else{const c=await qa(o);c?($({...c,dueDate:c.due_date,status:le(c.status)}),z(!0)):u.error("Cobrança não encontrada")}}catch(s){console.error("Error viewing billing:",s),u.error("Erro ao visualizar cobrança")}},De=async o=>{try{const s=g.find(c=>c.id===o);if(s)$(s),W(!0);else{const c=await qa(o);c?($({...c,dueDate:c.due_date,status:le(c.status)}),W(!0)):u.error("Cobrança não encontrada")}}catch(s){console.error("Error editing billing:",s),u.error("Erro ao editar cobrança")}},V=o=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o),Ee=o=>{try{if(!o)return"Data indisponível";const s=new Date(o);return isNaN(s.getTime())?"Data inválida":new Intl.DateTimeFormat("pt-BR").format(s)}catch(s){return console.error("Erro ao formatar data:",o,s),"Data inválida"}},he=({billings:o,onClose:s})=>{const[c,A]=i.useState(null),p=ye(o),n=c?p.find(f=>f.unit===c):null,_=f=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(f),S=f=>{try{if(!f)return"Data indisponível";const X=new Date(f);return isNaN(X.getTime())?"Data inválida":new Intl.DateTimeFormat("pt-BR").format(X)}catch(X){return console.error("Erro ao formatar data:",f,X),"Data inválida"}},_e=()=>{if(n)try{u.info("Gerando PDF de resumo..."),console.log("Gerando PDF para unidade:",n.unit);const f=n.billings.filter(m=>m.status!=="cancelled").reduce((m,r)=>m+r.amount,0),X=n.billings.map(m=>({id:m.id,unit:m.unit,resident:m.resident,description:m.description,amount:m.amount,due_date:m.dueDate,status:m.status,is_printed:m.is_printed,is_sent:m.is_sent})),R=Ps(n.unit,n.resident,X,f);if(console.log("URL do PDF de resumo gerado:",(R==null?void 0:R.substring(0,50))+"..."),!R)throw new Error("URL do PDF não foi gerada");if(console.log("Abrindo PDF de resumo em nova aba..."),window.open(R,"_blank"))console.log("Nova janela de resumo aberta com sucesso");else{u.error("Bloqueador de pop-ups impediu a abertura do PDF. Por favor, permita pop-ups para este site."),console.error("Falha ao abrir nova janela - possível bloqueio de pop-up");const m=document.createElement("a");m.href=R,m.download=`resumo_${n.unit}_${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(m),m.click(),document.body.removeChild(m)}n.billings.filter(m=>m.status!=="cancelled").forEach(async m=>{await aa(m.id)}),u.success("PDF de resumo gerado com sucesso")}catch(f){console.error("Error generating PDF:",f),u.error(`Erro ao gerar PDF de resumo: ${f instanceof Error?f.message:"Erro desconhecido"}`)}},Ce=()=>{if(n)try{u.info("Gerando boleto..."),console.log("Gerando boleto para unidade:",n.unit);const f=n.billings.filter(m=>m.status!=="cancelled").reduce((m,r)=>m+r.amount,0),X={id:`COMB-${n.unit}-${Date.now().toString().substring(0,8)}`,unit:n.unit,resident:n.resident,description:`Cobranças Consolidadas - Unidade ${n.unit}`,amount:f,due_date:new Date().toISOString().split("T")[0],status:"pending",is_printed:!1,is_sent:!1};console.log("Gerando boleto para:",X);const R=Rs(X);if(console.log("URL do boleto gerado:",(R==null?void 0:R.substring(0,50))+"..."),!R)throw new Error("URL do boleto não foi gerada");if(console.log("Abrindo boleto em nova aba..."),window.open(R,"_blank"))console.log("Nova janela de boleto aberta com sucesso");else{u.error("Bloqueador de pop-ups impediu a abertura do boleto. Por favor, permita pop-ups para este site."),console.error("Falha ao abrir nova janela - possível bloqueio de pop-up");const m=document.createElement("a");m.href=R,m.download=`boleto_${n.unit}_${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(m),m.click(),document.body.removeChild(m)}n.billings.filter(m=>m.status!=="cancelled").forEach(async m=>{await aa(m.id)}),u.success("Boleto gerado com sucesso")}catch(f){console.error("Error generating boleto:",f),u.error(`Erro ao gerar boleto: ${f instanceof Error?f.message:"Erro desconhecido"}`)}},Qe=async()=>{if(n)try{u.info("Gerando QR Code PIX...");const f=n.billings.filter(m=>m.status!=="cancelled").reduce((m,r)=>m+r.amount,0),X={id:`PIX-${n.unit}-${Date.now().toString().substring(0,8)}`,unit:n.unit,resident:n.resident,description:`Pagamento PIX - Unidade ${n.unit}`,amount:f,due_date:new Date().toISOString().split("T")[0],status:"pending",is_printed:!1,is_sent:!1};console.log("Gerando QR Code para:",X);const R=await ks(X);if(console.log("URL do PDF gerado:",(R==null?void 0:R.substring(0,50))+"..."),!R)throw new Error("URL do PDF não foi gerada");if(console.log("Abrindo PDF em nova aba..."),window.open(R,"_blank"))console.log("Nova janela aberta com sucesso");else{u.error("Bloqueador de pop-ups impediu a abertura do PDF. Por favor, permita pop-ups para este site."),console.error("Falha ao abrir nova janela - possível bloqueio de pop-up");const m=document.createElement("a");m.href=R,m.download=`pix_${n.unit}_${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(m),m.click(),document.body.removeChild(m)}n.billings.filter(m=>m.status!=="cancelled").forEach(async m=>{await aa(m.id)}),u.success("QR Code PIX gerado com sucesso")}catch(f){console.error("Error generating PIX QR code:",f),u.error(`Erro ao gerar QR Code PIX: ${f instanceof Error?f.message:"Erro desconhecido"}`)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"unit-select",children:"Selecione a Unidade"}),e.jsxs("select",{id:"unit-select",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:c||"",onChange:f=>A(f.target.value),children:[e.jsx("option",{value:"",children:"Selecione uma unidade"}),p.map(f=>e.jsxs("option",{value:f.unit,children:[f.unit," - ",f.resident," (",f.billings.length," cobranças)"]},f.unit))]})]}),n&&e.jsxs(Aa,{className:"animate-fade-in",children:[e.jsx(Ia,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs(Cs,{children:["Resumo de Cobranças - Unidade ",n.unit]}),e.jsxs(Ss,{children:["Morador: ",n.resident]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(U,{variant:"outline",size:"sm",className:"flex items-center gap-1",onClick:Qe,children:[e.jsx(Hs,{size:14}),e.jsx("span",{children:"Gerar PIX"})]}),e.jsxs(U,{variant:"outline",size:"sm",className:"flex items-center gap-1",onClick:Ce,children:[e.jsx(Da,{size:14}),e.jsx("span",{children:"Gerar Boleto"})]}),e.jsxs(U,{variant:"outline",size:"sm",className:"flex items-center gap-1",onClick:_e,children:[e.jsx(Oa,{size:14}),e.jsx("span",{children:"Imprimir"})]})]})]})}),e.jsx(Fa,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total a Pagar"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:_(n.billings.filter(f=>f.status!=="cancelled").reduce((f,X)=>f+X.amount,0))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"(Apenas cobranças não canceladas)"})]}),e.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Itens"}),e.jsx("p",{className:"text-2xl font-bold",children:n.billings.length}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["(",n.billings.filter(f=>f.status!=="cancelled").length," ativos)"]})]})]}),e.jsxs(Te,{children:[e.jsx($e,{children:e.jsxs(ae,{children:[e.jsx(L,{children:"Descrição"}),e.jsx(L,{children:"Vencimento"}),e.jsx(L,{children:"Status"}),e.jsx(L,{className:"text-right",children:"Valor"})]})}),e.jsx(Me,{children:n.billings.map(f=>e.jsxs(ae,{children:[e.jsx(I,{children:f.description}),e.jsx(I,{children:S(f.dueDate)}),e.jsx(I,{children:e.jsx(qe,{status:f.status})}),e.jsx(I,{className:"text-right font-medium",children:_(f.amount)})]},f.id))})]})]})}),e.jsxs(Ds,{className:"justify-between border-t pt-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Resumo gerado em: ",new Date().toLocaleDateString("pt-BR")]}),e.jsx(U,{onClick:s,variant:"outline",children:"Fechar"})]})]}),p.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-center p-4",children:[e.jsx(Es,{className:"h-8 w-8 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhuma cobrança pendente ou atrasada foi encontrada."})]})]})},pe=o=>{P(s=>{const c=new Set(s);return c.has(o)?c.delete(o):c.add(o),c})},ye=o=>{const s={};return o.forEach(c=>{const A=c.unit;s[A]||(s[A]={unit:c.unit,unitId:c.unit_id,resident:c.resident,totalAmount:0,billings:[]}),c.status!=="cancelled"&&(s[A].totalAmount+=c.amount),s[A].billings.push(c)}),Object.values(s).sort((c,A)=>c.unit.localeCompare(A.unit))},fe=ye(w);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight animate-slide-in-top",children:"Cobranças"}),e.jsx("p",{className:"text-muted-foreground animate-slide-in-top animation-delay-200",children:"Gerencie as cobranças do condomínio."})]})}),e.jsxs("div",{className:"flex justify-end gap-2 my-4",children:[e.jsxs(Fe,{open:q,onOpenChange:ue,children:[e.jsx(Ra,{asChild:!0,children:e.jsxs(U,{variant:"outline",className:"gap-2",children:[e.jsx(Da,{size:16}),e.jsx("span",{children:"Gerar Resumo"})]})}),e.jsxs(Pe,{className:"sm:max-w-[700px]",children:[e.jsxs(Re,{children:[e.jsx(ke,{children:"Resumo de Cobranças por Unidade"}),e.jsx(Be,{children:"Selecione uma unidade para gerar o resumo de cobranças pendentes e em atraso."})]}),e.jsx(he,{billings:g,onClose:()=>ue(!1)})]})]}),e.jsxs(Fe,{open:a,onOpenChange:l,children:[e.jsx(Ra,{asChild:!0,children:e.jsxs(U,{className:"gap-2",children:[e.jsx(Ts,{size:16}),"Nova Cobrança"]})}),e.jsxs(Pe,{className:"max-w-2xl",children:[e.jsxs(Re,{children:[e.jsx(ke,{children:"Nova Cobrança"}),e.jsx(Be,{children:"Preencha as informações abaixo para criar uma nova cobrança."})]}),e.jsx(xr,{onClose:()=>l(!1),onSave:O})]})]}),e.jsxs(Ye,{children:[e.jsx(Ke,{asChild:!0,children:e.jsxs(U,{variant:"outline",className:"gap-2",children:[e.jsx(Ws,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Exportar"})]})}),e.jsxs(Ze,{align:"end",children:[e.jsx(ws,{children:"Escolha o formato"}),e.jsx(Ea,{}),e.jsxs(de,{className:"cursor-pointer",children:[e.jsx(_a,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Exportar como PDF"})]}),e.jsxs(de,{className:"cursor-pointer",children:[e.jsx(_a,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Exportar como Excel"})]})]})]})]}),e.jsx("div",{className:"grid md:grid-cols-1 gap-6",children:e.jsxs(Aa,{children:[e.jsx(Ia,{className:"pb-0",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Is,{value:t,onValueChange:me,children:e.jsxs(Fs,{children:[e.jsx(ze,{value:"all",children:"Todas"}),e.jsx(ze,{value:"pending",children:"Pendentes"}),e.jsx(ze,{value:"paid",children:"Pagas"}),e.jsx(ze,{value:"overdue",children:"Atrasadas"})]})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{htmlFor:"monthFilter",className:"mr-2",children:"Mês:"}),e.jsxs(je,{value:x,onValueChange:Le,children:[e.jsx(ve,{id:"monthFilter",className:"w-[180px]",children:e.jsx(be,{placeholder:"Todos os meses"})}),e.jsxs(Ne,{children:[e.jsx(j,{value:"all",children:"Todos os meses"}),e.jsx(j,{value:"1-2025",children:"Janeiro 2025"}),e.jsx(j,{value:"2-2025",children:"Fevereiro 2025"}),e.jsx(j,{value:"3-2025",children:"Março 2025"}),e.jsx(j,{value:"4-2025",children:"Abril 2025"}),e.jsx(j,{value:"5-2025",children:"Maio 2025"}),e.jsx(j,{value:"6-2025",children:"Junho 2025"}),e.jsx(j,{value:"7-2025",children:"Julho 2025"}),e.jsx(j,{value:"8-2025",children:"Agosto 2025"}),e.jsx(j,{value:"9-2025",children:"Setembro 2025"}),e.jsx(j,{value:"10-2025",children:"Outubro 2025"}),e.jsx(j,{value:"11-2025",children:"Novembro 2025"}),e.jsx(j,{value:"12-2025",children:"Dezembro 2025"}),e.jsx(j,{value:"1-2024",children:"Janeiro 2024"}),e.jsx(j,{value:"2-2024",children:"Fevereiro 2024"}),e.jsx(j,{value:"3-2024",children:"Março 2024"}),e.jsx(j,{value:"4-2024",children:"Abril 2024"}),e.jsx(j,{value:"5-2024",children:"Maio 2024"}),e.jsx(j,{value:"6-2024",children:"Junho 2024"}),e.jsx(j,{value:"7-2024",children:"Julho 2024"}),e.jsx(j,{value:"8-2024",children:"Agosto 2024"}),e.jsx(j,{value:"9-2024",children:"Setembro 2024"}),e.jsx(j,{value:"10-2024",children:"Outubro 2024"}),e.jsx(j,{value:"11-2024",children:"Novembro 2024"}),e.jsx(j,{value:"12-2024",children:"Dezembro 2024"})]})]})]})]})}),e.jsx(Fa,{children:e.jsxs("div",{className:"rounded-md border mt-4",children:[e.jsx("div",{className:"hidden md:block",children:e.jsxs(Te,{children:[e.jsx($e,{children:e.jsxs(ae,{children:[e.jsx(L,{children:"Unidade"}),e.jsx(L,{children:"Morador"}),e.jsx(L,{children:"Qtd. Cobranças"}),e.jsx(L,{children:"Total"}),e.jsx(L,{className:"w-[50px]"})]})}),e.jsx(Me,{children:fe.length>0?fe.map(o=>e.jsxs(se.Fragment,{children:[e.jsxs(ae,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>pe(o.unit),children:[e.jsx(I,{className:"font-medium",children:o.unit}),e.jsx(I,{children:o.resident}),e.jsx(I,{children:o.billings.length}),e.jsx(I,{className:"font-semibold",children:V(o.totalAmount)}),e.jsx(I,{children:e.jsx(U,{variant:"ghost",size:"icon",onClick:s=>{s.stopPropagation(),pe(o.unit)},children:F.has(o.unit)?e.jsx(ka,{className:"h-4 w-4"}):e.jsx(na,{className:"h-4 w-4"})})})]}),F.has(o.unit)&&e.jsx(ae,{className:"bg-muted/20",children:e.jsx(I,{colSpan:5,className:"p-0",children:e.jsx("div",{className:"p-2",children:e.jsxs(Te,{children:[e.jsx($e,{children:e.jsxs(ae,{children:[e.jsx(L,{children:"Descrição"}),e.jsx(L,{children:"Valor"}),e.jsx(L,{children:"Vencimento"}),e.jsx(L,{children:"Status"}),e.jsx(L,{className:"w-[50px]"})]})}),e.jsx(Me,{children:o.billings.map(s=>e.jsxs(ae,{children:[e.jsx(I,{children:s.description}),e.jsx(I,{children:V(s.amount)}),e.jsx(I,{children:Ee(s.dueDate)}),e.jsx(I,{children:e.jsx(qe,{status:s.status})}),e.jsx(I,{children:e.jsxs(Ye,{children:[e.jsx(Ke,{asChild:!0,onClick:c=>c.stopPropagation(),children:e.jsx(U,{variant:"ghost",size:"icon",children:e.jsx(Ba,{className:"h-4 w-4"})})}),e.jsxs(Ze,{align:"end",children:[e.jsxs(de,{className:"cursor-pointer",onClick:c=>{c.stopPropagation(),Q(s.id)},children:[e.jsx(La,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Visualizar"})]}),s.status!=="paid"&&s.status!=="cancelled"&&e.jsxs(de,{className:"cursor-pointer",onClick:c=>{c.stopPropagation(),J("pay",s.id,"Marcar como Pago","Tem certeza que deseja marcar esta cobrança como paga?","Marcar como Pago")},children:[e.jsx(Pa,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Marcar como Pago"})]}),!s.is_sent&&s.status!=="cancelled"&&e.jsxs(de,{className:"cursor-pointer",onClick:c=>{c.stopPropagation(),J("send",s.id,"Marcar como Enviado","Tem certeza que deseja marcar esta cobrança como enviada?","Marcar como Enviado")},children:[e.jsx(Js,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Marcar como Enviado"})]}),!s.is_printed&&s.status!=="cancelled"&&e.jsxs(de,{className:"cursor-pointer",onClick:c=>{c.stopPropagation(),J("print",s.id,"Marcar como Impresso","Tem certeza que deseja marcar esta cobrança como impressa?","Marcar como Impresso")},children:[e.jsx(Oa,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Marcar como Impresso"})]}),e.jsxs(de,{className:"cursor-pointer",onClick:c=>{c.stopPropagation(),De(s.id)},children:[e.jsx(As,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Editar"})]}),s.status!=="cancelled"&&e.jsx(Ea,{}),s.status!=="cancelled"&&e.jsxs(de,{className:"cursor-pointer text-destructive",onClick:c=>{c.stopPropagation(),J("cancel",s.id,"Cancelar Cobrança","Tem certeza que deseja cancelar esta cobrança? Esta ação não pode ser desfeita.","Cancelar")},children:[e.jsx(ys,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Cancelar Cobrança"})]})]})]})})]},s.id))})]})})})})]},o.unit)):e.jsx(ae,{children:e.jsx(I,{colSpan:5,className:"h-24 text-center",children:"Nenhuma cobrança encontrada."})})})]})}),e.jsx("div",{className:"md:hidden",children:e.jsxs(Te,{children:[e.jsx($e,{children:e.jsxs(ae,{children:[e.jsx(L,{children:"Unidade"}),e.jsx(L,{className:"text-right",children:"Total"}),e.jsx(L,{className:"w-[50px]"})]})}),e.jsx(Me,{children:fe.length>0?fe.map(o=>e.jsxs(se.Fragment,{children:[e.jsxs(ae,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>pe(o.unit),children:[e.jsx(I,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:o.unit}),e.jsx("div",{className:"text-sm text-muted-foreground",children:o.resident}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[o.billings.length," cobranças"]})]})}),e.jsx(I,{className:"text-right font-semibold",children:V(o.totalAmount)}),e.jsx(I,{children:e.jsx(U,{variant:"ghost",size:"icon",onClick:s=>{s.stopPropagation(),pe(o.unit)},children:F.has(o.unit)?e.jsx(ka,{className:"h-4 w-4"}):e.jsx(na,{className:"h-4 w-4"})})})]}),F.has(o.unit)&&e.jsx(ae,{className:"bg-muted/20",children:e.jsx(I,{colSpan:3,className:"p-0",children:e.jsx("div",{className:"p-2",children:e.jsxs(Te,{children:[e.jsx($e,{children:e.jsxs(ae,{children:[e.jsx(L,{children:"Descrição"}),e.jsx(L,{className:"text-right",children:"Valor"}),e.jsx(L,{className:"w-[50px]"})]})}),e.jsx(Me,{children:o.billings.map(s=>e.jsxs(ae,{children:[e.jsx(I,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:s.description}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(ra,{className:"mr-1 h-3 w-3"}),Ee(s.dueDate)]}),e.jsx("div",{children:e.jsx(qe,{status:s.status})})]})}),e.jsx(I,{className:"text-right font-medium",children:V(s.amount)}),e.jsx(I,{children:e.jsxs(Ye,{children:[e.jsx(Ke,{asChild:!0,onClick:c=>c.stopPropagation(),children:e.jsx(U,{variant:"ghost",size:"icon",children:e.jsx(Ba,{className:"h-4 w-4"})})}),e.jsxs(Ze,{align:"end",children:[e.jsxs(de,{className:"cursor-pointer",onClick:c=>{c.stopPropagation(),Q(s.id)},children:[e.jsx(La,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Visualizar"})]}),s.status!=="paid"&&s.status!=="cancelled"&&e.jsxs(de,{className:"cursor-pointer",onClick:c=>{c.stopPropagation(),J("pay",s.id,"Marcar como Pago","Tem certeza que deseja marcar esta cobrança como paga?","Marcar como Pago")},children:[e.jsx(Pa,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Marcar como Pago"})]})]})]})})]},s.id))})]})})})})]},o.unit)):e.jsx(ae,{children:e.jsx(I,{colSpan:3,className:"h-24 text-center",children:"Nenhuma cobrança encontrada."})})})]})})]})})]})}),e.jsx(Fe,{open:ne,onOpenChange:ee,children:e.jsxs(Pe,{className:"max-w-md",children:[e.jsxs(Re,{children:[e.jsx(ke,{children:N==null?void 0:N.title}),e.jsx(Be,{children:N==null?void 0:N.description})]}),e.jsxs(_s,{className:"flex space-x-2 justify-end",children:[e.jsx(U,{variant:"outline",onClick:()=>ee(!1),disabled:H,children:"Cancelar"}),e.jsx(U,{onClick:Ue,disabled:H,children:H?"Processando...":N==null?void 0:N.actionText})]})]})}),e.jsx(Fe,{open:re,onOpenChange:z,children:e.jsxs(Pe,{className:"max-w-md",children:[e.jsxs(Re,{children:[e.jsx(ke,{children:"Detalhes da Cobrança"}),e.jsx(Be,{children:"Visualize os detalhes desta cobrança."})]}),k&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"ID"}),e.jsx("p",{children:k.id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx(qe,{status:k.status})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Unidade"}),e.jsx("p",{children:k.unit})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Morador"}),e.jsx("p",{children:k.resident})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Descrição"}),e.jsx("p",{children:k.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Valor"}),e.jsx("p",{className:"font-semibold",children:V(k.amount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Vencimento"}),e.jsx("p",{children:Ee(k.dueDate)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Enviado"}),e.jsx("p",{children:k.is_sent?"Sim":"Não"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Impresso"}),e.jsx("p",{children:k.is_printed?"Sim":"Não"})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(U,{variant:"outline",onClick:()=>z(!1),children:"Fechar"})})]})]})}),e.jsx(Fe,{open:C,onOpenChange:W,children:e.jsxs(Pe,{className:"max-w-2xl",children:[e.jsxs(Re,{children:[e.jsx(ke,{children:"Editar Cobrança"}),e.jsx(Be,{children:"Edite as informações desta cobrança."})]}),k&&e.jsx(pr,{billing:k,onClose:()=>W(!1),onSave:O})]})}),e.jsx("div",{className:"h-20"})]})};export{Fr as default};
