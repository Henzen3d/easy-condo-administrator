import{s as c}from"./index-PF3D36V0.js";async function s(e){try{const{data:r,error:n}=await c.from("invoices").select("*, bank_accounts!invoices_payment_account_id_fkey(*)").eq("id",e).single();if(n)throw n;if(!r)throw new Error("Fatura não encontrada");if(r.status==="paid")throw new Error("Esta fatura já foi paga");let o=null;if(r.payment_account_id)o=r.bank_accounts;else{const{data:t,error:i}=await c.from("bank_accounts").select("*").not("pix_key","is",null).order("name").limit(1);if(i)throw i;if(!t||t.length===0)throw new Error("Nenhuma conta bancária com chave PIX configurada");o=t[0]}if(!o.pix_key)throw new Error("A conta bancária selecionada não possui chave PIX");const a={keyType:o.pix_key_type,key:o.pix_key,name:o.name,city:"Sua Cidade",amount:r.total_amount.toFixed(2),description:`Fatura ${r.invoice_number}`,reference:r.id.toString()};return`00020126580014BR.GOV.BCB.PIX0136${a.key}5204000053039865802BR5913${a.name}6008Sua Cidade62150511${a.reference}6304${u(JSON.stringify(a))}`}catch(r){return console.error("Erro ao gerar código PIX:",r),null}}async function f(e){try{const r=await s(e);return r?`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(r)}`:null}catch(r){return console.error("Erro ao gerar QR code PIX:",r),null}}function u(e){return"ABCD"}async function p(){try{const{data:e,error:r}=await c.from("bank_accounts").select("id").not("pix_key","is",null).limit(1);if(r)throw r;return e&&e.length>0}catch(e){return console.error("Erro ao verificar contas com PIX:",e),!1}}export{f as g,p as h};
